<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Home works for PH207x Health in Numbers</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Home works for PH207x Health in Numbers"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2013-01-05T20:01+0100"/>
<meta name="author" content="Sergey Litvinov"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><link rel="stylesheet" type="text/css" href="http://sachachua.com/blog/wp-content/themes/sacha-v3/style.css" />
<link rel="stylesheet" type="text/css" href="http://sachachua.com/org-export.css" />
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
            config: ["MMLorHTML.js"], jax: ["input/TeX"],
        //  jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "left",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>

<div id="preamble">
<div class="org-export">
</div>

<div id="content">
<h1 class="title">Home works for PH207x Health in Numbers</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Links</a></li>
<li><a href="#sec-2">Basics</a></li>
<li><a href="#sec-3">Probability distribution functions</a>
<ul>
<li><a href="#sec-3-1">normal</a></li>
<li><a href="#sec-3-2">binomial</a></li>
<li><a href="#sec-3-3">student</a></li>
</ul>
</li>
<li><a href="#sec-4">Statistical functions</a>
<ul>
<li><a href="#sec-4-1">ttest</a></li>
<li><a href="#sec-4-2">samsi</a></li>
<li><a href="#sec-4-3">signtest</a></li>
<li><a href="#sec-4-4">signrank</a></li>
<li><a href="#sec-4-5">lincom</a></li>
</ul>
</li>
<li><a href="#sec-5">Tutorial 10</a></li>
<li><a href="#sec-6">Tutorial 11</a></li>
<li><a href="#sec-7">Lecutre 2</a>
<ul>
<li><a href="#sec-7-1">BMI and CHD prevalence</a></li>
<li><a href="#sec-7-2">Diabetes prevalence</a></li>
</ul>
</li>
<li><a href="#sec-8">Lecutre 5</a>
<ul>
<li><a href="#sec-8-1">Central Limit Theorem and Confidence Intervals</a></li>
</ul>
</li>
<li><a href="#sec-9">Lecture 6</a>
<ul>
<li><a href="#sec-9-1">Introduction</a></li>
<li><a href="#sec-9-2">Two-Sample t-test</a></li>
</ul>
</li>
<li><a href="#sec-10">Lecture 7</a>
<ul>
<li><a href="#sec-10-1">Inference for proportions</a></li>
<li><a href="#sec-10-2">Contingency Tables</a></li>
<li><a href="#sec-10-3">Final Thoughts on the Blood Transfusion Trial</a></li>
</ul>
</li>
<li><a href="#sec-11">Lecture 8</a>
<ul>
<li><a href="#sec-11-1">Survey Design</a></li>
</ul>
</li>
<li><a href="#sec-12">Lecture 9</a>
<ul>
<li><a href="#sec-12-1">Trends in Unemployment</a></li>
</ul>
</li>
<li><a href="#sec-13">Lecture 10</a>
<ul>
<li><a href="#sec-13-1">Simple Linear Regression</a></li>
<li><a href="#sec-13-2">High Blood Pressure and CHD Incidence</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">Links</h3>
<div class="outline-text-3" id="text-1">

<p><a href="http://www.ats.ucla.edu/stat/sas/whatstat/default.htm">What statistical analysis should I use?</a>
</p>
<p>
<a href="http://www.stata.com/capabilities/sample-session/">A sample session</a>
</p>
<p>
<a href="http://www.ssc.wisc.edu/sscc/pubs/stata_prog1.htm">Stata Programming Essentials</a>
</p></div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">Basics</h3>
<div class="outline-text-3" id="text-2">




<pre class="src src-stata">di <span style="color: #8b2252;">"hello world"</span>
</pre>


<pre class="example">

hello world

</pre>


<p>
Use macro definition
</p>


<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 41
di `<span style="color: #a0522d;">N</span>'+1
</pre>


<pre class="example">

42

</pre>



<p>
<code>quietly</code> suppresses output for the duration of command
</p>


<pre class="src src-stata">quietly set obs 5
<span style="color: #a020f0;">gen</span> x = <span style="color: #228b22;">_n</span>
describe
</pre>



<pre class="example">
Contains data
  obs:             5                          
 vars:             1                          
 size:            20                          
-------------------------------------------------------------------------------
              storage  display     value
variable name   type   format      label      variable label
-------------------------------------------------------------------------------
x               float  %9.0g                  
-------------------------------------------------------------------------------
Sorted by:  
     Note:  dataset has changed since last saved

no; data in memory would be lost
r(4);

</pre>


<p>
One can use <code>r(...)</code> or <code>e(...)</code> to get output from stata commands
</p>


<pre class="src src-stata">quietly set obs 5
<span style="color: #a020f0;">gen</span> x = <span style="color: #228b22;">_n</span>
quietly <span style="color: #008b8b;">summarize</span> x
di <span style="color: #008b8b;">r</span>(mean)
</pre>


<pre class="example">

3

no; data in memory would be lost
r(4);

</pre>


<p>
Multi-line command
</p>


<pre class="src src-stata">di <span style="color: #b22222;">///</span>
   <span style="color: #8b2252;">"test"</span>
</pre>


<pre class="example">

test

</pre>



<p>
Produce scatter plot
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">7</span>
<span style="color: #a020f0;">gen</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">gen</span> y = x^2
scatter y x
</pre>


<p>
<img src="stata-sq.png"  alt="stata-sq.png" />
</p>
<p>
Plot a function
</p>


<pre class="src src-stata">twoway function <span style="color: #008b8b;">sin</span>(x), <span style="color: #a020f0;">range</span>(0 10)
</pre>


<p>
<img src="fun.png"  alt="fun.png" />
</p>
<p>
Plot two functions
</p>


<pre class="src src-stata">twoway (function <span style="color: #008b8b;">sin</span>(x), <span style="color: #a020f0;">range</span>(-10 10))  (function <span style="color: #008b8b;">cos</span>(x), <span style="color: #a020f0;">range</span>(-10 10)) 
</pre>


<p>
<img src="fun2.png"  alt="fun2.png" />
</p>
<p>
Bar Charts
</p>


<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nobs</span> = 10
<span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> `<span style="color: #a0522d;">nobs</span>'
<span style="color: #a020f0;">generate</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">gen</span> lev = 1 if <span style="color: #228b22;">_n</span>&lt;=`<span style="color: #a0522d;">nobs</span>'/2
<span style="color: #a020f0;">replace</span> lev = 0 if <span style="color: #228b22;">_n</span>&gt;`<span style="color: #a0522d;">nobs</span>'/2
graph bar x, over(lev)
</pre>


<p>
<img src="bar.png"  alt="bar.png" />
</p>
<p>
Histogram
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">1000</span>
<span style="color: #a020f0;">generate</span> x = rnormal()
twoway (histogram x, bin(20)) (function normalden(x), <span style="color: #a020f0;">range</span>(-4 4))
</pre>


<p>
<img src="hist.png"  alt="hist.png" />
</p>
<p>
Box plot
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">10</span>
<span style="color: #a020f0;">generate</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">generate</span> y = <span style="color: #228b22;">_n</span> + 1
graph box x y
</pre>


<p>
<img src="box.png"  alt="box.png" />
</p>
<p>
Horizontal box plot
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">10</span>
<span style="color: #a020f0;">generate</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">generate</span> y = <span style="color: #228b22;">_n</span> + 1
graph box x y, horizontal
</pre>


<p>
<img src="hbox.png"  alt="hbox.png" />
</p>
<p>
Combining separate graphs into one graph
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">10</span>
<span style="color: #a020f0;">generate</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">generate</span> y = <span style="color: #228b22;">_n</span> + 1
twoway (function normalden(x), <span style="color: #a020f0;">range</span>(-4 4)), name(f1)
twoway (function normal(x), <span style="color: #a020f0;">range</span>(-4 4)), name(f2)
graph combine f1 f2, row(2)
</pre>


<p>
<img src="combine.png"  alt="combine.png" />
</p>

</div>

</div>

<div id="outline-container-3" class="outline-3">
<h3 id="sec-3">Probability distribution functions</h3>
<div class="outline-text-3" id="text-3">


</div>

<div id="outline-container-3-1" class="outline-4">
<h4 id="sec-3-1">normal</h4>
<div class="outline-text-4" id="text-3-1">




<pre class="src src-stata">twoway function normalden(x, 0, 1), <span style="color: #a020f0;">range</span>(-4 4) ytitle(<span style="color: #8b2252;">"pr. density of normal distr."</span>)
</pre>


<p>
<img src="normal.png"  alt="normal.png" />
</p>
</div>

</div>

<div id="outline-container-3-2" class="outline-4">
<h4 id="sec-3-2">binomial</h4>
<div class="outline-text-4" id="text-3-2">

<p>Plot binomial distribution: probability of observing n ore fewer
successes then probability of one successes is p.
</p>


<pre class="src src-stata">twoway (function binomial(30, x, 0.5), <span style="color: #a020f0;">range</span>(0 30)) <span style="color: #b22222;">///</span>
       (function binomial(30, x, 0.25), <span style="color: #a020f0;">range</span>(0 30)), <span style="color: #b22222;">///</span>
       legend( label(1 <span style="color: #8b2252;">"p=0.5, n=10"</span>) label(2 <span style="color: #8b2252;">"p=0.25, n=10"</span>) )
</pre>


<p>
<img src="bbinomial.png"  alt="bbinomial.png" />
</p>
</div>

</div>

<div id="outline-container-3-3" class="outline-4">
<h4 id="sec-3-3">student</h4>
<div class="outline-text-4" id="text-3-3">




<pre class="src src-stata">twoway (function tden(2, x), <span style="color: #a020f0;">range</span>(-10 10)) <span style="color: #b22222;">///</span>
       (function tden(10, x), <span style="color: #a020f0;">range</span>(-10 10)), <span style="color: #b22222;">///</span>
       legend( label(1 <span style="color: #8b2252;">"n=2"</span>) label(2 <span style="color: #8b2252;">"n=10"</span>)) <span style="color: #b22222;">///</span>
       ytitle(<span style="color: #8b2252;">"t-distribution"</span>)
</pre>


<p>
<img src="tden.png"  alt="tden.png" />
</p>
</div>
</div>

</div>

<div id="outline-container-4" class="outline-3">
<h3 id="sec-4">Statistical functions</h3>
<div class="outline-text-3" id="text-4">


</div>

<div id="outline-container-4-1" class="outline-4">
<h4 id="sec-4-1">ttest</h4>
<div class="outline-text-4" id="text-4-1">

<p>Mean-comparison tests
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">100</span>
<span style="color: #a020f0;">gen</span> x = rnormal()
sum x
ttest x == 0
</pre>



<pre class="example">
obs was 0, now 100

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
           x |       100    .0006276    1.061928  -2.885089   1.837664

One-sample t test
------------------------------------------------------------------------------
Variable |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |     100    .0006276    .1061928    1.061928    -.210082    .2113372
------------------------------------------------------------------------------
    mean = mean(x)                                                t =   0.0059
Ho: mean = 0                                     degrees of freedom =       99

    Ha: mean &lt; 0                 Ha: mean != 0                 Ha: mean &gt; 0
 Pr(T &lt; t) = 0.5024         Pr(|T| &gt; |t|) = 0.9953          Pr(T &gt; t) = 0.4976

no; data in memory would be lost
r(4);

</pre>



<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">20</span>
<span style="color: #a020f0;">gen</span> x = rnormal(1.0)
<span style="color: #a020f0;">gen</span> y = rnormal(1.5)
ttest x == y
</pre>



<pre class="example">
obs was 0, now 20

Paired t test
------------------------------------------------------------------------------
Variable |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |      20    .6278007    .2067612    .9246643    .1950445    1.060557
       y |      20    1.529019    .2938401    1.314093    .9140044    2.144033
---------+--------------------------------------------------------------------
    diff |      20    -.901218    .3177534    1.421036   -1.566283   -.2361526
------------------------------------------------------------------------------
     mean(diff) = mean(x - y)                                     t =  -2.8362
 Ho: mean(diff) = 0                              degrees of freedom =       19

 Ha: mean(diff) &lt; 0           Ha: mean(diff) != 0           Ha: mean(diff) &gt; 0
 Pr(T &lt; t) = 0.0053         Pr(|T| &gt; |t|) = 0.0106          Pr(T &gt; t) = 0.9947

no; data in memory would be lost
r(4);

</pre>


<p>
With group variable
</p>




<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nobs</span> = 1000
<span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> `<span style="color: #a0522d;">nobs</span>'
<span style="color: #a020f0;">gen</span> lev = 1 if <span style="color: #228b22;">_n</span>&lt;=`<span style="color: #a0522d;">nobs</span>'/2
<span style="color: #a020f0;">replace</span> lev = 0 if <span style="color: #228b22;">_n</span>&gt;`<span style="color: #a0522d;">nobs</span>'/2

<span style="color: #a020f0;">gen</span> x = rnormal(1) if lev==0
<span style="color: #a020f0;">replace</span> x = rnormal(2) if lev==1
graph box x, <span style="color: #228b22;">by</span>(lev)
</pre>


<p>
<img src="twonorm.png"  alt="twonorm.png" />
</p>
<p>
Immediate form of one-sample mean-comparison test
</p>


<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> obs</span> = 20
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 1.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd</span> = 1.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> val</span> = 1.8
ttesti `<span style="color: #a0522d;">obs</span>' `<span style="color: #a0522d;">mean</span>' `<span style="color: #a0522d;">sd</span>' `<span style="color: #a0522d;">val</span>'
</pre>



<pre class="example">
One-sample t test
------------------------------------------------------------------------------
         |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |      20           1    .3354102         1.5    .2979784    1.702022
------------------------------------------------------------------------------
    mean = mean(x)                                                t =  -2.3851
Ho: mean = 1.8                                   degrees of freedom =       19

   Ha: mean &lt; 1.8               Ha: mean != 1.8               Ha: mean &gt; 1.8
 Pr(T &lt; t) = 0.0138         Pr(|T| &gt; |t|) = 0.0276          Pr(T &gt; t) = 0.9862

</pre>


</div>

</div>

<div id="outline-container-4-2" class="outline-4">
<h4 id="sec-4-2">samsi</h4>
<div class="outline-text-4" id="text-4-2">

<p>Sample size and power for means and proportions
</p>


<pre class="src src-stata">sampsi 0.2 0.4
</pre>



<pre class="example">
Estimated sample size for two-sample comparison of proportions

Test Ho: p1 = p2, where p1 is the proportion in population 1
                    and p2 is the proportion in population 2
Assumptions:

         alpha =   0.0500  (two-sided)
         power =   0.9000
            p1 =   0.2000
            p2 =   0.4000
         n2/n1 =   1.00

Estimated required sample sizes:

            n1 =      119
            n2 =      119

</pre>


</div>

</div>

<div id="outline-container-4-3" class="outline-4">
<h4 id="sec-4-3">signtest</h4>
<div class="outline-text-4" id="text-4-3">

<p>Sign test of matched pairs
</p>


<pre class="src src-stata">quietly set obs 20
<span style="color: #a020f0;">gen</span> x = rnormal()
<span style="color: #a020f0;">gen</span> y = x + 1.0 + rnormal()
signtest x=y
</pre>



<pre class="example">
Sign test

        sign |    observed    expected
-------------+------------------------
    positive |           5          10
    negative |          15          10
        zero |           0           0
-------------+------------------------
         all |          20          20

One-sided tests:
  Ho: median of x - y = 0 vs.
  Ha: median of x - y &gt; 0
      Pr(#positive &gt;= 5) =
         Binomial(n = 20, x &gt;= 5, p = 0.5) =  0.9941

  Ho: median of x - y = 0 vs.
  Ha: median of x - y &lt; 0
      Pr(#negative &gt;= 15) =
         Binomial(n = 20, x &gt;= 15, p = 0.5) =  0.0207

Two-sided test:
  Ho: median of x - y = 0 vs.
  Ha: median of x - y != 0
      Pr(#positive &gt;= 15 or #negative &gt;= 15) =
         min(1, 2*Binomial(n = 20, x &gt;= 15, p = 0.5)) =  0.0414

no; data in memory would be lost
r(4);

</pre>



<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">20</span>
<span style="color: #a020f0;">gen</span> x = rnormal()
<span style="color: #a020f0;">gen</span> y = 0.15 + rnormal()
signrank x=y
ttest x=y
</pre>



<pre class="example">
obs was 0, now 20

Wilcoxon signed-rank test

        sign |      obs   sum ranks    expected
-------------+---------------------------------
    positive |        7          63         105
    negative |       13         147         105
        zero |        0           0           0
-------------+---------------------------------
         all |       20         210         210

unadjusted variance      717.50
adjustment for ties        0.00
adjustment for zeros       0.00
                     ----------
adjusted variance        717.50

Ho: x = y
             z =  -1.568
    Prob &gt; |z| =   0.1169

Paired t test
------------------------------------------------------------------------------
Variable |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |      20   -.3721993    .2067612    .9246643   -.8049555    .0605569
       y |      20    .1790187    .2938401    1.314093   -.4359956    .7940331
---------+--------------------------------------------------------------------
    diff |      20    -.551218    .3177534    1.421036   -1.216283    .1138474
------------------------------------------------------------------------------
     mean(diff) = mean(x - y)                                     t =  -1.7347
 Ho: mean(diff) = 0                              degrees of freedom =       19

 Ha: mean(diff) &lt; 0           Ha: mean(diff) != 0           Ha: mean(diff) &gt; 0
 Pr(T &lt; t) = 0.0495         Pr(|T| &gt; |t|) = 0.0990          Pr(T &gt; t) = 0.9505

no; data in memory would be lost
r(4);

</pre>


</div>

</div>

<div id="outline-container-4-4" class="outline-4">
<h4 id="sec-4-4">signrank</h4>
<div class="outline-text-4" id="text-4-4">

<p>Equality tests on matched data
</p></div>

</div>

<div id="outline-container-4-5" class="outline-4">
<h4 id="sec-4-5">lincom</h4>
<div class="outline-text-4" id="text-4-5">

<p>lincom computes combinations of estimators (z, p-values etc.). 
</p>
<p>
Construct a liniear regression and use <code>lincom</code> 
</p>


<pre class="src src-stata">quietly set obs 10
<span style="color: #a020f0;">gen</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">gen</span> y = x + 2*rnormal()
quietly <span style="color: #008b8b;">regress</span> y x
lincom 2*x
</pre>



<pre class="example">
 ( 1)  2*x = 0

------------------------------------------------------------------------------
           y |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.856045   .5219802     3.56   0.007     .6523569    3.059734
------------------------------------------------------------------------------

no; data in memory would be lost
r(4);

</pre>


</div>
</div>

</div>

<div id="outline-container-5" class="outline-3">
<h3 id="sec-5"><span class="todo TODO">TODO</span> Tutorial 10</h3>
<div class="outline-text-3" id="text-5">

<ul>
<li id="sec-5-1">Step 1<br/>
 Calculate the Pearson correlation for the percent of patients who say
their nurse always communicated well (nursealways) and the percent of
patients who would always recom- mend the hospital (recommendyes).



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hospitaldata.74f90a09d4da.dta
pwcorr recommendyes nursealways, sig
</pre>



<pre class="example">
             | recomm~s nursea~s
-------------+------------------
recommendyes |   1.0000 
             |
             |
 nursealways |   0.6580   1.0000 
             |   0.0000
             |

</pre>


</li>
</ul>
<ul>
<li id="sec-5-2">Step 2<br/>
Now that you have established that these variables are correlated,
you decide to fit a linear regression model to assess the relationship
between recommendyes and nursealways.  State your model.

<p>
\(Y_i\) = percent of patients who always recommend the hospital
</p>
<p>
\(X_i\) = perecnt of patients who say that the nurse always communicates well
</p>


\begin{equation}
Y_i = \alpha + \beta X_i + \epsilon_i
\end{equation}

<p>
where \(\epsilon_i \propto N(0, \sigma^2)\).  Goal is to estimate and
obtain measures of uncertainty for \(\alpha\) and \(\beta\). We use the
method of least squares for estimation.
</p></li>
</ul>
<ul>
<li id="sec-5-3">Step 3<br/>
Construct a scatter plot with nursealways on the x-axis and recommendyes on the y axis.
Use the scatterplot to evaluate the assumptions of simple linear
regression.  Assumptions:
<ul>
<li>Independent observations
</li>
<li>\(Y|X\) is normally distributed
</li>
<li>Homoscedasticity (constant variance)
</li>
<li>Linearity
</li>
</ul>




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hospitaldata.74f90a09d4da.dta
twoway (scatter recommendyes nursealways)
</pre>


<p>
<img src="linrett2.png"  alt="linrett2.png" />
</p>
</li>
</ul>
<ul>
<li id="sec-5-4">Step 4<br/>
Fit the linear regression model. Provide estimates, confidence intervals, and interpreta-
tions of the regression coefficients $&alpha; and \(\beta\).



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hospitaldata.74f90a09d4da.dta
regress recommendyes nursealways
</pre>



<pre class="example">
      Source |       SS       df       MS              Number of obs =    3570
-------------+------------------------------           F(  1,  3568) = 2723.72
       Model |  144368.851     1  144368.851           Prob &gt; F      =  0.0000
    Residual |  189118.972  3568  53.0041962           R-squared     =  0.4329
-------------+------------------------------           Adj R-squared =  0.4327
       Total |  333487.823  3569  93.4401297           Root MSE      =  7.2804

------------------------------------------------------------------------------
recommendyes |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 nursealways |   1.159487   .0222169    52.19   0.000     1.115928    1.203046
       _cons |  -19.21559   1.712829   -11.22   0.000    -22.57381   -15.85737
------------------------------------------------------------------------------

</pre>


</li>
</ul>
<ul>
<li id="sec-5-5">Step 7<br/>
Examine a residual plot. Using \(R^2\) and the plot, does the model
appear to fit well? (Are there any outliers?)



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hospitaldata.74f90a09d4da.dta
regress recommendyes nursealways
rvfplot
</pre>


<p>
<img src="rvf-lin.png"  alt="rvf-lin.png" />
</p>
</li>
</ul>
<ul>
<li id="sec-5-6">Step 8<br/>
Using the regression line, predict the expected percent of patients
who always recommend the hospital when the reported percent of nurses
who always communicate well is 80%? Construct corresponding 95%
confidence interval.



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hospitaldata.74f90a09d4da.dta
regress recommendyes nursealways
lincom _cons + 80*nursealways
</pre>



<pre class="example">
      Source |       SS       df       MS              Number of obs =    3570
-------------+------------------------------           F(  1,  3568) = 2723.72
       Model |  144368.851     1  144368.851           Prob &gt; F      =  0.0000
    Residual |  189118.972  3568  53.0041962           R-squared     =  0.4329
-------------+------------------------------           Adj R-squared =  0.4327
       Total |  333487.823  3569  93.4401297           Root MSE      =  7.2804

------------------------------------------------------------------------------
recommendyes |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 nursealways |   1.159487   .0222169    52.19   0.000     1.115928    1.203046
       _cons |  -19.21559   1.712829   -11.22   0.000    -22.57381   -15.85737
------------------------------------------------------------------------------

 ( 1)  80*nursealways + _cons = 0

------------------------------------------------------------------------------
recommendyes |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   73.54339   .1399631   525.45   0.000     73.26897     73.8178
------------------------------------------------------------------------------

</pre>


</li>
</ul>
<ul>
<li id="sec-5-7">Step 9<br/>
For a new hospital with 80% of patients reporting that nurses always
communicate well, predict the percent of patients who will always
recommend the hospital. Construct corresponding 95% confidence
interval.



<pre class="src src-stata">di 73.54339 - invttail(3568, 0.025)*7.281745
</pre>


<pre class="example">

59.266589

</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-6" class="outline-3">
<h3 id="sec-6"><span class="todo TODO">TODO</span> Tutorial 11</h3>
<div class="outline-text-3" id="text-6">




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/chis_healthdisparities.e85b34e4c45a.dta
<span style="color: #a020f0;">gen</span> nopov = 1-poverty
logit doctor nopov
lincom nopov, eform
</pre>


<pre class="example">
Iteration 0:   log likelihood =  -247.4035  
Iteration 1:   log likelihood = -245.14765  
Iteration 2:   log likelihood = -245.08244  
Iteration 3:   log likelihood = -245.08242  

Logistic regression                               Number of obs   =        500
                                                  LR chi2(1)      =       4.64
                                                  Prob &gt; chi2     =     0.0312
Log likelihood = -245.08242                       Pseudo R2       =     0.0094

------------------------------------------------------------------------------
      doctor |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       nopov |   .6713351   .3013476     2.23   0.026     .0807047    1.261965
       _cons |     .83975   .2745156     3.06   0.002     .3017093    1.377791
------------------------------------------------------------------------------

 ( 1)  [doctor]nopov = 0

------------------------------------------------------------------------------
      doctor |     exp(b)   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.956848   .5896914     2.23   0.026     1.084051    3.532357
------------------------------------------------------------------------------

no; data in memory would be lost
r(4);

</pre>


</div>

</div>

<div id="outline-container-7" class="outline-3">
<h3 id="sec-7"><span class="todo TODO">TODO</span> Lecutre 2</h3>
<div class="outline-text-3" id="text-7">


</div>

<div id="outline-container-7-1" class="outline-4">
<h4 id="sec-7-1">BMI and CHD prevalence</h4>
<div class="outline-text-4" id="text-7-1">

<ul>
<li id="sec-7-1-1">Q1<br/>
What is the prevalence of obesity among the 4415 participants at the
1956 exam?
</li>
</ul>
<ul>
<li id="sec-7-1-2">Q2<br/>
What is the prevalence of CHD at the 1956 exam among the 4415
participants at the 1956 exam?
</li>
</ul>
<ul>
<li id="sec-7-1-3">Q3<br/>
What is the prevalence of CHD at the 1956 exam for each of the body mass index
classes?




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly <span style="color: #a020f0;">gen</span> bmi1_<span style="color: #008b8b;">cat</span>=.
quietly <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=1 if (bmi1&lt;18.5)
quietly <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=2 if (bmi1&gt;=18.5 &amp; bmi1&lt;25)
quietly <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=3 if (bmi1&gt;=25 &amp; bmi1&lt;=30)
quietly <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=4 if (bmi1&gt;30 &amp; bmi1!=30)
tab bmi1_<span style="color: #008b8b;">cat</span> prevchd1, missing
</pre>



<pre class="example">
           |  Prevalent coronary
           | heart disease, exam 1
  bmi1_cat |        No        Yes |     Total
-----------+----------------------+----------
         1 |        57          0 |        57 
         2 |     1,870         66 |     1,936 
         3 |     1,758         90 |     1,848 
         4 |       555         38 |       593 
-----------+----------------------+----------
     Total |     4,240        194 |     4,434 

no; data in memory would be lost
r(4);

</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-7-2" class="outline-4">
<h4 id="sec-7-2">Diabetes prevalence</h4>
<div class="outline-text-4" id="text-7-2">

<ul>
<li id="sec-7-2-1">Q1<br/>
What is the prevalence of diabetes at the first exam (diabetes1=1)?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
tab diabetes1
</pre>


<pre class="example">

  Diabetic, |
     exam 1 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      4,313       97.27       97.27
        Yes |        121        2.73      100.00
------------+-----------------------------------
      Total |      4,434      100.00

</pre>


</li>
</ul>
<ul>
<li id="sec-7-2-2">Q2<br/>
What is the prevalence of diabetes at the second exam (diabetes2=1)?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
tab diabetes2
</pre>


<pre class="example">

  Diabetic, |
     exam 2 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,775       96.06       96.06
        Yes |        155        3.94      100.00
------------+-----------------------------------
      Total |      3,930      100.00

</pre>


</li>
</ul>
<ul>
<li id="sec-7-2-3">Q3<br/>
What is the prevalence of diabetes at the third exam (diabetes3=1)?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
tab diabetes3
</pre>


<pre class="example">

  Diabetic, |
     exam 3 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,009       92.22       92.22
        Yes |        254        7.78      100.00
------------+-----------------------------------
      Total |      3,263      100.00

</pre>


</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-8" class="outline-3">
<h3 id="sec-8">Lecutre 5</h3>
<div class="outline-text-3" id="text-8">


</div>

<div id="outline-container-8-1" class="outline-4">
<h4 id="sec-8-1">Central Limit Theorem and Confidence Intervals</h4>
<div class="outline-text-4" id="text-8-1">

<p>According to the WHO Global Database on Anaemia, the mean hemoglobin
levels among primary school children in Delhi were estimated at \(\mu=
108\) g/L, with standard deviation \(\sigma=12.5\) g/L. (Source:
<a href="http://who.int/vmnis/anaemia/data/database/countries/ind_ida.pdf">http://who.int/vmnis/anaemia/data/database/countries/ind_ida.pdf</a>)
</p>
<p>
Suppose we took a random sample of <b>75 primary school children</b> in
Delhi. Denote the mean hemoglobin levels in this sample as
\(\over{x}\). Throughout this question, assume that the sample size is
large enough that the Central Limit Theorem is applicable and that
\(\sigma\) is known.
</p>
<ul>
<li id="sec-8-1-1">Q1<br/>
   According to the Central Limit Theorem, what is the expected value
   (mean) of \(\over{x}\)?
</li>
</ul>
<ul>
<li id="sec-8-1-2">Q2<br/>
   According to the Central Limit Theorem, what is the standard
   deviation of \(\over{x}\)?



<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 75
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> std</span> = `<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"exp. mean of sample = mean of population: "</span> <span style="color: #008b8b;">as</span> result 108
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"standard deviation of sample mean: "</span> <span style="color: #008b8b;">as</span> result `<span style="color: #a0522d;">std</span>'
</pre>


<pre class="example">

exp. mean of sample = mean of population: 108

standard deviation of sample mean: 1.4433757

</pre>


</li>
</ul>
<ul>
<li id="sec-8-1-3">Q3<br/>
   Suppose we take a large number of samples of <b>size 75</b>. What
   proportion of the samples would we expect to have a sample mean
   \(\over{x}\) that lies between <b>106</b> and <b>110 g/L</b>?



<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 75
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 108.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> std</span> = `<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z1</span> = (106 - `<span style="color: #a0522d;">mean</span>')/`<span style="color: #a0522d;">std</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z2</span> = (110 - `<span style="color: #a0522d;">mean</span>')/`<span style="color: #a0522d;">std</span>'
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"proportion: "</span> <span style="color: #008b8b;">as</span> result normal(`<span style="color: #a0522d;">z2</span>')-normal(`<span style="color: #a0522d;">z1</span>')
</pre>


<pre class="example">

proportion: .83414334

</pre>


</li>
</ul>
<ul>
<li id="sec-8-1-4">Q4<br/>
   Suppose instead we repeatedly took random samples of <b>size 25</b>. What
   proportion of the samples would we expect to have a sample mean
   that lies between <b>106</b> and <b>110 g/L</b>?



<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 25
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 108.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> std</span> = `<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z1</span> = (106 - `<span style="color: #a0522d;">mean</span>')/`<span style="color: #a0522d;">std</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z2</span> = (110 - `<span style="color: #a0522d;">mean</span>')/`<span style="color: #a0522d;">std</span>'
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"proportion: "</span> <span style="color: #008b8b;">as</span> result normal(`<span style="color: #a0522d;">z2</span>')-normal(`<span style="color: #a0522d;">z1</span>')
</pre>


<pre class="example">

proportion: .5762892

</pre>


</li>
</ul>
<ul>
<li id="sec-8-1-5">Q1<br/>
Again, suppose we repeatedly took samples of <b>size 75</b>. What
proportion of the samples would we expect to have a mean less than
\(\over{x}=103\) ?



<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 75
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 108
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> std</span> = `<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z1</span> = (103 - `<span style="color: #a0522d;">mean</span>')/`<span style="color: #a0522d;">std</span>'
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"proportion: "</span> <span style="color: #008b8b;">as</span> result normal(`<span style="color: #a0522d;">z1</span>')
</pre>


<pre class="example">

proportion: .000266

</pre>


</li>
</ul>
<ul>
<li id="sec-8-1-6">Q6<br/>
If we repeatedly took samples of <b>size 75</b>, \(\over{x}\) we would
expect that, in <b>20% of the samples</b>, would be greater than ___?



<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 75
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 108.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> std</span> = `<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z1</span> =  invnormal(1-0.2)
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"20% of the samples is greater than "</span> <span style="color: #008b8b;">as</span> result `<span style="color: #a0522d;">z1</span>'*`<span style="color: #a0522d;">std</span>'+`<span style="color: #a0522d;">mean</span>'
</pre>


<pre class="example">

20% of the samples is greater than 109.21478

</pre>


</li>
</ul>
<ul>
<li id="sec-8-1-7">Q7<br/>
After taking a sample of <b>size 75</b>, we found that the sample mean
was \(\over{x}=103\). Construct a 95% confidence interval for \(\mu\).



<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 75
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sample_mean</span> = 103.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> dM</span> = 1.96*`<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"interval: "</span> `<span style="color: #a0522d;">sample_mean</span>'-`<span style="color: #a0522d;">dM</span>' <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">" "</span> `<span style="color: #a0522d;">sample_mean</span>'+`<span style="color: #a0522d;">dM</span>'
</pre>


<pre class="example">

interval: 100.17098 105.82902

</pre>


</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-9" class="outline-3">
<h3 id="sec-9">Lecture 6</h3>
<div class="outline-text-3" id="text-9">


</div>

<div id="outline-container-9-1" class="outline-4">
<h4 id="sec-9-1">Introduction</h4>
<div class="outline-text-4" id="text-9-1">

<p>Sample size and power for means and proportions
</p>




<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> m1</span> = 1.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> m2</span> = 2.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd1</span> = 0.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd2</span> = 0.8
sampsi `<span style="color: #a0522d;">m1</span>' `<span style="color: #a0522d;">m2</span>', sd1(`<span style="color: #a0522d;">sd1</span>') sd2(`<span style="color: #a0522d;">sd2</span>')
</pre>



<pre class="example">
Estimated sample size for two-sample comparison of means

Test Ho: m1 = m2, where m1 is the mean in population 1
                    and m2 is the mean in population 2
Assumptions:

         alpha =   0.0500  (two-sided)
         power =   0.9000
            m1 =        1
            m2 =        2
           sd1 =       .5
           sd2 =       .8
         n2/n1 =     1.00

Estimated required sample sizes:

            n1 =       10
            n2 =       10

</pre>


<p>
Plot corresponding normal distributions
</p>


<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> m1</span> = 1.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> m2</span> = 2.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd1</span> = 0.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd2</span> = 0.8
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> xmax</span>=<span style="color: #008b8b;">max</span>(`<span style="color: #a0522d;">m1</span>'+4*`<span style="color: #a0522d;">sd1</span>', `<span style="color: #a0522d;">m2</span>'+4*`<span style="color: #a0522d;">sd2</span>')
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> xmin</span>=<span style="color: #008b8b;">min</span>(`<span style="color: #a0522d;">m1</span>'-4*`<span style="color: #a0522d;">sd1</span>', `<span style="color: #a0522d;">m2</span>'-4*`<span style="color: #a0522d;">sd2</span>')
twoway (function normalden(x,`<span style="color: #a0522d;">m1</span>',`<span style="color: #a0522d;">sd1</span>'), <span style="color: #a020f0;">range</span>(`<span style="color: #a0522d;">xmin</span>' `<span style="color: #a0522d;">xmax</span>')) <span style="color: #b22222;">///</span>
       (function normalden(x,`<span style="color: #a0522d;">m2</span>',`<span style="color: #a0522d;">sd2</span>'), <span style="color: #a020f0;">range</span>(`<span style="color: #a0522d;">xmin</span>' `<span style="color: #a0522d;">xmax</span>')), <span style="color: #b22222;">///</span>
       legend( label(1 <span style="color: #8b2252;">"dist1"</span>) label(2 <span style="color: #8b2252;">"dist2"</span>) )
</pre>


<p>
<img src="normal2.png"  alt="normal2.png" />
</p>




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
<span style="color: #a020f0;">generate</span> totchol = totchol1 - totchol2
sampsi 0 13, sd1(33.3) <span style="color: #008b8b;">alpha</span>(0.05) onesample
</pre>



<pre class="example">
(675 missing values generated)

Estimated sample size for one-sample comparison of mean
  to hypothesized value

Test Ho: m =      0, where m is the mean in the population

Assumptions:

         alpha =   0.0500  (two-sided)
         power =   0.9000
 alternative m =       13
            sd =     33.3

Estimated required sample size:

             n =       69

no; data in memory would be lost
r(4);

</pre>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
<span style="color: #a020f0;">generate</span> dchol = totchol2 - totchol1
ttest dchol == 0
</pre>



<pre class="example">
(675 missing values generated)

One-sample t test
------------------------------------------------------------------------------
Variable |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
   dchol |    3759    13.16574    .5432341    33.30605    12.10067     14.2308
------------------------------------------------------------------------------
    mean = mean(dchol)                                            t =  24.2358
Ho: mean = 0                                     degrees of freedom =     3758

    Ha: mean &lt; 0                 Ha: mean != 0                 Ha: mean &gt; 0
 Pr(T &lt; t) = 1.0000         Pr(|T| &gt; |t|) = 0.0000          Pr(T &gt; t) = 0.0000

no; data in memory would be lost
r(4);

</pre>


<p>
Independent samples
</p>


<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta, <span style="color: #a020f0;">clear</span>
<span style="color: #b22222;">/* </span><span style="color: #b22222;">I have to use only 50%  of the observation because of Stata version </span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">sample</span> 50
graph box totchol1 totchol2
</pre>


<p>
<img src="t1t2.png"  alt="t1t2.png" />
</p>


<p>
Independent samples
</p>


<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta, <span style="color: #a020f0;">clear</span>
<span style="color: #008b8b;">set</span> <span style="color: #008b8b;">se</span><span style="color: #228b22;">ed</span> 72576466
quietly <span style="color: #a020f0;">sample</span> 49, <span style="color: #008b8b;">count</span> <span style="color: #228b22;">by</span>(hyperten)
ttest totchol1, <span style="color: #228b22;">by</span>(hyperten)
</pre>



<pre class="example">
Two-sample t test with equal variances
------------------------------------------------------------------------------
   Group |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
      No |      48    220.7083    5.953868    41.24961    208.7307     232.686
     Yes |      48    236.0833    6.501557    45.04411    223.0039    249.1628
---------+--------------------------------------------------------------------
combined |      96    228.3958    4.455026    43.65016    219.5515    237.2402
---------+--------------------------------------------------------------------
    diff |             -15.375    8.815826               -32.87903    2.129029
------------------------------------------------------------------------------
    diff = mean(No) - mean(Yes)                                   t =  -1.7440
Ho: diff = 0                                     degrees of freedom =       94

    Ha: diff &lt; 0                 Ha: diff != 0                 Ha: diff &gt; 0
 Pr(T &lt; t) = 0.0422         Pr(|T| &gt; |t|) = 0.0844          Pr(T &gt; t) = 0.9578

no; data in memory would be lost
r(4);

</pre>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta, <span style="color: #a020f0;">clear</span>
<span style="color: #008b8b;">set</span> <span style="color: #008b8b;">se</span><span style="color: #228b22;">ed</span> 72576466
quietly <span style="color: #a020f0;">sample</span> 49, <span style="color: #008b8b;">count</span> <span style="color: #228b22;">by</span>(hyperten)
graph box totchol1, <span style="color: #228b22;">by</span>(hyperten)
</pre>


<p>
<img src="dep.png"  alt="dep.png" />
</p>
</div>

</div>

<div id="outline-container-9-2" class="outline-4">
<h4 id="sec-9-2">Two-Sample t-test</h4>
<div class="outline-text-4" id="text-9-2">

<p>Schiff et al. (1990) investigated the effect of low doses of aspirin
on women with mild pregnancy-induced hypertension. Forty-seven women
hospitalized at 30-36 weeks gestation because of mild
pregnancy-induced hypertension were treated by a daily dose of either
100 mg aspirin or placebo. The <b>23 women</b> who received aspirin had a
mean arterial blood pressure of <b>111 mm Hg</b> with a standard deviation
of <b>8 mm Hg</b>. The <b>24 women</b> who received placebo had a mean arterial
blood pressure of <b>109 mm Hg</b> and a standard deviation of <b>8 mm Hg</b>.
</p>
<p>
Source: Schiff, E., Barkai,G., Ben-Baruch G., and Mashiach, S.,
"Low-Dose Aspirin Does Not Influence the Clinical Course of Women with
Mild Pregnancy-Induced Hypertension," Obstetrics and Gynecology,
Vol. 76, November 1990, 742-744.
</p>
<ul>
<li id="sec-9-2-1">Q1<br/>
Conduct a two sample t-test with equal variances at \(\alpha = 0.05\)
to test whether the population mean arterial blood pressure for women
treated with aspirin is equal to the population mean arterial blood
pressure for women treated with placebo. What is the value of the test
statistic?

</li>
</ul>
<ul>
<li id="sec-9-2-2">Q2<br/>
How many degrees of freedom does your test statistic have?

</li>
</ul>
<ul>
<li id="sec-9-2-3">Q3<br/>
The p-value for this test is greater than 0.05. Based on this
result can we conclude that the population mean arterial blood
pressure for pregnant women treated with aspirin is equal to the
population mean arterial blood pressure for pregnant women treated
with placebo? A) Yes B) No




<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> obs1</span> = 23
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean1</span> = 111
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd1</span> = 8
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> obs2</span> = 24
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean2</span> = 109
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd2</span> = 8
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> level</span> = 95
ttesti `<span style="color: #a0522d;">obs1</span>' `<span style="color: #a0522d;">mean1</span>' `<span style="color: #a0522d;">sd1</span>' `<span style="color: #a0522d;">obs2</span>' `<span style="color: #a0522d;">mean2</span>' `<span style="color: #a0522d;">sd2</span>', level(`<span style="color: #a0522d;">level</span>')
di <span style="color: #8b2252;">"================== answers ===================="</span>
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"the test statistic = "</span> <span style="color: #008b8b;">as</span> result <span style="color: #008b8b;">r</span>(t)
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"degrees of freedom = "</span> <span style="color: #008b8b;">as</span> result <span style="color: #008b8b;">r</span>(df_t)
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"two-sided p-value = "</span> <span style="color: #008b8b;">as</span> result  <span style="color: #008b8b;">r</span>(p)
<span style="color: #008b8b;">if</span> <span style="color: #008b8b;">r</span>(p)&gt;1-`<span style="color: #a0522d;">level</span>'/100 {
    <span style="color: #008b8b;">di</span> <span style="color: #8b2252;">"We reject H0: mean(x)==mean(y)"</span>
} 
<span style="color: #008b8b;">else</span> {
  <span style="color: #008b8b;">di</span> <span style="color: #8b2252;">"We cannot reject H0: mean(x)==mean(y)"</span>
}
</pre>



<pre class="example">
Two-sample t test with equal variances
------------------------------------------------------------------------------
         |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |      23         111    1.668115           8    107.5405    114.4595
       y |      24         109    1.632993           8    105.6219    112.3781
---------+--------------------------------------------------------------------
combined |      47    109.9787    1.163542     7.97684    107.6366    112.3208
---------+--------------------------------------------------------------------
    diff |                   2    2.334368               -2.701659    6.701659
------------------------------------------------------------------------------
    diff = mean(x) - mean(y)                                      t =   0.8568
Ho: diff = 0                                     degrees of freedom =       45

    Ha: diff &lt; 0                 Ha: diff != 0                 Ha: diff &gt; 0
 Pr(T &lt; t) = 0.8019         Pr(|T| &gt; |t|) = 0.3961          Pr(T &gt; t) = 0.1981

================== answers ====================

the test statistic = .85676283

degrees of freedom = 45

two-sided p-value = .39611566

We reject H0: mean(x)==mean(y)

</pre>


</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-10" class="outline-3">
<h3 id="sec-10">Lecture 7</h3>
<div class="outline-text-3" id="text-10">


</div>

<div id="outline-container-10-1" class="outline-4">
<h4 id="sec-10-1"><span class="todo TODO">TODO</span> Inference for proportions</h4>
<div class="outline-text-4" id="text-10-1">

<ul>
<li id="sec-10-1-1">Q1<br/>
Construct a 95% confidence interval for <b>the proportion</b> of infants
experiencing <b>the composite outcome</b> in <b>the fresh</b> red blood cell
group, using the following methods: exact binomial, Wilson normal
approximation.

</li>
</ul>
<ul>
<li id="sec-10-1-2">Q2<br/>
Is the normal approximation to the binomial appropriate in this
setting?  <code>I need the number of observations with fresh==1 and fresh==0</code>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta, <span style="color: #a020f0;">clear</span>
<span style="color: #008b8b;">ci</span> outcome if fresh==1, binomial
<span style="color: #008b8b;">ci</span> outcome if fresh==1, binomial wilson
</pre>



<pre class="example">
                                                         -- Binomial Exact --
    Variable |        Obs        Mean    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
     outcome |        188    .5265957    .0364146        .4526364    .5997032

                                                         ------ Wilson ------
    Variable |        Obs        Mean    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
     outcome |        188    .5265957    .0364146         .455408    .5967184

</pre>


</li>
</ul>
<ul>
<li id="sec-10-1-3">Q3<br/>
Suppose you wanted to calculate a 95% confidence interval for
infants experiencing intraventricular hemorrhage after receiving a
fresh blood transfusion as well. Examine the table above. Is the
Wilson confidence interval still appropriate?

</li>
</ul>
<ul>
<li id="sec-10-1-4">Q4<br/>
Estimate and construct a large-sample 95% confidence interval for
the risk difference for experiencing the composite outcome for those
with fresh blood versus the standard protocol blood. Calculate the
risk difference as the estimated proportion in the fresh blood group
minus estimated proportion in the standard blood group.



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta
<span style="color: #a020f0;">gen</span> nfresh = 1-fresh
prtest outcome, <span style="color: #008b8b;">by</span> (nfresh)
</pre>



<pre class="example">
Two-sample test of proportions                     0: Number of obs =      188
                                                   1: Number of obs =      189
------------------------------------------------------------------------------
    Variable |       Mean   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           0 |   .5265957   .0364146                      .4552244    .5979671
           1 |   .5291005    .036308                      .4579382    .6002629
-------------+----------------------------------------------------------------
        diff |  -.0025048   .0514227                     -.1032915    .0982819
             |  under Ho:   .0514228    -0.05   0.961
------------------------------------------------------------------------------
        diff = prop(0) - prop(1)                                  z =  -0.0487
    Ho: diff = 0

    Ha: diff &lt; 0                 Ha: diff != 0                 Ha: diff &gt; 0
 Pr(Z &lt; z) = 0.4806         Pr(|Z| &lt; |z|) = 0.9612          Pr(Z &gt; z) = 0.5194

no; data in memory would be lost
r(4);

</pre>


</li>
</ul>
<ul>
<li id="sec-10-1-5">Q5<br/>
Use a two-sample test of proportions to test whether there is a
difference in the proportion of infants experiencing the composite
outcome between fresh blood group and the standard protocol group at
\(\alpha=0.05\) the level of significance.

<p>
What is the value of the test statistic?
What is the p-value?
</p>


<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta
<span style="color: #a020f0;">gen</span> nfresh = 1-fresh
prtest outcome, <span style="color: #008b8b;">by</span> (nfresh)
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z</span> = <span style="color: #008b8b;">r</span>(z)
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> P</span> = 1 - (normal(<span style="color: #008b8b;">abs</span>(`<span style="color: #a0522d;">z</span>'))-normal(-<span style="color: #008b8b;">abs</span>(`<span style="color: #a0522d;">z</span>')))
display <span style="color: #8b2252;">"==================== answers ===================="</span>
display <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"test statistic = "</span> <span style="color: #008b8b;">as</span> result  `<span style="color: #a0522d;">z</span>'
display <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"Pr(|Z| &lt; |z|) = "</span> <span style="color: #008b8b;">as</span> result  `<span style="color: #a0522d;">P</span>'
</pre>



<pre class="example">
Two-sample test of proportions                     0: Number of obs =      188
                                                   1: Number of obs =      189
------------------------------------------------------------------------------
    Variable |       Mean   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           0 |   .5265957   .0364146                      .4552244    .5979671
           1 |   .5291005    .036308                      .4579382    .6002629
-------------+----------------------------------------------------------------
        diff |  -.0025048   .0514227                     -.1032915    .0982819
             |  under Ho:   .0514228    -0.05   0.961
------------------------------------------------------------------------------
        diff = prop(0) - prop(1)                                  z =  -0.0487
    Ho: diff = 0

    Ha: diff &lt; 0                 Ha: diff != 0                 Ha: diff &gt; 0
 Pr(Z &lt; z) = 0.4806         Pr(|Z| &lt; |z|) = 0.9612          Pr(Z &gt; z) = 0.5194

==================== answers ====================

test statistic = -.04870957

Pr(|Z| &lt; |z|) = .96115075

no; data in memory would be lost
r(4);

</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-10-2" class="outline-4">
<h4 id="sec-10-2"><span class="todo TODO">TODO</span> Contingency Tables</h4>
<div class="outline-text-4" id="text-10-2">

<p>Continue using the Fergusson et al. (2012) clinical trial data to
complete the following questions. Again, use either the dataset from
the previous question, hw7.dta, or the study results in the table
below.
<code>table is missing</code>
</p>
<ul>
<li id="sec-10-2-1">Q1<br/>
Estimate the odds ratio and a 95% confidence interval for
experiencing the composite outcome for those in the fresh blood group
versus standard protocol blood group.

<p>
OR Estimate:
95% Confidence Interval:
</p>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta, <span style="color: #a020f0;">clear</span>
<span style="color: #008b8b;">cs</span> outcome fresh, or woolf
</pre>



<pre class="example">
                 | fresh                  |
                 |   Exposed   Unexposed  |      Total
-----------------+------------------------+------------
           Cases |        99         100  |        199
        Noncases |        89          89  |        178
-----------------+------------------------+------------
           Total |       188         189  |        377
                 |                        |
            Risk |  .5265957    .5291005  |   .5278515
                 |                        |
                 |      Point estimate    |    [95% Conf. Interval]
                 |------------------------+------------------------
 Risk difference |        -.0025048       |   -.1032915    .0982819 
      Risk ratio |          .995266       |    .8222696    1.204659 
 Prev. frac. ex. |          .004734       |   -.2046588    .1777304 
 Prev. frac. pop |         .0023607       |
      Odds ratio |              .99       |    .6607011    1.483424 (Woolf)
                 +-------------------------------------------------
                               chi2(1) =     0.00  Pr&gt;chi2 = 0.9612

</pre>


</li>
</ul>
<ul>
<li id="sec-10-2-2">Q2<br/>
Construct a 2x2 table for the composite outcome versus blood
group. Are the expected cell counts large enough to conduct a Pearson
Chi-square test?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta, <span style="color: #a020f0;">clear</span>
tabulate outcome fresh, row expected
</pre>



<pre class="example">
+--------------------+
| Key                |
|--------------------|
|     frequency      |
| expected frequency |
|   row percentage   |
+--------------------+

           |         fresh
   outcome |         0          1 |     Total
-----------+----------------------+----------
         0 |        89         89 |       178 
           |      89.2       88.8 |     178.0 
           |     50.00      50.00 |    100.00 
-----------+----------------------+----------
         1 |       100         99 |       199 
           |      99.8       99.2 |     199.0 
           |     50.25      49.75 |    100.00 
-----------+----------------------+----------
     Total |       189        188 |       377 
           |     189.0      188.0 |     377.0 
           |     50.13      49.87 |    100.00 

</pre>


</li>
</ul>
<ul>
<li id="sec-10-2-3">Q3<br/>
Using the Pearson chi-square test, determine if there is evidence
of an association between blood group and the composite outcome at the
level of significance.  What is the value of the test statistic? Round
your answer to two decimal places.




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta, <span style="color: #a020f0;">clear</span>
tabulate outcome fresh, expected chi2
</pre>



<pre class="example">
+--------------------+
| Key                |
|--------------------|
|     frequency      |
| expected frequency |
+--------------------+

           |         fresh
   outcome |         0          1 |     Total
-----------+----------------------+----------
         0 |        89         89 |       178 
           |      89.2       88.8 |     178.0 
-----------+----------------------+----------
         1 |       100         99 |       199 
           |      99.8       99.2 |     199.0 
-----------+----------------------+----------
     Total |       189        188 |       377 
           |     189.0      188.0 |     377.0 

          Pearson chi2(1) =   0.0024   Pr = 0.961

</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-10-3" class="outline-4">
<h4 id="sec-10-3">Final Thoughts on the Blood Transfusion Trial</h4>
<div class="outline-text-4" id="text-10-3">

<ul>
<li id="sec-10-3-1">Q4<br/>
In this study, the authors state that they powered the study to
detect an absolute difference of 15% in the two groups with 80% power,
using a 2-sided test with . After a few more adjustments, their final
sample size calculation was 450. Now suppose you want to replicate the
study using a different population. Given that the authors did not
find an association in their data, you decide to increase the power
and decrease the difference detected between standard and fresh
groups. Using an equal number of infants in both groups, what is the
total sample size needed in order to achieve 90% power, assuming that
the proportion of infants experiencing the composite outcome in the
standard group was 55% and 45% in the fresh blood group (again, with
).




<pre class="src src-stata">sampsi .55 .45, <span style="color: #008b8b;">alpha</span>(0.05) power(0.90)
display <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"total sample size: "</span> <span style="color: #008b8b;">as</span> result <span style="color: #008b8b;">r</span>(N_1) + <span style="color: #008b8b;">r</span>(N_2)
</pre>



<pre class="example">
Estimated sample size for two-sample comparison of proportions

Test Ho: p1 = p2, where p1 is the proportion in population 1
                    and p2 is the proportion in population 2
Assumptions:

         alpha =   0.0500  (two-sided)
         power =   0.9000
            p1 =   0.5500
            p2 =   0.4500
         n2/n1 =   1.00

Estimated required sample sizes:

            n1 =      544
            n2 =      544

total sample size: 1088

</pre>


</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-11" class="outline-3">
<h3 id="sec-11">Lecture 8</h3>
<div class="outline-text-3" id="text-11">


</div>

<div id="outline-container-11-1" class="outline-4">
<h4 id="sec-11-1">Survey Design</h4>
<div class="outline-text-4" id="text-11-1">

<ul>
<li id="sec-11-1-1">Q1<br/>
Suppose you decided to randomly sample 1,700 people from the city
of Boston (call this Design 1). For any given individual in South
Dorchester, what is the probability of being selected in the survey?
What is this probability for an individual in Harbor Islands?

</li>
</ul>
<ul>
<li id="sec-11-1-2">Q3<br/>
Now, you randomly sample 100 people within each neighborhood
(Design 2). What is the probability of a random individual in South
Dorchester being sampled? What is the probability of a randomly
selected individual in Harbor Islands being sampled?

</li>
</ul>
<ul>
<li id="sec-11-1-3">Q8<br/>
Next, you decide you do not want to visit all 17 neighborhoods, so
you randomly sample 10 neighborhoods. Within each sampled neighborhood
selected, you randomly sample 170 people. Call this Design 4. What is
the probability of a random individual in South Dorchester being
included in the survey? What is the probability of a random individual
in Harbor Islands being included in the survey?



<pre class="src src-stata">quietly <span style="color: #a020f0;">insheet</span> <span style="color: #008b8b;">using</span> <span style="color: #8b2252;">"datasets/boston.csv"</span>
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nsel_d1</span> = 1000
quietly <span style="color: #008b8b;">sum</span> pop
display <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"P (design 1, both): "</span> <span style="color: #008b8b;">as</span> result `<span style="color: #a0522d;">nsel_d1</span>'/<span style="color: #008b8b;">r</span>(mean)

<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nsel_d2</span> = 100
quietly <span style="color: #008b8b;">sum</span> pop if neighborhood==<span style="color: #8b2252;">"South Dorchester"</span>
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"P (design 2, South Dorchester): "</span> <span style="color: #008b8b;">as</span> result `<span style="color: #a0522d;">nsel_d2</span>'/<span style="color: #008b8b;">r</span>(mean)
quietly <span style="color: #008b8b;">sum</span> pop if neighborhood==<span style="color: #8b2252;">"Harbor Islands"</span>
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"P (design 2, Harbor Islands): "</span> <span style="color: #008b8b;">as</span> result `<span style="color: #a0522d;">nsel_d2</span>'/<span style="color: #008b8b;">r</span>(mean)

<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nn_d4</span> = 10
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nsel_d4</span> = 170
quietly <span style="color: #008b8b;">sum</span> pop if neighborhood==<span style="color: #8b2252;">"South Dorchester"</span>
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"P (design 2, South Dorchester): "</span> <span style="color: #008b8b;">as</span> result `<span style="color: #a0522d;">nsel_d4</span>'/<span style="color: #008b8b;">r</span>(mean)*`<span style="color: #a0522d;">nn_d4</span>'/<span style="color: #a0522d;">_N</span>
quietly <span style="color: #008b8b;">sum</span> pop if neighborhood==<span style="color: #8b2252;">"Harbor Islands"</span>
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"P (design 2, Harbor Islands): "</span> <span style="color: #008b8b;">as</span> result `<span style="color: #a0522d;">nsel_d4</span>'/<span style="color: #008b8b;">r</span>(mean)*`<span style="color: #a0522d;">nn_d4</span>'/<span style="color: #a0522d;">_N</span>
</pre>



<pre class="example">
P (design 1, both): .02752617

P (design 2, South Dorchester): .00166808

P (design 2, Harbor Islands): .18691589

P (design 2, South Dorchester): .00166808

P (design 2, Harbor Islands): .18691589

no; data in memory would be lost
r(4);

</pre>


</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-12" class="outline-3">
<h3 id="sec-12"><span class="todo TODO">TODO</span> Lecture 9</h3>
<div class="outline-text-3" id="text-12">


</div>

<div id="outline-container-12-1" class="outline-4">
<h4 id="sec-12-1">Trends in Unemployment</h4>
<div class="outline-text-4" id="text-12-1">

<p>We again use publicly available data from the World Banks website to
examine national trends in unemployment percentages (percent
unemployed in total labor force) in four countries: the United States,
Great Britain, Japan, and Canada.
</p>
<p>
In this question, we examine unemployment trends over time using a
correlation analysis, focusing primarily on the United States and
Japan.
</p>
<p>
Use the dataset UnemploymentbyCountry.dta to answer the following
questions.
</p>
<ul>
<li id="sec-12-1-1">Q1<br/>
Calculate the Pearson and Spearman correlations between total
unemployment and year for the United States and for Japan.




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/UnemploymentbyCountry.b41235ad3be6.dta
pwcorr unemployedtotal year if country==<span style="color: #8b2252;">"Japan"</span>
pwcorr unemployedtotal year if country==<span style="color: #8b2252;">"United States"</span>
</pre>



<pre class="example">
(World Bank, World Dev. Indicators &amp; Global Dev. Finance: Int. Labour Org)

             | unempl~l     year
-------------+------------------
unemployed~l |   1.0000 
        year |   0.8437   1.0000 

             | unempl~l     year
-------------+------------------
unemployed~l |   1.0000 
        year |  -0.3415   1.0000 

</pre>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/UnemploymentbyCountry.b41235ad3be6.dta
spearman unemployedtotal year if country==<span style="color: #8b2252;">"Japan"</span>
spearman unemployedtotal year if country==<span style="color: #8b2252;">"United States"</span>
</pre>


<pre class="example">
(World Bank, World Dev. Indicators &amp; Global Dev. Finance: Int. Labour Org)

 Number of obs =      31
Spearman's rho =       0.8162

Test of Ho: unemployedtotal and year are independent
    Prob &gt; |t| =       0.0000

 Number of obs =      31
Spearman's rho =      -0.4517

Test of Ho: unemployedtotal and year are independent
    Prob &gt; |t| =       0.0107

</pre>


</li>
</ul>
<ul>
<li id="sec-12-1-2">Q2<br/>
Exclude all years after 2007 (recall that the financial collapse
occurred in late 2008). Recalculate the correlations in
question 1. (Hint: use an "if" command to restrict to certain years in
Stata.)





<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/UnemploymentbyCountry.b41235ad3be6.dta
pwcorr unemployedtotal year if country==<span style="color: #8b2252;">"Japan"</span> &amp;&amp; year&lt;=2007
pwcorr unemployedtotal year if country==<span style="color: #8b2252;">"United States"</span> &amp;&amp; year&lt;=2007
</pre>



<pre class="example">
(World Bank, World Dev. Indicators &amp; Global Dev. Finance: Int. Labour Org)

             | unempl~l     year
-------------+------------------
unemployed~l |   1.0000 
        year |   0.8276   1.0000 

             | unempl~l     year
-------------+------------------
unemployed~l |   1.0000 
        year |  -0.7557   1.0000 

</pre>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/UnemploymentbyCountry.b41235ad3be6.dta
spearman unemployedtotal year if country==<span style="color: #8b2252;">"Japan"</span> &amp;&amp; year&lt;=2007
spearman unemployedtotal year if country==<span style="color: #8b2252;">"United States"</span> &amp;&amp; year&lt;=2007
</pre>



<pre class="example">
(World Bank, World Dev. Indicators &amp; Global Dev. Finance: Int. Labour Org)

 Number of obs =      28
Spearman's rho =       0.7998

Test of Ho: unemployedtotal and year are independent
    Prob &gt; |t| =       0.0000

 Number of obs =      28
Spearman's rho =      -0.7733

Test of Ho: unemployedtotal and year are independent
    Prob &gt; |t| =       0.0000

</pre>


</li>
</ul>
<ul>
<li id="sec-12-1-3">Q3<br/>
Construct a scatter plot with year on the x-axis and with both
unemployment in the United States and unemployment in Japan on the
y-axis. (Hint: try plotting different symbols for the United States
and Japan by creating two different plots within the Twoway graphs
window; restrict to a specific country by using an "if" statement
within each plot window).





<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/UnemploymentbyCountry.b41235ad3be6.dta
twoway  (scatter unemployedtotal year if country==<span style="color: #8b2252;">"Japan"</span>) <span style="color: #b22222;">///</span>
(scatter unemployedtotal year if country==<span style="color: #8b2252;">"United States"</span>), <span style="color: #b22222;">///</span>
legend( label(1 <span style="color: #8b2252;">"Japan"</span>) label(2 <span style="color: #8b2252;">"United States"</span>) )
</pre>


<p>
<img src="jappan-s.png"  alt="jappan-s.png" />
</p>
</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-13" class="outline-3">
<h3 id="sec-13"><span class="todo TODO">TODO</span> Lecture 10</h3>
<div class="outline-text-3" id="text-13">


</div>

<div id="outline-container-13-1" class="outline-4">
<h4 id="sec-13-1">Simple Linear Regression</h4>
<div class="outline-text-4" id="text-13-1">

<p> We use data from the Environmental Protection Agency (EPA) to track
 the BP oil spill in Louisiana between May and September 2010. The oil
 well exploded on April 20, 2010, was capped in July and was declared
 dead in September 2010. The oil spill killed wildlife in the Gulf of
 Mexico and posed a significant public health risk to clean-up workers
 and residents of the Gulf Coast (Solomon and Janssen 2010). The EPA
 monitored air quality and took samples of sediment to measure the
 impact of the oil spill. For more information from the EPA, visit
 <a href="http://www.epa.gov/bpspill/sediment.html#understanding">http://www.epa.gov/bpspill/sediment.html#understanding</a>.
</p>
<p>
*Solomon G., Janssen S. (2010). Health Effects of the Gulf Oil
 Spill. JAMA. (<a href="http://dx.doi.org/doi:10.1001/jama.2010.1254">doi:10.1001/jama.2010.1254</a>)
</p>
<p>
Use the dataset oilspill.dta to answer the following questions.
</p>
<p>
Simple Linear Regression. In this example, we track changes in the
amount of nickel found in sediment along the Louisiana coast between
May and September 2010 (note that there is no data from July). Nickel
is a metal that is found in sediment contaminated with oil. We model
the amount of nickel as a function of time (month) using linear
regression.
</p>
<p>
Fit a linear regression model with nickel as the outcome and month as
the explanatory variable. Using indicator variables, model month as a
categorical covariate (i.e. for the variable "month", it is coded
numerically as May = 5, June = 6, August = 8, September = 9). Call
this <b>Model 1</b>.
</p>
<p>
Assume the assumptions of linear regression are met for this
model. You can make histograms of nickel by month to visually verify
that the data does not appear to be skewed or any other evidence that
would suggest a violation of the assumptions necessary to analyze this
data using linear regression.
</p>
<ul>
<li id="sec-13-1-1">Q1<br/>
Does the amount of nickel in the soil tend to increase over the
four month period? <code>TODO: make a histogram plot</code>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
twoway (scatter nickel month) (lfit nickel month)
</pre>


<p>
<img src="oil-scatter.png"  alt="oil-scatter.png" />
</p>

</li>
</ul>
<ul>
<li id="sec-13-1-2">Q2<br/>
Examine the regression coefficients. Compare how the average nickel
amount changes by month. Is it reasonable to assume that average
amount of nickel increases linearly by month?

</li>
</ul>
<ul>
<li id="sec-13-1-3">Q3<br/>
Make a residual plot.



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
<span style="color: #a020f0;">xi</span>: <span style="color: #008b8b;">regress</span> nickel i.month
rvfplot
</pre>


<p>
<img src="oil-res.png"  alt="oil-res.png" />
</p>

<p>
Now, assume the amount of nickel increases linearly by month, and the
assumptions of linear regression continue to hold. Fit a model with
nickel as the outcome and month modeled as a continuous explanatory
variable. Call this <b>Model 2</b>.
</p>
</li>
</ul>
<ul>
<li id="sec-13-1-4">Q4<br/>
Using <b>Model 2</b>, it is estimated that, on average, nickel increases
by ______ each month, from May to September.



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
<span style="color: #a020f0;">xi</span>: <span style="color: #008b8b;">regress</span> nickel i.month
</pre>



<pre class="example">
i.month           _Imonth_5-9         (naturally coded; _Imonth_5 omitted)

      Source |       SS       df       MS              Number of obs =     248
-------------+------------------------------           F(  3,   244) =    7.39
       Model |  1593.53316     3  531.177721           Prob &gt; F      =  0.0001
    Residual |  17536.6077   244  71.8713429           R-squared     =  0.0833
-------------+------------------------------           Adj R-squared =  0.0720
       Total |  19130.1408   247  77.4499629           Root MSE      =  8.4777

------------------------------------------------------------------------------
      nickel |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   _Imonth_6 |   1.740536   1.975111     0.88   0.379    -2.149906    5.630979
   _Imonth_8 |   4.265023   1.384627     3.08   0.002     1.537675     6.99237
   _Imonth_9 |   7.109776   1.581158     4.50   0.000     3.995315    10.22424
       _cons |   13.69724   1.113176    12.30   0.000     11.50458     15.8899
------------------------------------------------------------------------------

</pre>



</li>
</ul>
<ul>
<li id="sec-13-1-5">Q5<br/>
What is the 95% confidence interval for the average increase in
nickel each month?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
regress nickel month
</pre>



<pre class="example">
      Source |       SS       df       MS              Number of obs =     248
-------------+------------------------------           F(  1,   246) =   21.47
       Model |  1535.60852     1  1535.60852           Prob &gt; F      =  0.0000
    Residual |  17594.5323   246  71.5224891           R-squared     =  0.0803
-------------+------------------------------           Adj R-squared =  0.0765
       Total |  19130.1408   247  77.4499629           Root MSE      =  8.4571

------------------------------------------------------------------------------
      nickel |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       month |   1.642664   .3545111     4.63   0.000     .9443998    2.340928
       _cons |   5.335122   2.646702     2.02   0.045     .1220335    10.54821
------------------------------------------------------------------------------

</pre>



</li>
</ul>
<ul>
<li id="sec-13-1-6">Q6<br/>
Given that the relationship between month and nickel appears to be
linear, is it reasonable to use Model 2 to predict the amount of
nickel in the soil in July 2010?

</li>
</ul>
<ul>
<li id="sec-13-1-7">Q7<br/>
Given that the relationship between month and nickel appears to be
linear, is it reasonable to use Model 2 to predict the amount of
nickel in the soil in October 2010?

</li>
</ul>
<ul>
<li id="sec-13-1-8">Q8<br/>
What is the average amount of nickel in the soil during August
2010?  According to model 1 (Hint: Think about how dummy/indicator
variables are coded.)




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
quietly <span style="color: #008b8b;">regress</span> nickel month
 *** to extract coefficients from matrix  ***
mat beta=<span style="color: #008b8b;">e</span>(b)
<span style="color: #a020f0;">svmat</span> <span style="color: #228b22;">double</span> beta, names(matcol)
di <span style="color: #008b8b;">as</span> text <span style="color: #8b2252;">"nickel increases in one month by "</span> <span style="color: #008b8b;">as</span> result  betamonth[1]
</pre>


<pre class="example">

nickel increases in one month by 1.642664

no; data in memory would be lost
r(4);

</pre>



</li>
</ul>
<ul>
<li id="sec-13-1-9">Q9<br/>
True or False: <b>Model 1</b> makes stronger modeling assumptions
than <b>Model 2</b>.

</li>
</ul>
</div>

</div>

<div id="outline-container-13-2" class="outline-4">
<h4 id="sec-13-2">High Blood Pressure and CHD Incidence</h4>
<div class="outline-text-4" id="text-13-2">

<p>Use Stata and the NHLBI data set to create the two categories of high
blood pressure (highbp1)
</p>

<ul>
<li id="sec-13-2-1">Q1<br/>
What is the incidence rate ratio of stroke comparing those with
high blood pressure to those without high blood pressure? Hint: The
variable for stroke in the dataset is "stroke" and the number of years
a person was followed for stroke is recorded in the "timestrk"
variable.




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly <span style="color: #a020f0;">generate</span> highbp1=.
quietly <span style="color: #a020f0;">replace</span> highbp1=1 if (sysbp1&gt;=140 | diabp1 &gt;= 90)
quietly <span style="color: #a020f0;">replace</span> highbp1=0 if (sysbp1&lt;140 &amp; diabp1&lt;90)
ir stroke highbp1 timestrk
</pre>


<pre class="example">
                 | highbp1                |
                 |   Exposed   Unexposed  |      Total
-----------------+------------------------+------------
Incident Stroke  |       255         160  |        415
Time [years] to  |  28887.76    59787.78  |   88675.54
-----------------+------------------------+------------
                 |                        |
  Incidence rate |  .0088273    .0026761  |     .00468
                 |                        |
                 |      Point estimate    |    [95% Conf. Interval]
                 |------------------------+------------------------
 Inc. rate diff. |         .0061511       |    .0049911    .0073112 
 Inc. rate ratio |         3.298517       |    2.696321    4.045047 (exact)
 Attr. frac. ex. |         .6968334       |    .6291243    .7527841 (exact)
 Attr. frac. pop |         .4281748       |
                 +-------------------------------------------------
                     (midp)   Pr(k&gt;=255) =                   0.0000 (exact)
                     (midp) 2*Pr(k&gt;=255) =                   0.0000 (exact)

no; data in memory would be lost
r(4);

</pre>


</li>
</ul>
<ul>
<li id="sec-13-2-2">Q2<br/>
What is the incidence rate ratio (rounded to two decimal points)
for the association between high blood pressure (highbp1) and the rate
of stroke among men? Hint: Use the variable (sex1).

</li>
</ul>
<ul>
<li id="sec-13-2-3">Q3<br/>
What is the incidence rate ratio (rounded to two decimal points)
for the association between high blood pressure (highbp1) and the rate
of stroke among women?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly <span style="color: #a020f0;">generate</span> highbp1=.
quietly <span style="color: #a020f0;">replace</span> highbp1=1 if (sysbp1&gt;=140 | diabp1 &gt;= 90)
quietly <span style="color: #a020f0;">replace</span> highbp1=0 if (sysbp1&lt;140 &amp; diabp1&lt;90)
ir stroke highbp1 timestrk, <span style="color: #228b22;">by</span>(sex1)
</pre>



<pre class="example">
     Sex, exam 1 |      IRR       [95% Conf. Interval]   M-H Weight
-----------------+-------------------------------------------------
            Male |   2.273711      1.697105   3.048007     29.75741 (exact)
          Female |    4.74629      3.537425   6.429301     21.94115 (exact)
-----------------+-------------------------------------------------
           Crude |   3.298517      2.696321   4.045047              (exact)
    M-H combined |   3.323088      2.725029   4.052401
-------------------------------------------------------------------
 Test of homogeneity (M-H)    chi2(1) =     12.84  Pr&gt;chi2 = 0.0003

no; data in memory would be lost
r(4);

</pre>


</li>
</ul>
</div>
</div>
</div>
</div>

<div id="postamble">
</div>
</div>
</body>
</html>
