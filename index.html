<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Home works for PH207x Health in Numbers</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Home works for PH207x Health in Numbers"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2013-01-07T22:51+0100"/>
<meta name="author" content="Sergey Litvinov"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><link rel="stylesheet" type="text/css" href="http://sachachua.com/blog/wp-content/themes/sacha-v3/style.css" />
<link rel="stylesheet" type="text/css" href="http://sachachua.com/org-export.css" />
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
            config: ["MMLorHTML.js"], jax: ["input/TeX"],
        //  jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "left",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>

<div id="preamble">
<div class="org-export">
</div>

<div id="content">
<h1 class="title">Home works for PH207x Health in Numbers</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Links</a></li>
<li><a href="#sec-2">Basics</a></li>
<li><a href="#sec-3">Calculus</a>
<ul>
<li><a href="#sec-3-1">linear regression</a></li>
</ul>
</li>
<li><a href="#sec-4">Probability distribution functions</a>
<ul>
<li><a href="#sec-4-1">normal</a></li>
<li><a href="#sec-4-2">binomial</a></li>
<li><a href="#sec-4-3">student</a></li>
</ul>
</li>
<li><a href="#sec-5">Stata commands</a>
<ul>
<li><a href="#sec-5-1">ttest</a></li>
<li><a href="#sec-5-2">samsi</a></li>
<li><a href="#sec-5-3">signtest</a></li>
<li><a href="#sec-5-4">signrank</a></li>
<li><a href="#sec-5-5">lincom</a></li>
</ul>
</li>
<li><a href="#sec-6">Tutorial 10</a></li>
<li><a href="#sec-7">Tutorial 11</a></li>
<li><a href="#sec-8">Home Work 2</a>
<ul>
<li><a href="#sec-8-1">BMI and CHD prevalence</a></li>
<li><a href="#sec-8-2">Diabetes prevalence</a></li>
</ul>
</li>
<li><a href="#sec-9">Home Work 3</a>
<ul>
<li><a href="#sec-9-1">Probability and BMI</a></li>
<li><a href="#sec-9-2">Probability of age and smoking events</a></li>
<li><a href="#sec-9-3">Diagnostic Testing.</a></li>
</ul>
</li>
<li><a href="#sec-10">Home Work 4</a>
<ul>
<li><a href="#sec-10-1">Titanic Survival Risk Ratios</a></li>
<li><a href="#sec-10-2">Risk Ratios, Odds Ratios, Rate Ratios for BMI, Death, and CHD</a></li>
</ul>
</li>
<li><a href="#sec-11">Home Work 5</a>
<ul>
<li><a href="#sec-11-1">Central Limit Theorem and Confidence Intervals</a></li>
<li><a href="#sec-11-2">Hypothesis Testing with known Variance</a></li>
<li><a href="#sec-11-3">Confidence intervals and testing with unknown variance</a></li>
</ul>
</li>
<li><a href="#sec-12">Home Work 6</a>
<ul>
<li><a href="#sec-12-1">Power and Sample Size</a></li>
<li><a href="#sec-12-2">Two-Sample t-test</a></li>
</ul>
</li>
<li><a href="#sec-13">Home Work 7</a>
<ul>
<li><a href="#sec-13-1">Inference for proportions</a></li>
<li><a href="#sec-13-2">Contingency Tables</a></li>
<li><a href="#sec-13-3">Final Thoughts on the Blood Transfusion Trial</a></li>
</ul>
</li>
<li><a href="#sec-14">Home Work 8</a>
<ul>
<li><a href="#sec-14-1">Survey Design</a></li>
</ul>
</li>
<li><a href="#sec-15">Home Work 9</a>
<ul>
<li><a href="#sec-15-1">Trends in Unemployment</a></li>
<li><a href="#sec-15-2">Nonparametric Tests</a></li>
<li><a href="#sec-15-3">Obesity and Rate of Stroke</a></li>
</ul>
</li>
<li><a href="#sec-16">Home Work 10</a>
<ul>
<li><a href="#sec-16-1">Simple Linear Regression</a></li>
<li><a href="#sec-16-2">Multiple Linear Regression</a></li>
<li><a href="#sec-16-3">More Regression</a></li>
<li><a href="#sec-16-4">High Blood Pressure and CHD Incidence</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">Links</h3>
<div class="outline-text-3" id="text-1">

<p><a href="http://www.ats.ucla.edu/stat/sas/whatstat/default.htm">What statistical analysis should I use?</a>
</p>
<p>
<a href="http://www.stata.com/capabilities/sample-session/">A sample session</a>
</p>
<p>
<a href="http://www.ssc.wisc.edu/sscc/pubs/stata_prog1.htm">Stata Programming Essentials</a>
</p></div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">Basics</h3>
<div class="outline-text-3" id="text-2">




<pre class="src src-stata">di <span style="color: #8b2252;">"hello world"</span>
</pre>


<pre class="example">

hello world

</pre>


<p>
Use macro definition
</p>


<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 41
di `<span style="color: #a0522d;">N</span>'+1
</pre>


<pre class="example">

42

</pre>


<p>
Display result with two decimal points
</p>


<pre class="src src-stata">di <span style="color: #8b2252;">"Result: "</span> %8.2f -100/3
</pre>


<pre class="example">

Result:   -33.33

</pre>




<p>
<code>quietly</code> suppresses output for the duration of command
</p>


<pre class="src src-stata">quietly set obs 5
<span style="color: #a020f0;">gen</span> x = <span style="color: #228b22;">_n</span>
describe
</pre>



<pre class="example">
Contains data
  obs:             5                          
 vars:             1                          
 size:            20                          
-------------------------------------------------------------------------------
              storage  display     value
variable name   type   format      label      variable label
-------------------------------------------------------------------------------
x               float  %9.0g                  
-------------------------------------------------------------------------------
Sorted by:  
     Note:  dataset has changed since last saved

</pre>


<p>
One can use <code>r(...)</code> or <code>e(...)</code> to get output from stata commands
</p>


<pre class="src src-stata">quietly { 
<span style="color: #008b8b;">  set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">5</span>
  <span style="color: #a020f0;">gen</span> x = <span style="color: #228b22;">_n</span>
  <span style="color: #008b8b;">summarize</span> x
}
di <span style="color: #8b2252;">"mean: "</span> <span style="color: #008b8b;">r</span>(mean)
di <span style="color: #8b2252;">"std:  "</span> <span style="color: #008b8b;">r</span>(sd)
</pre>


<pre class="example">

mean: 3

std:  1.5811388

</pre>


<p>
Multi-line command
</p>


<pre class="src src-stata">di <span style="color: #b22222;">///</span>
   <span style="color: #8b2252;">"test"</span>
</pre>


<pre class="example">

test

</pre>


<p>
Produce scatter plot
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">7</span>
<span style="color: #a020f0;">gen</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">gen</span> y = x^2
graph scatter y x
</pre>


<p>
<img src="stata-sq.png"  alt="stata-sq.png" />
</p>
<p>
Plot a function
</p>


<pre class="src src-stata">twoway function <span style="color: #008b8b;">sin</span>(x), <span style="color: #a020f0;">range</span>(0 10)
</pre>


<p>
<img src="fun.png"  alt="fun.png" />
</p>
<p>
Plot two functions
</p>


<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> rng</span> <span style="color: #a020f0;">range</span>(-12 12)
twoway (function <span style="color: #008b8b;">sin</span>(x), `<span style="color: #a0522d;">rng</span>')  (function <span style="color: #008b8b;">cos</span>(x), `<span style="color: #a0522d;">rng</span>')
</pre>


<p>
<img src="fun2.png"  alt="fun2.png" />
</p>
<p>
Bar Charts
</p>


<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nobs</span> = 10
<span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> `<span style="color: #a0522d;">nobs</span>'
<span style="color: #a020f0;">generate</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">gen</span> lev = 1 if <span style="color: #228b22;">_n</span>&lt;=`<span style="color: #a0522d;">nobs</span>'/2
<span style="color: #a020f0;">replace</span> lev = 0 if <span style="color: #228b22;">_n</span>&gt;`<span style="color: #a0522d;">nobs</span>'/2
graph bar x, over(lev)
</pre>


<p>
<img src="bar.png"  alt="bar.png" />
</p>
<p>
Histogram
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">1000</span>
<span style="color: #a020f0;">generate</span> x = rnormal()
twoway (histogram x, bin(20)) (function normalden(x), <span style="color: #a020f0;">range</span>(-4 4))
</pre>


<p>
<img src="hist.png"  alt="hist.png" />
</p>
<p>
Box plot
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">10</span>
<span style="color: #a020f0;">generate</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">generate</span> y = <span style="color: #228b22;">_n</span> + 1
graph box x y
</pre>


<p>
<img src="box.png"  alt="box.png" />
</p>
<p>
Horizontal box plot
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">10</span>
<span style="color: #a020f0;">generate</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">generate</span> y = <span style="color: #228b22;">_n</span> + 1
graph box x y, horizontal
</pre>


<p>
<img src="hbox.png"  alt="hbox.png" />
</p>
<p>
Combining separate graphs into one graph
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">10</span>
<span style="color: #a020f0;">generate</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">generate</span> y = <span style="color: #228b22;">_n</span> + 1
twoway (function normalden(x), <span style="color: #a020f0;">range</span>(-4 4)), name(f1)
twoway (function normal(x), <span style="color: #a020f0;">range</span>(-4 4)), name(f2)
graph combine f1 f2, row(2)
</pre>


<p>
<img src="combine.png"  alt="combine.png" />
</p>
</div>

</div>

<div id="outline-container-3" class="outline-3">
<h3 id="sec-3">Calculus</h3>
<div class="outline-text-3" id="text-3">


</div>

<div id="outline-container-3-1" class="outline-4">
<h4 id="sec-3-1">linear regression</h4>
<div class="outline-text-4" id="text-3-1">

<p>I derive a formula for linear regression.
</p>


<pre class="src src-maxima"><span style="color: #a020f0;">infeval:</span> <span style="color: #008b8b;">true</span>;
<span style="color: #7a378b;">declare</span> (<span style="color: #7a378b;">nounify</span>(<span style="color: #7a378b;">sum</span>), <span style="color: #a020f0;">linear</span>);
<span style="color: #b22222;">/* </span><span style="color: #b22222;">the sum of squares of residues </span><span style="color: #b22222;">*/</span>
F<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">sum</span>((al <span style="color: #a020f0;">+</span> be<span style="color: #a020f0;">*</span>x[i] <span style="color: #a020f0;">-</span> y[i])<span style="color: #a020f0;">^</span><span style="color: #008b8b;">2</span>, i, <span style="color: #008b8b;">1</span>, N);

<span style="color: #b22222;">/* </span><span style="color: #b22222;">derivatives must be zero </span><span style="color: #b22222;">*/</span>
eq1<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">fullratsimp</span>(<span style="color: #7a378b;">diff</span>(F, al));
eq2<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">fullratsimp</span>(<span style="color: #7a378b;">diff</span>(F, be));

<span style="color: #b22222;">/* </span><span style="color: #b22222;">solve the system of equation </span><span style="color: #b22222;">*/</span>
sol_be<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">solve</span>( [eq1, eq2], [al, be])[<span style="color: #008b8b;">1</span>];
be_maxima<span style="color: #a020f0;">:</span> assoc(be, sol_be);

<span style="color: #b22222;">/* </span><span style="color: #b22222;">solve the first equation to get alpha</span><span style="color: #b22222;">*/</span>
sol_al<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">solve</span>(eq1, al);
al_maxima<span style="color: #a020f0;">:</span> assoc(al, sol_al);

<span style="color: #b22222;">/* </span><span style="color: #b22222;">definitions to make it look like in the textbook </span><span style="color: #b22222;">*/</span>
env<span style="color: #a020f0;">:</span> [x[i]<span style="color: #a020f0;">=</span>xav<span style="color: #a020f0;">+</span>dx[i], y[i]<span style="color: #a020f0;">=</span>yav<span style="color: #a020f0;">+</span>dy[i],
      <span style="color: #7a378b;">sum</span>(dx[i], i, <span style="color: #008b8b;">1</span>, N)<span style="color: #a020f0;">=</span><span style="color: #008b8b;">0</span>,
      <span style="color: #7a378b;">sum</span>(dy[i], i, <span style="color: #008b8b;">1</span>, N)<span style="color: #a020f0;">=</span><span style="color: #008b8b;">0</span>,
      <span style="color: #7a378b;">sum</span>(x[i], i, <span style="color: #008b8b;">1</span>, N)<span style="color: #a020f0;">=</span>xav<span style="color: #a020f0;">*</span>N,
      <span style="color: #7a378b;">sum</span>(y[i], i, <span style="color: #008b8b;">1</span>, N)<span style="color: #a020f0;">=</span>yav<span style="color: #a020f0;">*</span>N];

be_simp<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">ev</span>(<span style="color: #7a378b;">ratsimp</span>(be_maxima), env);
al_simp<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">ev</span>(<span style="color: #7a378b;">ratsimp</span>(al_maxima), env);
<span style="color: #7a378b;">print</span>(<span style="color: #8b2252;">"beta: "</span>, be_simp, <span style="color: #8b2252;">"        alpha: "</span>, al_simp);
</pre>



<pre class="example">        N
       ====
       \
        &gt;    dx  dy
       /       i   i
       ====
       i = 1
beta:  -------------         alpha:  yav - be xav 
          N
         ====
         \       2
          &gt;    dx
         /       i
         ====
         i = 1
</pre>


</div>
</div>

</div>

<div id="outline-container-4" class="outline-3">
<h3 id="sec-4">Probability distribution functions</h3>
<div class="outline-text-3" id="text-4">


</div>

<div id="outline-container-4-1" class="outline-4">
<h4 id="sec-4-1">normal</h4>
<div class="outline-text-4" id="text-4-1">




<pre class="src src-stata">twoway function normalden(x, 0, 1), <span style="color: #a020f0;">range</span>(-4 4) ytitle(<span style="color: #8b2252;">"pr. density of normal distr."</span>)
</pre>


<p>
<img src="normal.png"  alt="normal.png" />
</p>
</div>

</div>

<div id="outline-container-4-2" class="outline-4">
<h4 id="sec-4-2">binomial</h4>
<div class="outline-text-4" id="text-4-2">

<p>Plot binomial distribution: probability of observing n ore fewer
successes then probability of one successes is p.
</p>


<pre class="src src-stata">twoway (function binomial(30, x, 0.5), <span style="color: #a020f0;">range</span>(0 30)) <span style="color: #b22222;">///</span>
       (function binomial(30, x, 0.25), <span style="color: #a020f0;">range</span>(0 30)), <span style="color: #b22222;">///</span>
       legend( label(1 <span style="color: #8b2252;">"p=0.5, n=10"</span>) label(2 <span style="color: #8b2252;">"p=0.25, n=10"</span>) )
</pre>


<p>
<img src="bbinomial.png"  alt="bbinomial.png" />
</p>
</div>

</div>

<div id="outline-container-4-3" class="outline-4">
<h4 id="sec-4-3">student</h4>
<div class="outline-text-4" id="text-4-3">




<pre class="src src-stata">twoway (function tden(2, x), <span style="color: #a020f0;">range</span>(-10 10)) <span style="color: #b22222;">///</span>
       (function tden(10, x), <span style="color: #a020f0;">range</span>(-10 10)), <span style="color: #b22222;">///</span>
       legend( label(1 <span style="color: #8b2252;">"n=2"</span>) label(2 <span style="color: #8b2252;">"n=10"</span>)) <span style="color: #b22222;">///</span>
       ytitle(<span style="color: #8b2252;">"t-distribution"</span>)
</pre>


<p>
<img src="tden.png"  alt="tden.png" />
</p>
</div>
</div>

</div>

<div id="outline-container-5" class="outline-3">
<h3 id="sec-5">Stata commands</h3>
<div class="outline-text-3" id="text-5">


</div>

<div id="outline-container-5-1" class="outline-4">
<h4 id="sec-5-1">ttest</h4>
<div class="outline-text-4" id="text-5-1">

<p>Mean-comparison tests
</p>


<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">100</span>
<span style="color: #a020f0;">gen</span> x = rnormal()
sum x
ttest x == 0
</pre>



<pre class="example">
obs was 0, now 100

    Variable |       Obs        Mean    Std. Dev.       Min        Max
-------------+--------------------------------------------------------
           x |       100    .0006276    1.061928  -2.885089   1.837664

One-sample t test
------------------------------------------------------------------------------
Variable |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |     100    .0006276    .1061928    1.061928    -.210082    .2113372
------------------------------------------------------------------------------
    mean = mean(x)                                                t =   0.0059
Ho: mean = 0                                     degrees of freedom =       99

    Ha: mean &lt; 0                 Ha: mean != 0                 Ha: mean &gt; 0
 Pr(T &lt; t) = 0.5024         Pr(|T| &gt; |t|) = 0.9953          Pr(T &gt; t) = 0.4976

</pre>



<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">20</span>
<span style="color: #a020f0;">gen</span> x = rnormal(1.0)
<span style="color: #a020f0;">gen</span> y = rnormal(1.5)
ttest x == y
</pre>



<pre class="example">
obs was 0, now 20

Paired t test
------------------------------------------------------------------------------
Variable |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |      20    .6278007    .2067612    .9246643    .1950445    1.060557
       y |      20    1.529019    .2938401    1.314093    .9140044    2.144033
---------+--------------------------------------------------------------------
    diff |      20    -.901218    .3177534    1.421036   -1.566283   -.2361526
------------------------------------------------------------------------------
     mean(diff) = mean(x - y)                                     t =  -2.8362
 Ho: mean(diff) = 0                              degrees of freedom =       19

 Ha: mean(diff) &lt; 0           Ha: mean(diff) != 0           Ha: mean(diff) &gt; 0
 Pr(T &lt; t) = 0.0053         Pr(|T| &gt; |t|) = 0.0106          Pr(T &gt; t) = 0.9947

</pre>


<p>
With group variable
</p>




<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nobs</span> = 1000
<span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> `<span style="color: #a0522d;">nobs</span>'
<span style="color: #a020f0;">gen</span> lev = 1 if <span style="color: #228b22;">_n</span>&lt;=`<span style="color: #a0522d;">nobs</span>'/2
<span style="color: #a020f0;">replace</span> lev = 0 if <span style="color: #228b22;">_n</span>&gt;`<span style="color: #a0522d;">nobs</span>'/2

<span style="color: #a020f0;">gen</span> x = rnormal(1) if lev==0
<span style="color: #a020f0;">replace</span> x = rnormal(2) if lev==1
graph box x, <span style="color: #228b22;">by</span>(lev)
</pre>


<p>
<img src="twonorm.png"  alt="twonorm.png" />
</p>
<p>
Immediate form of one-sample mean-comparison test
</p>


<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> obs</span> = 20
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 1.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd</span> = 1.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> val</span> = 1.8
ttesti `<span style="color: #a0522d;">obs</span>' `<span style="color: #a0522d;">mean</span>' `<span style="color: #a0522d;">sd</span>' `<span style="color: #a0522d;">val</span>'
</pre>



<pre class="example">
One-sample t test
------------------------------------------------------------------------------
         |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |      20           1    .3354102         1.5    .2979784    1.702022
------------------------------------------------------------------------------
    mean = mean(x)                                                t =  -2.3851
Ho: mean = 1.8                                   degrees of freedom =       19

   Ha: mean &lt; 1.8               Ha: mean != 1.8               Ha: mean &gt; 1.8
 Pr(T &lt; t) = 0.0138         Pr(|T| &gt; |t|) = 0.0276          Pr(T &gt; t) = 0.9862

</pre>


</div>

</div>

<div id="outline-container-5-2" class="outline-4">
<h4 id="sec-5-2">samsi</h4>
<div class="outline-text-4" id="text-5-2">

<p>Sample size and power for means and proportions
</p>


<pre class="src src-stata">sampsi 0.2 0.4
</pre>



<pre class="example">
Estimated sample size for two-sample comparison of proportions

Test Ho: p1 = p2, where p1 is the proportion in population 1
                    and p2 is the proportion in population 2
Assumptions:

         alpha =   0.0500  (two-sided)
         power =   0.9000
            p1 =   0.2000
            p2 =   0.4000
         n2/n1 =   1.00

Estimated required sample sizes:

            n1 =      119
            n2 =      119

</pre>


</div>

</div>

<div id="outline-container-5-3" class="outline-4">
<h4 id="sec-5-3">signtest</h4>
<div class="outline-text-4" id="text-5-3">

<p>Sign test of matched pairs
</p>


<pre class="src src-stata">quietly {
<span style="color: #008b8b;">  set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">20</span>
  <span style="color: #a020f0;">gen</span> x = rnormal()
  <span style="color: #a020f0;">gen</span> y = x + 1.0 + rnormal()
}
signtest x=y
</pre>



<pre class="example">
Sign test

        sign |    observed    expected
-------------+------------------------
    positive |           5          10
    negative |          15          10
        zero |           0           0
-------------+------------------------
         all |          20          20

One-sided tests:
  Ho: median of x - y = 0 vs.
  Ha: median of x - y &gt; 0
      Pr(#positive &gt;= 5) =
         Binomial(n = 20, x &gt;= 5, p = 0.5) =  0.9941

  Ho: median of x - y = 0 vs.
  Ha: median of x - y &lt; 0
      Pr(#negative &gt;= 15) =
         Binomial(n = 20, x &gt;= 15, p = 0.5) =  0.0207

Two-sided test:
  Ho: median of x - y = 0 vs.
  Ha: median of x - y != 0
      Pr(#positive &gt;= 15 or #negative &gt;= 15) =
         min(1, 2*Binomial(n = 20, x &gt;= 15, p = 0.5)) =  0.0414

</pre>



<pre class="src src-stata"><span style="color: #008b8b;">set</span> <span style="color: #008b8b;">obs</span> <span style="color: #228b22;">20</span>
<span style="color: #a020f0;">gen</span> x = rnormal()
<span style="color: #a020f0;">gen</span> y = 0.15 + rnormal()
signrank x=y
ttest x=y
</pre>



<pre class="example">
obs was 0, now 20

Wilcoxon signed-rank test

        sign |      obs   sum ranks    expected
-------------+---------------------------------
    positive |        7          63         105
    negative |       13         147         105
        zero |        0           0           0
-------------+---------------------------------
         all |       20         210         210

unadjusted variance      717.50
adjustment for ties        0.00
adjustment for zeros       0.00
                     ----------
adjusted variance        717.50

Ho: x = y
             z =  -1.568
    Prob &gt; |z| =   0.1169

Paired t test
------------------------------------------------------------------------------
Variable |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |      20   -.3721993    .2067612    .9246643   -.8049555    .0605569
       y |      20    .1790187    .2938401    1.314093   -.4359956    .7940331
---------+--------------------------------------------------------------------
    diff |      20    -.551218    .3177534    1.421036   -1.216283    .1138474
------------------------------------------------------------------------------
     mean(diff) = mean(x - y)                                     t =  -1.7347
 Ho: mean(diff) = 0                              degrees of freedom =       19

 Ha: mean(diff) &lt; 0           Ha: mean(diff) != 0           Ha: mean(diff) &gt; 0
 Pr(T &lt; t) = 0.0495         Pr(|T| &gt; |t|) = 0.0990          Pr(T &gt; t) = 0.9505

</pre>


</div>

</div>

<div id="outline-container-5-4" class="outline-4">
<h4 id="sec-5-4">signrank</h4>
<div class="outline-text-4" id="text-5-4">

<p>Equality tests on matched data
</p></div>

</div>

<div id="outline-container-5-5" class="outline-4">
<h4 id="sec-5-5">lincom</h4>
<div class="outline-text-4" id="text-5-5">

<p>lincom computes combinations of estimators (z, p-values etc.). 
</p>
<p>
Construct a linear regression and use <code>lincom</code> 
</p>


<pre class="src src-stata">quietly set obs 10
<span style="color: #a020f0;">gen</span> x = <span style="color: #228b22;">_n</span>
<span style="color: #a020f0;">gen</span> y = x + 2*rnormal()
quietly <span style="color: #008b8b;">regress</span> y x
lincom 2*x
</pre>


<pre class="example">

 ( 1)  2*x = 0

------------------------------------------------------------------------------
           y |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.856045   .5219802     3.56   0.007     .6523569    3.059734
------------------------------------------------------------------------------

</pre>


</div>
</div>

</div>

<div id="outline-container-6" class="outline-3">
<h3 id="sec-6">Tutorial 10</h3>
<div class="outline-text-3" id="text-6">

<ul>
<li id="sec-6-1">Step 1<br/>
 Calculate the Pearson correlation for the percent of patients who say
their nurse always communicated well (nursealways) and the percent of
patients who would always recommend the hospital (recommendyes).



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hospitaldata.74f90a09d4da.dta
pwcorr recommendyes nursealways, sig
</pre>



<pre class="example">
             | recomm~s nursea~s
-------------+------------------
recommendyes |   1.0000 
             |
             |
 nursealways |   0.6580   1.0000 
             |   0.0000
             |

</pre>


</li>
</ul>
<ul>
<li id="sec-6-2">Step 2<br/>
Now that you have established that these variables are correlated,
you decide to fit a linear regression model to assess the relationship
between recommendyes and nursealways.  State your model.

<p>
\(Y_i\) = percent of patients who always recommend the hospital
</p>
<p>
\(X_i\) = perecnt of patients who say that the nurse always communicates well
</p>


\begin{equation}
Y_i = \alpha + \beta X_i + \epsilon_i
\end{equation}

<p>
where \(\epsilon_i \propto N(0, \sigma^2)\).  Goal is to estimate and
obtain measures of uncertainty for \(\alpha\) and \(\beta\). We use the
method of least squares for estimation.
</p></li>
</ul>
<ul>
<li id="sec-6-3">Step 3<br/>
Construct a scatter plot with nursealways on the x-axis and recommendyes on the y axis.
Use the scatterplot to evaluate the assumptions of simple linear
regression.  Assumptions:
<ul>
<li>Independent observations
</li>
<li>\(Y|X\) is normally distributed
</li>
<li>Homoscedasticity (constant variance)
</li>
<li>Linearity
</li>
</ul>




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hospitaldata.74f90a09d4da.dta
twoway (scatter recommendyes nursealways)
</pre>


<p>
<img src="linrett2.png"  alt="linrett2.png" />
</p>
</li>
</ul>
<ul>
<li id="sec-6-4">Step 4<br/>
Fit the linear regression model. Provide estimates, confidence intervals, and interpreta-
tions of the regression coefficients $&alpha; and \(\beta\).



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hospitaldata.74f90a09d4da.dta
regress recommendyes nursealways
</pre>



<pre class="example">
      Source |       SS       df       MS              Number of obs =    3570
-------------+------------------------------           F(  1,  3568) = 2723.72
       Model |  144368.851     1  144368.851           Prob &gt; F      =  0.0000
    Residual |  189118.972  3568  53.0041962           R-squared     =  0.4329
-------------+------------------------------           Adj R-squared =  0.4327
       Total |  333487.823  3569  93.4401297           Root MSE      =  7.2804

------------------------------------------------------------------------------
recommendyes |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 nursealways |   1.159487   .0222169    52.19   0.000     1.115928    1.203046
       _cons |  -19.21559   1.712829   -11.22   0.000    -22.57381   -15.85737
------------------------------------------------------------------------------

</pre>


</li>
</ul>
<ul>
<li id="sec-6-5">Step 7<br/>
Examine a residual plot. Using \(R^2\) and the plot, does the model
appear to fit well? (Are there any outliers?)



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hospitaldata.74f90a09d4da.dta
regress recommendyes nursealways
rvfplot
</pre>


<p>
<img src="rvf-lin.png"  alt="rvf-lin.png" />
</p>
</li>
</ul>
<ul>
<li id="sec-6-6">Step 8<br/>
Using the regression line, predict the expected percent of patients
who always recommend the hospital when the reported percent of nurses
who always communicate well is 80%? Construct corresponding 95%
confidence interval.



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hospitaldata.74f90a09d4da.dta
regress recommendyes nursealways
lincom _cons + 80*nursealways
</pre>



<pre class="example">
      Source |       SS       df       MS              Number of obs =    3570
-------------+------------------------------           F(  1,  3568) = 2723.72
       Model |  144368.851     1  144368.851           Prob &gt; F      =  0.0000
    Residual |  189118.972  3568  53.0041962           R-squared     =  0.4329
-------------+------------------------------           Adj R-squared =  0.4327
       Total |  333487.823  3569  93.4401297           Root MSE      =  7.2804

------------------------------------------------------------------------------
recommendyes |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 nursealways |   1.159487   .0222169    52.19   0.000     1.115928    1.203046
       _cons |  -19.21559   1.712829   -11.22   0.000    -22.57381   -15.85737
------------------------------------------------------------------------------

 ( 1)  80*nursealways + _cons = 0

------------------------------------------------------------------------------
recommendyes |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   73.54339   .1399631   525.45   0.000     73.26897     73.8178
------------------------------------------------------------------------------

</pre>


</li>
</ul>
<ul>
<li id="sec-6-7">Step 9<br/>
For a new hospital with 80% of patients reporting that nurses always
communicate well, predict the percent of patients who will always
recommend the hospital. Construct corresponding 95% confidence
interval.



<pre class="src src-stata">di %8.2f 73.54339 - invttail(3568, 0.025)*7.281745
</pre>


<pre class="example">

   59.27

</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-7" class="outline-3">
<h3 id="sec-7">Tutorial 11</h3>
<div class="outline-text-3" id="text-7">




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/chis_healthdisparities.e85b34e4c45a.dta
<span style="color: #a020f0;">gen</span> nopov = 1-poverty
logit doctor nopov
lincom nopov, eform
</pre>


<pre class="example">
Iteration 0:   log likelihood =  -247.4035  
Iteration 1:   log likelihood = -245.14765  
Iteration 2:   log likelihood = -245.08244  
Iteration 3:   log likelihood = -245.08242  

Logistic regression                               Number of obs   =        500
                                                  LR chi2(1)      =       4.64
                                                  Prob &gt; chi2     =     0.0312
Log likelihood = -245.08242                       Pseudo R2       =     0.0094

------------------------------------------------------------------------------
      doctor |      Coef.   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       nopov |   .6713351   .3013476     2.23   0.026     .0807047    1.261965
       _cons |     .83975   .2745156     3.06   0.002     .3017093    1.377791
------------------------------------------------------------------------------

 ( 1)  [doctor]nopov = 0

------------------------------------------------------------------------------
      doctor |     exp(b)   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.956848   .5896914     2.23   0.026     1.084051    3.532357
------------------------------------------------------------------------------

</pre>


</div>

</div>

<div id="outline-container-8" class="outline-3">
<h3 id="sec-8">Home Work 2</h3>
<div class="outline-text-3" id="text-8">


</div>

<div id="outline-container-8-1" class="outline-4">
<h4 id="sec-8-1">BMI and CHD prevalence</h4>
<div class="outline-text-4" id="text-8-1">

<ul>
<li id="sec-8-1-1">Q1<br/>
What is the prevalence of obesity among the 4415 participants at the
1956 exam?
</li>
</ul>
<ul>
<li id="sec-8-1-2">Q2<br/>
What is the prevalence of CHD at the 1956 exam among the 4415
participants at the 1956 exam?
</li>
</ul>
<ul>
<li id="sec-8-1-3">Q3<br/>
What is the prevalence of CHD at the 1956 exam for each of the body mass index
classes?




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly {
  <span style="color: #a020f0;">gen</span> bmi1_<span style="color: #008b8b;">cat</span>=.
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=1 if (bmi1&lt;18.5)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=2 if (bmi1&gt;=18.5 &amp; bmi1&lt;25)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=3 if (bmi1&gt;=25 &amp; bmi1&lt;=30)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=4 if (bmi1&gt;30)
} 
tab bmi1_<span style="color: #008b8b;">cat</span> prevchd1, missing matcell(table)
</pre>



<pre class="example">
           |  Prevalent coronary
           | heart disease, exam 1
  bmi1_cat |        No        Yes |     Total
-----------+----------------------+----------
         1 |        57          0 |        57 
         2 |     1,870         66 |     1,936 
         3 |     1,758         90 |     1,848 
         4 |       555         38 |       593 
-----------+----------------------+----------
     Total |     4,240        194 |     4,434 

</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-8-2" class="outline-4">
<h4 id="sec-8-2">Diabetes prevalence</h4>
<div class="outline-text-4" id="text-8-2">

<ul>
<li id="sec-8-2-1">Q1<br/>
What is the prevalence of diabetes at the first exam (diabetes1=1)?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
tab diabetes1
</pre>


<pre class="example">

  Diabetic, |
     exam 1 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      4,313       97.27       97.27
        Yes |        121        2.73      100.00
------------+-----------------------------------
      Total |      4,434      100.00

</pre>


</li>
</ul>
<ul>
<li id="sec-8-2-2">Q2<br/>
What is the prevalence of diabetes at the second exam (diabetes2=1)?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
tab diabetes2
</pre>


<pre class="example">

  Diabetic, |
     exam 2 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,775       96.06       96.06
        Yes |        155        3.94      100.00
------------+-----------------------------------
      Total |      3,930      100.00

</pre>


</li>
</ul>
<ul>
<li id="sec-8-2-3">Q3<br/>
What is the prevalence of diabetes at the third exam (diabetes3=1)?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
tab diabetes3
</pre>


<pre class="example">

  Diabetic, |
     exam 3 |      Freq.     Percent        Cum.
------------+-----------------------------------
         No |      3,009       92.22       92.22
        Yes |        254        7.78      100.00
------------+-----------------------------------
      Total |      3,263      100.00

</pre>


</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-9" class="outline-3">
<h3 id="sec-9">Home Work 3</h3>
<div class="outline-text-3" id="text-9">


</div>

<div id="outline-container-9-1" class="outline-4">
<h4 id="sec-9-1">Probability and BMI</h4>
<div class="outline-text-4" id="text-9-1">

<p>The following table uses data from the NHLBI teaching data set and
displays the body mass index for 3,909 participants in the Framingham
Heart Study with BMI measurements at the first two exams, in 1956 and
in 1962.
</p>
<p>
Cardiac Hospitalizations in the US, 1991 and 1992
</p>


\begin{matrix}
                   & \text{BMI} \leq 25,   & \text{BMI} > 25, & \mathbf{Total} \\
                   & \text{exam 2}         & \text{exam 2}    &  \\
\hline
\mathrm{BMI} \leq 25, \text{exam 1}   & 1,492 & 278    & 1,770 \\
\mathrm{BMI} > 25,    \text{exam 1}   & 249   & 1,890  & 2,139 \\
\text{Total}                          & 1,741 & 2,168  & 3,909 \\
\end{matrix}

<p>
Assume a study participant has been randomly selected from this subset
of 3,909 participants.
</p>

<p>    
Define A as the event that this participant has a high BMI at exam 1.
</p>
<p>
Define B as the event that this participant has a high BMI at exam 2.
</p>
<p>
Define C as the event that this participant has a low BMI at exam 2.
</p>



<p>
Reproduce the table
</p>


<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly {
  <span style="color: #a020f0;">generate</span> more1 = 0 if bmi1&lt;=25 &amp; !<span style="color: #008b8b;">missing</span>(bmi2)
  <span style="color: #a020f0;">replace</span>  more1 = 1 if bmi1&gt;25 &amp; !<span style="color: #008b8b;">missing</span>(bmi2)

  <span style="color: #a020f0;">generate</span> more2 = 0 if bmi2&lt;=25 &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span>  more2 = 1 if bmi2&gt;25 &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
}
tab more1 more2
</pre>


<pre class="example">

           |         more2
     more1 |         0          1 |     Total
-----------+----------------------+----------
         0 |     1,492        278 |     1,770 
         1 |       249      1,890 |     2,139 
-----------+----------------------+----------
     Total |     1,741      2,168 |     3,909 

</pre>


<p>
What is the probability of A?
</p>
<p>
What is the probability of B?
</p>
<p>
What is the probability of A and B?
</p>
<p>
Are A and B independent?
</p>
<p>
In a randomly selected participant, what is the probability that A
and/or B occurs (namely, that the participant’s BMI is high during at
least one of the first two exams)?
</p>
<p>
What is the probability that C occurs, given that A occurs?
</p>
<p>
What is the probability that C occurs, given that A occurs?
</p>


<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly {
  <span style="color: #a020f0;">generate</span> more1 = 0 if bmi1&lt;=25 &amp; !<span style="color: #008b8b;">missing</span>(bmi2)
  <span style="color: #a020f0;">replace</span>  more1 = 1 if bmi1&gt;25 &amp; !<span style="color: #008b8b;">missing</span>(bmi2)

  <span style="color: #a020f0;">generate</span> more2 = 0 if bmi2&lt;=25 &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span>  more2 = 1 if bmi2&gt;25 &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
}
tab more1 more2, matcell(table)
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> ntot</span> = <span style="color: #008b8b;">table</span>[1,1]+table[1,2]+table[2,1]+table[2,2]
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> PA</span> = (table[2,1]+table[2,2])/`<span style="color: #a0522d;">ntot</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> PB</span> = (table[1,2]+table[2,2])/`<span style="color: #a0522d;">ntot</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> PAandB</span> = <span style="color: #008b8b;">table</span>[2,2]/`<span style="color: #a0522d;">ntot</span>'
di <span style="color: #8b2252;">"P(A): "</span> %8.2f `<span style="color: #a0522d;">PA</span>'
di <span style="color: #8b2252;">"P(B): "</span> %8.2f `<span style="color: #a0522d;">PB</span>'
di <span style="color: #8b2252;">"P(A&amp;B): "</span> %8.2f `<span style="color: #a0522d;">PAandB</span>'
di <span style="color: #8b2252;">"P(A||B): "</span> %8.2f (table[1,2]+table[2,1]+table[2,2])/`<span style="color: #a0522d;">ntot</span>'
di <span style="color: #8b2252;">"P(A|B): "</span> %8.2f (table[2,2])/(table[2,1]+table[2,2])
di <span style="color: #8b2252;">"P(C|A): "</span> %8.2f (table[2,1])/(table[2,1]+table[2,2])
<span style="color: #008b8b;">if</span> (`<span style="color: #a0522d;">PAandB</span>' == `<span style="color: #a0522d;">PA</span>'*`<span style="color: #a0522d;">PB</span>') {
   <span style="color: #008b8b;">di</span> <span style="color: #8b2252;">"A and B are independent"</span>
}
<span style="color: #008b8b;">else</span>  {
   <span style="color: #008b8b;">di</span> <span style="color: #8b2252;">"A and B are not independent"</span>
}
</pre>



<pre class="example">
           |         more2
     more1 |         0          1 |     Total
-----------+----------------------+----------
         0 |     1,492        278 |     1,770 
         1 |       249      1,890 |     2,139 
-----------+----------------------+----------
     Total |     1,741      2,168 |     3,909 

P(A):     0.55

P(B):     0.55

P(A&amp;B):     0.48

P(A||B):     0.62

P(A|B):     0.88

P(C|A):     0.12

A and B are not independent

</pre>


</div>

</div>

<div id="outline-container-9-2" class="outline-4">
<h4 id="sec-9-2">Probability of age and smoking events</h4>
<div class="outline-text-4" id="text-9-2">

<p>The following table uses data from the NHLBI teaching data set using
the 4,434 participants in the Framingham Heart Study who attended the
exam in 1956. Below, we show a table that contains the probabilities
that a study participant falls into one of the eight categories
defined by all possible combinations of the age categories and smoking
status at the first exam in 1956. Recall that all study participants
are between 30 and 70 years old.
</p>
<p>
Let A be the event that a randomly chosen study participant is a
smoker at exam 1 in 1956. Let B be the event that the person chosen is
between 60 and 70 years old at exam 1.  Age and smoking at baseline in
the Framingham cohort
</p>


\begin{matrix}
   \mathbf{Age}           & \mathbf{Non-Smoker}            & \mathbf{Smoker}   \\
\hline
30-39 &  0.0519   & 0.0742 \\
40-49 &  0.1554   & 0.2262 \\
50-59 &  0.1809   & 0.1346 \\
60-70 &  0.1200   & 0.0568 \\
\end{matrix}

<p>
What is the probability of A.
</p>
<p>
What is the probability of \(B^C\)
</p>
<p>
What is the probability that a randomly selected individual is a
non-smoker who is younger than 60 years old at exam 1?
</p>
<p>
Are the events A and B independent?
</p>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly <span style="color: #a020f0;">gen</span> age_<span style="color: #008b8b;">cat</span>=.
quietly <span style="color: #a020f0;">replace</span> age_<span style="color: #008b8b;">cat</span>=1 if (age1&gt;=30) &amp; (age1&lt;=39)
quietly <span style="color: #a020f0;">replace</span> age_<span style="color: #008b8b;">cat</span>=2 if (age1&gt;=40) &amp; (age1&lt;=49)
quietly <span style="color: #a020f0;">replace</span> age_<span style="color: #008b8b;">cat</span>=3 if (age1&gt;=50) &amp; (age1&lt;=59)
quietly <span style="color: #a020f0;">replace</span> age_<span style="color: #008b8b;">cat</span>=4 if (age1&gt;=60) &amp; (age1&lt;=69)

tabulate age_<span style="color: #008b8b;">cat</span> cursmoke1, cell nofreq matcell(table)
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nsm</span> = <span style="color: #008b8b;">table</span>[1,1]+table[2,1]+table[3,1]+table[4,1]
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sm</span> = <span style="color: #008b8b;">table</span>[1,2]+table[2,2]+table[3,2]+table[4,2]
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> tot</span> = `<span style="color: #a0522d;">sm</span>' + `<span style="color: #a0522d;">nsm</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> b</span> = <span style="color: #008b8b;">table</span>[4,1]-table[4,2]
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> PA</span> = `<span style="color: #a0522d;">sm</span>'/`<span style="color: #a0522d;">tot</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> PB</span> = `<span style="color: #a0522d;">b</span>'/`<span style="color: #a0522d;">tot</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> PAandB</span> = <span style="color: #008b8b;">table</span>[4,2]
di <span style="color: #8b2252;">"P(A): "</span> %8.2f `<span style="color: #a0522d;">PA</span>'
di <span style="color: #8b2252;">"P(B^C): "</span> %8.2f 1-`<span style="color: #a0522d;">PB</span>'
di <span style="color: #8b2252;">"P(&lt;60, non-smoker): "</span> %8.2f (table[1,1]+table[2,1]+table[3,1])/`<span style="color: #a0522d;">tot</span>'
<span style="color: #008b8b;">if</span> (`<span style="color: #a0522d;">PAandB</span>' == `<span style="color: #a0522d;">PA</span>'*`<span style="color: #a0522d;">PB</span>') {
   <span style="color: #008b8b;">di</span> <span style="color: #8b2252;">"A and B are independent"</span>
}
<span style="color: #008b8b;">else</span>  {
   <span style="color: #008b8b;">di</span> <span style="color: #8b2252;">"A and B are not independent"</span>
}
</pre>


<pre class="example">
           | Current smoker, exam
           |           1
   age_cat |        No        Yes |     Total
-----------+----------------------+----------
         1 |      5.19       7.42 |     12.61 
         2 |     15.55      22.63 |     38.18 
         3 |     18.10      13.47 |     31.57 
         4 |     11.96       5.69 |     17.64 
-----------+----------------------+----------
     Total |     50.79      49.21 |    100.00 

P(A):     0.49

P(B^C):     0.94

P(&lt;60, non-smoker):     0.39

A and B are not independent

</pre>


</div>

</div>

<div id="outline-container-9-3" class="outline-4">
<h4 id="sec-9-3">Diagnostic Testing.</h4>
<div class="outline-text-4" id="text-9-3">

<p>Screening for prostate cancer in men is a controversial topic. One of
the most common screening mechanisms is the PSA test (prostate antigen
test). In a meta-analysis, Mistry and Cable (2003) report that the
sensitivity of the PSA test is 72.1% and the specificity is 93.2%. In
the United States, it is estimated that 16.1% of men will have
prostate cancer at some point in their life (America Cancer Society
2012). Assume that the prevalence of prostate cancer among men ages 75
and older is 16.1%. We examine the properties of the PSA screening
test in men ages 75 and older, using the sensitivity and specificity
values above.  Mistry K. and Cable G. (2003). Meta-analysis of
prostate-specific antigen and digital rectal examination as screening
tests for prostate carcinoma. The Journal of the American Board of
Family Practice, 16(2): 95-101.
</p>
<p>
I use <a href="http://maxima.sourceforge.net">maxima</a> to do algebra. There are 4 mutually exclusive and
exhaustive groups: T+ and D+, T+ and D-, T- and D+, T- and D-. Denot
<code>tp_dp</code>, <code>tp_dn</code>, <code>tn_dp</code>, <code>tn_dn</code> the number of patients in each of
the groups. <i>Sensitivity</i> is defined as the probability of a positive
test result given that the individual has the disease:
<code>tp_dp/(tp_dp+tn_dp)</code>. <i>Specificity</i> is the probability that tests
result is negative given that the individual does not have the
disease: <code>tn_dn/(tp_dn+tn_dn)</code>.
</p>


<pre class="src src-maxima"><span style="color: #a020f0;">assume_pos:</span> <span style="color: #008b8b;">true</span>;
vars<span style="color: #a020f0;">:</span> [tp_dp, tp_dn, tn_dp, tn_dn];
eq1<span style="color: #a020f0;">:</span> total <span style="color: #a020f0;">=</span> tp_dp <span style="color: #a020f0;">+</span> tp_dn <span style="color: #a020f0;">+</span> tn_dp <span style="color: #a020f0;">+</span> tn_dn;
eq2<span style="color: #a020f0;">:</span> se <span style="color: #a020f0;">=</span> tp_dp<span style="color: #a020f0;">/</span>(tp_dp<span style="color: #a020f0;">+</span>tn_dp);
eq3<span style="color: #a020f0;">:</span> sp <span style="color: #a020f0;">=</span> tn_dn<span style="color: #a020f0;">/</span>(tp_dn<span style="color: #a020f0;">+</span>tn_dn);
eq4<span style="color: #a020f0;">:</span> pr <span style="color: #a020f0;">=</span> (tp_dp<span style="color: #a020f0;">+</span>tn_dp)<span style="color: #a020f0;">/</span>total;
<span style="color: #b22222;">/* </span><span style="color: #b22222;">solve for the groups </span><span style="color: #b22222;">*/</span>
sol<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">solve</span>([eq1, eq2, eq3, eq4], vars)[<span style="color: #008b8b;">1</span>];

<span style="color: #b22222;">/* </span><span style="color: #b22222;">get answers as formulas </span><span style="color: #b22222;">*/</span>
fn<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">ev</span>(tn_dp<span style="color: #a020f0;">/</span>(tp_dp<span style="color: #a020f0;">+</span>tn_dp), sol);
fp<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">ev</span>(tp_dn<span style="color: #a020f0;">/</span>(tp_dn<span style="color: #a020f0;">+</span>tn_dn), sol);
pc<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">ev</span>(tp_dn<span style="color: #a020f0;">/</span>(tp_dp<span style="color: #a020f0;">+</span>tp_dn), sol);
pd<span style="color: #a020f0;">:</span> <span style="color: #7a378b;">ev</span>(tn_dp<span style="color: #a020f0;">/</span>(tn_dp<span style="color: #a020f0;">+</span>tn_dn), sol);

<span style="color: #b22222;">/* </span><span style="color: #b22222;">substitute numbers </span><span style="color: #b22222;">*/</span>
val<span style="color: #a020f0;">:</span> [se<span style="color: #a020f0;">=</span>0<span style="color: #a020f0;">.</span>721, sp<span style="color: #a020f0;">=</span>0<span style="color: #a020f0;">.</span>932, pr<span style="color: #a020f0;">=</span>0<span style="color: #a020f0;">.</span>161];
<span style="color: #7a378b;">print</span>(<span style="color: #8b2252;">"pr. of falce negative, P(T-|D+):"</span>,  <span style="color: #7a378b;">ev</span>(fn, val));
<span style="color: #7a378b;">print</span>(<span style="color: #8b2252;">"pr. of falce positive, P(T+|D-):"</span>,  <span style="color: #7a378b;">ev</span>(fp, val));
<span style="color: #7a378b;">print</span>(<span style="color: #8b2252;">"P(D-|T+): "</span>, <span style="color: #7a378b;">ev</span>(pc, val));
<span style="color: #7a378b;">print</span>(<span style="color: #8b2252;">"P(D+|T-): "</span>, <span style="color: #7a378b;">ev</span>(pd, val));
</pre>


<pre class="example">
pr. of falce negative, P(T-|D+): 0.279 
pr. of falce positive, P(T+|D-): .06799999999999999 
P(D-|T+):  .3295270110262052 
P(D+|T-):  .05432433511072519 
</pre>


</div>
</div>

</div>

<div id="outline-container-10" class="outline-3">
<h3 id="sec-10">Home Work 4</h3>
<div class="outline-text-3" id="text-10">


</div>

<div id="outline-container-10-1" class="outline-4">
<h4 id="sec-10-1">Titanic Survival Risk Ratios</h4>
<div class="outline-text-4" id="text-10-1">

<p>The following table describes the survival status of passengers on the
Titanic, stratified by Passenger Class (First, Second, or Third),
Sex/Age (Child, Women, or Man), and Survival Status. The Frequency
column indicates the number of passengers in each stratum. (For
example there were 4 1st class women passengers who did not survive
and 140 1st class women passengers who did survive). These data were
obtained from the website anesi.com and refers to British
Parliamentary Papers, Shipping. Casualties (Loss of the Steamship
“Titanic”), 1912. cmd 6352 “Report of a Formal Investigation into the
circumstances attending the foundering on the 15th April 1912 of the
British Steamship “Titanic” of Liverpool after striking ice in or near
Latitude 41 46 N., Longitude 50 14 W., North Atlantic Ocean, whereby
loss of life ensued (London; His Majesty’s Stationary Office, 1912)
page 42.
</p>
<p>
Titanic Survival Data by Passenger Class, Sex, and Age
\begin{matrix}
\mathbf{Passenger \space Class} & \mathbf{Age/Sex} & \mathbf{Survival \space Status} & \mathbf{Frequency} \\
\hline
\mathrm{First}      & \mathrm{Child} & \mathrm{Survived}  & 6 \\
\mathrm{First}      & \mathrm{Child} & \mathrm{Did \space not \space survive}  & 0 \\
\mathrm{First}      & \mathrm{Women} & \mathrm{Survived}  & 140 \\
\mathrm{First}      & \mathrm{Women} & \mathrm{Did \space not \space survive}  & 4 \\
\mathrm{First}      & \mathrm{Man}   & \mathrm{Survived}  & 57 \\
\mathrm{First}      & \mathrm{Man}   & \mathrm{Did \space not \space survive}  & 118 \\


\mathrm{Second}      & \mathrm{Child} & \mathrm{Survived}  & 24 \\
\mathrm{Second}      & \mathrm{Child} & \mathrm{Did \space not \space survive}  & 0 \\
\mathrm{Second}      & \mathrm{Women} & \mathrm{Survived}  & 80 \\
\mathrm{Second}      & \mathrm{Women} & \mathrm{Did \space not \space survive}  & 13 \\
\mathrm{Second}      & \mathrm{Man}   & \mathrm{Survived}  & 14 \\
\mathrm{Second}      & \mathrm{Man}   & \mathrm{Did \space not \space survive}  & 154 \\

\mathrm{Third}      & \mathrm{Child} & \mathrm{Survived}  & 27 \\
\mathrm{Third}      & \mathrm{Child} & \mathrm{Did \space not \space survive}  & 52 \\
\mathrm{Third}      & \mathrm{Women} & \mathrm{Survived}  & 76 \\
\mathrm{Third}      & \mathrm{Women} & \mathrm{Did \space not \space survive}  & 89 \\
\mathrm{Third}      & \mathrm{Man}   & \mathrm{Survived}  & 75 \\
\mathrm{Third}      & \mathrm{Man}   & \mathrm{Did \space not \space survive}  & 387 \\
\end{matrix}

To get table in stata I save it as tex file <a href="titanic.tex">titanic.tex</a>
</p>


<pre class="src src-latex"><span style="color: #696969;">\begin</span>{<span style="color: #0000ff;">matrix</span>}
<span style="color: #696969;">\mathbf</span>{Passenger <span style="color: #696969;">\space</span> Class} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathbf</span>{Age/Sex} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathbf</span>{Survival <span style="color: #696969;">\space</span> Status} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathbf</span>{Frequency} <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\hline</span>
<span style="color: #696969;">\mathrm</span>{First}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Child} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Survived}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 6 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{First}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Child} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Did <span style="color: #696969;">\space</span> not <span style="color: #696969;">\space</span> survive}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 0 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{First}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Women} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Survived}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 140 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{First}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Women} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Did <span style="color: #696969;">\space</span> not <span style="color: #696969;">\space</span> survive}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 4 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{First}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Man}   <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Survived}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 57 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{First}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Man}   <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Did <span style="color: #696969;">\space</span> not <span style="color: #696969;">\space</span> survive}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 118 <span style="color: #ff0000; font-weight: bold;">\\</span>


<span style="color: #696969;">\mathrm</span>{Second}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Child} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Survived}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 24 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{Second}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Child} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Did <span style="color: #696969;">\space</span> not <span style="color: #696969;">\space</span> survive}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 0 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{Second}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Women} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Survived}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 80 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{Second}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Women} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Did <span style="color: #696969;">\space</span> not <span style="color: #696969;">\space</span> survive}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 13 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{Second}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Man}   <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Survived}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 14 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{Second}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Man}   <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Did <span style="color: #696969;">\space</span> not <span style="color: #696969;">\space</span> survive}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 154 <span style="color: #ff0000; font-weight: bold;">\\</span>

<span style="color: #696969;">\mathrm</span>{Third}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Child} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Survived}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 27 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{Third}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Child} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Did <span style="color: #696969;">\space</span> not <span style="color: #696969;">\space</span> survive}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 52 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{Third}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Women} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Survived}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 76 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{Third}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Women} <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Did <span style="color: #696969;">\space</span> not <span style="color: #696969;">\space</span> survive}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 89 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{Third}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Man}   <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Survived}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 75 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\mathrm</span>{Third}      <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Man}   <span style="color: #ff0000; font-weight: bold;">&amp;</span> <span style="color: #696969;">\mathrm</span>{Did <span style="color: #696969;">\space</span> not <span style="color: #696969;">\space</span> survive}  <span style="color: #ff0000; font-weight: bold;">&amp;</span> 387 <span style="color: #ff0000; font-weight: bold;">\\</span>
<span style="color: #696969;">\end</span>{<span style="color: #0000ff;">matrix</span>}
</pre>


<p>
and process it with the following shell command to generate <a href="titanic.csv">csv data set</a>
</p>


<pre class="src src-sh">detex titanic.tex | <span style="color: #8b2252;">\</span>
   awk <span style="color: #8b2252;">'NR&gt;1&amp;&amp;NF&gt;1'</span> | <span style="color: #8b2252;">\</span>
   awk -v <span style="color: #a0522d;">FS</span>=<span style="color: #8b2252;">'&amp;'</span> -v <span style="color: #a0522d;">OFS</span>=<span style="color: #8b2252;">","</span> <span style="color: #8b2252;">'{n=NR==1?1:$4; NF=3; for (i=0; i&lt;n; i++) print}'</span> &gt; datasets/titanic.csv
</pre>



<pre class="src src-stata">quietly <span style="color: #a020f0;">insheet</span> <span style="color: #008b8b;">using</span> <span style="color: #8b2252;">"datasets/titanic.csv"</span>, names
describe
</pre>



<pre class="example">
unexpected end of file
r(612);

Contains data
  obs:             0                          
 vars:             0                          
 size:             0                          
Sorted by:  

</pre>



<pre class="src src-stata">quietly {
  <span style="color: #a020f0;">insheet</span> <span style="color: #008b8b;">using</span> <span style="color: #8b2252;">"datasets/titanic.csv"</span>, names
  <span style="color: #a020f0;">gen</span> woc = 1
  <span style="color: #a020f0;">replace</span> woc = 0 if agesex==<span style="color: #8b2252;">"Man"</span>
  <span style="color: #a020f0;">gen</span> sus = 0
  <span style="color: #a020f0;">replace</span> sus = 1 if survivalstatus==<span style="color: #8b2252;">"Survived"</span>
}
</pre>


<p>
Use these data to calculate the Risk Ratio for surviving comparing
"women or children" as the exposed group and "all other passengers"
as the non-exposed group.
</p>
<p>
Use these data to calculate the Risk Ratio for surviving comparing
"women or children" as the exposed group and "all other passengers" as
the non-exposed group for each passenger class.
</p>



<pre class="src src-stata">quietly {
  <span style="color: #a020f0;">insheet</span> <span style="color: #008b8b;">using</span> <span style="color: #8b2252;">"datasets/titanic.csv"</span>, names
  <span style="color: #a020f0;">gen</span> woc = 1
  <span style="color: #a020f0;">replace</span> woc = 0 if agesex==<span style="color: #8b2252;">"Man"</span>
  <span style="color: #a020f0;">gen</span> sus = 0
  <span style="color: #a020f0;">replace</span> sus = 1 if survivalstatus==<span style="color: #8b2252;">"Survived"</span>
}
quietly <span style="color: #008b8b;">cs</span> sus woc
di <span style="color: #8b2252;">"Combined: "</span> %8.2f <span style="color: #008b8b;">r</span>(rr)
<span style="color: #b22222;">/// loop over all classes</span>
levelsof passengerclass, local(pc)
foreach pc in `<span style="color: #a0522d;">pc</span>' {
  <span style="color: #008b8b;">quietly</span> <span style="color: #008b8b;">cs</span> sus woc if passengerclass==<span style="color: #8b2252;">"`</span><span style="color: #a0522d;">pc</span><span style="color: #8b2252;">'"</span>
  <span style="color: #008b8b;">di</span> <span style="color: #8b2252;">"`</span><span style="color: #a0522d;">pc</span><span style="color: #8b2252;">'"</span> <span style="color: #8b2252;">" class: "</span> %8.2f  <span style="color: #008b8b;">r</span>(rr)
}
</pre>



<pre class="example">
unexpected end of file
r(612);

variable sus not found
r(111);

Combined:        .

variable passengerclass not found
r(111);

  2.   quietly cs sus woc if passengerclass=="`pc'"
  3.   di "`pc'" " class: " %8.2f  r(rr)
  4. }

</pre>


<p>
<b>Answer: 3.81 2.99 10.67 2.6</b>
</p>
</div>

</div>

<div id="outline-container-10-2" class="outline-4">
<h4 id="sec-10-2">Risk Ratios, Odds Ratios, Rate Ratios for BMI, Death, and CHD</h4>
<div class="outline-text-4" id="text-10-2">

<p>The following table displays categories of body mass index for the
participants at the 1956 exam. (Note: 19 of the 4434 participants are
excluded from this table because of missing data on bmi1.)
</p>

<p>
Show table
</p>


<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
<span style="color: #b22222;">/// I fitted this level to get the same table as in question</span>
quietly {
  <span style="color: #a020f0;">gen</span> bmi1_<span style="color: #008b8b;">cat</span>=.
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=1 if (bmi1&lt;18.5) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=2 if (bmi1&gt;=18.5 &amp; bmi1&lt;25) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=3 if (bmi1&gt;=25 &amp; bmi1&lt;30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=4 if (bmi1&gt;=30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
}
tab bmi1_<span style="color: #008b8b;">cat</span>
</pre>



<pre class="example">
   bmi1_cat |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         57        1.29        1.29
          2 |      1,936       43.85       45.14
          3 |      1,845       41.79       86.93
          4 |        577       13.07      100.00
------------+-----------------------------------
      Total |      4,415      100.00

</pre>


<ul>
<li id="sec-10-2-1">Q1<br/>
Calculate the 24-year Risk Ratio for death comparing obese subjects
(exposed group, n=577) to normal weight subjects (non-exposed group,
n=1936).






<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
<span style="color: #b22222;">/// I fitted this level to get the same table as in question</span>
quietly {
  <span style="color: #a020f0;">gen</span> bmi1_<span style="color: #008b8b;">cat</span>=.
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=1 if (bmi1&lt;18.5) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=2 if (bmi1&gt;=18.5 &amp; bmi1&lt;25) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=3 if (bmi1&gt;=25 &amp; bmi1&lt;30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=4 if (bmi1&gt;=30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
}
quietly <span style="color: #a020f0;">gen</span> obs = . 
quietly <span style="color: #a020f0;">replace</span> obs = 1 if bmi1_<span style="color: #008b8b;">cat</span>==4
quietly <span style="color: #a020f0;">replace</span> obs = 0 if bmi1_<span style="color: #008b8b;">cat</span>==2
<span style="color: #008b8b;">cs</span> death obs
di <span style="color: #8b2252;">"risk ratio: "</span> %8.2f <span style="color: #008b8b;">r</span>(rr)
</pre>



<pre class="example">
                 | obs                    |
                 |   Exposed   Unexposed  |      Total
-----------------+------------------------+------------
           Cases |       259         571  |        830
        Noncases |       318        1365  |       1683
-----------------+------------------------+------------
           Total |       577        1936  |       2513
                 |                        |
            Risk |  .4488735     .294938  |   .3302825
                 |                        |
                 |      Point estimate    |    [95% Conf. Interval]
                 |------------------------+------------------------
 Risk difference |         .1539355       |    .1085524    .1993186 
      Risk ratio |         1.521925       |    1.358417    1.705113 
 Attr. frac. ex. |         .3429373       |    .2638491    .4135287 
 Attr. frac. pop |          .107013       |
                 +-------------------------------------------------
                               chi2(1) =    47.62  Pr&gt;chi2 = 0.0000

risk ratio:     1.52

</pre>


<p>
<b>Answer: 1.52</b>
</p>
</li>
</ul>
<ul>
<li id="sec-10-2-2">Q2<br/>
Calculate the 24-year Odds Ratio for death comparing obese subjects
(exposed group, n=577) to normal weight subjects (non-exposed group,
n=1936).  quietly 




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
<span style="color: #b22222;">/// I fitted this level to get the same table as in question</span>
quietly {
  <span style="color: #a020f0;">gen</span> bmi1_<span style="color: #008b8b;">cat</span>=.
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=1 if (bmi1&lt;18.5) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=2 if (bmi1&gt;=18.5 &amp; bmi1&lt;25) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=3 if (bmi1&gt;=25 &amp; bmi1&lt;30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=4 if (bmi1&gt;=30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
}
quietly <span style="color: #a020f0;">gen</span> obs = . 
quietly <span style="color: #a020f0;">replace</span> obs = 1 if bmi1_<span style="color: #008b8b;">cat</span>==4
quietly <span style="color: #a020f0;">replace</span> obs = 0 if bmi1_<span style="color: #008b8b;">cat</span>==2
<span style="color: #008b8b;">cs</span> death obs, or
di <span style="color: #8b2252;">"or: "</span> %8.2f <span style="color: #008b8b;">r</span>(or)
</pre>



<pre class="example">
                 | obs                    |
                 |   Exposed   Unexposed  |      Total
-----------------+------------------------+------------
           Cases |       259         571  |        830
        Noncases |       318        1365  |       1683
-----------------+------------------------+------------
           Total |       577        1936  |       2513
                 |                        |
            Risk |  .4488735     .294938  |   .3302825
                 |                        |
                 |      Point estimate    |    [95% Conf. Interval]
                 |------------------------+------------------------
 Risk difference |         .1539355       |    .1085524    .1993186 
      Risk ratio |         1.521925       |    1.358417    1.705113 
 Attr. frac. ex. |         .3429373       |    .2638491    .4135287 
 Attr. frac. pop |          .107013       |
      Odds ratio |         1.947015       |    1.608816     2.35632 (Cornfield)
                 +-------------------------------------------------
                               chi2(1) =    47.62  Pr&gt;chi2 = 0.0000

or:     1.95

</pre>


<p>
<b>Answer: 1.95</b>
</p>
</li>
</ul>
<ul>
<li id="sec-10-2-3">Q3<br/>
Calculate the 24-year Rate Ratio for death comparing obese subjects
(exposed group, n=577) to normal weight subjects (non-exposed group,
n=1936).




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
<span style="color: #b22222;">/// I fitted this level to get the same table as in question</span>
quietly {
  <span style="color: #a020f0;">gen</span> bmi1_<span style="color: #008b8b;">cat</span>=.
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=1 if (bmi1&lt;18.5) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=2 if (bmi1&gt;=18.5 &amp; bmi1&lt;25) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=3 if (bmi1&gt;=25 &amp; bmi1&lt;30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=4 if (bmi1&gt;=30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
}
quietly <span style="color: #a020f0;">gen</span> obs = . 
quietly <span style="color: #a020f0;">replace</span> obs = 1 if bmi1_<span style="color: #008b8b;">cat</span>==4
quietly <span style="color: #a020f0;">replace</span> obs = 0 if bmi1_<span style="color: #008b8b;">cat</span>==2
ir death obs timedth
di <span style="color: #8b2252;">"irr: "</span> %8.2f <span style="color: #008b8b;">r</span>(irr)
</pre>



<pre class="example">
                 | obs                    |
                 |   Exposed   Unexposed  |      Total
-----------------+------------------------+------------
 Death indicator |       259         571  |        830
Time [years] to  |   11308.9    40708.74  |   52017.64
-----------------+------------------------+------------
                 |                        |
  Incidence rate |  .0229023    .0140265  |   .0159561
                 |                        |
                 |      Point estimate    |    [95% Conf. Interval]
                 |------------------------+------------------------
 Inc. rate diff. |         .0088758       |    .0058587     .011893 
 Inc. rate ratio |         1.632792       |    1.404331    1.894337 (exact)
 Attr. frac. ex. |         .3875522       |    .2879172    .4721108 (exact)
 Attr. frac. pop |          .120935       |
                 +-------------------------------------------------
                     (midp)   Pr(k&gt;=259) =                   0.0000 (exact)
                     (midp) 2*Pr(k&gt;=259) =                   0.0000 (exact)

irr:     1.63

</pre>


<p>
<b>Answer: 1.63</b>
</p>
</li>
</ul>
<ul>
<li id="sec-10-2-4">Q4<br/>
Calculate the 24-year Rate Ratio for developing coronary heart disease
comparing obese subjects (exposed group) to normal weight (non-exposed
group), excluding subjects with prevalent CHD at the 1956 exam.




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
<span style="color: #b22222;">/// I fitted this level to get the same table as in question</span>
quietly {
  <span style="color: #a020f0;">gen</span> bmi1_<span style="color: #008b8b;">cat</span>=.
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=1 if (bmi1&lt;18.5) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=2 if (bmi1&gt;=18.5 &amp; bmi1&lt;25) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=3 if (bmi1&gt;=25 &amp; bmi1&lt;30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=4 if (bmi1&gt;=30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
}
quietly <span style="color: #a020f0;">gen</span> obs = . 
quietly <span style="color: #a020f0;">replace</span> obs = 1 if bmi1_<span style="color: #008b8b;">cat</span>==4
quietly <span style="color: #a020f0;">replace</span> obs = 0 if bmi1_<span style="color: #008b8b;">cat</span>==2
ir anychd obs timechd if prevchd1==0
di <span style="color: #8b2252;">"irr: "</span> %8.2f <span style="color: #008b8b;">r</span>(irr)
</pre>



<pre class="example">
                 | obs                    |
                 |   Exposed   Unexposed  |      Total
-----------------+------------------------+------------
Incident Hosp MI |       180         349  |        529
Time [years] to  |  9387.737    37324.05  |   46711.79
-----------------+------------------------+------------
                 |                        |
  Incidence rate |  .0191739    .0093505  |   .0113248
                 |                        |
                 |      Point estimate    |    [95% Conf. Interval]
                 |------------------------+------------------------
 Inc. rate diff. |         .0098234       |    .0068555    .0127913 
 Inc. rate ratio |         2.050572       |    1.703396     2.46163 (exact)
 Attr. frac. ex. |         .5123311       |    .4129373     .593765 (exact)
 Attr. frac. pop |         .1743282       |
                 +-------------------------------------------------
                     (midp)   Pr(k&gt;=180) =                   0.0000 (exact)
                     (midp) 2*Pr(k&gt;=180) =                   0.0000 (exact)

irr:     2.05

</pre>


<p>
<b>Answer: 2.05</b>
</p>
</li>
</ul>
<ul>
<li id="sec-10-2-5">Q5<br/>
Calculate the 24-year Rate Ratio for developing coronary heart disease
comparing (obese or overweight) subjects (exposed group) to normal
weight (non-exposed group), excluding subjects with prevalent CHD at
the 1956 exam.




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
<span style="color: #b22222;">/// I fitted this level to get the same table as in question</span>
quietly {
  <span style="color: #a020f0;">gen</span> bmi1_<span style="color: #008b8b;">cat</span>=.
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=1 if (bmi1&lt;18.5) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=2 if (bmi1&gt;=18.5 &amp; bmi1&lt;25) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=3 if (bmi1&gt;=25 &amp; bmi1&lt;30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=4 if (bmi1&gt;=30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
}
quietly <span style="color: #a020f0;">gen</span> obsoov = .
quietly <span style="color: #a020f0;">replace</span> obsoov = 1 if bmi1_<span style="color: #008b8b;">cat</span>==4 | bmi1_<span style="color: #008b8b;">cat</span>==3
quietly <span style="color: #a020f0;">replace</span> obsoov = 0 if bmi1_<span style="color: #008b8b;">cat</span>==2
ir anychd obsoov timechd if prevchd1==0
di <span style="color: #8b2252;">"irr: "</span> %8.2f <span style="color: #008b8b;">r</span>(irr)
</pre>



<pre class="example">
                 | obsoov                 |
                 |   Exposed   Unexposed  |      Total
-----------------+------------------------+------------
Incident Hosp MI |       686         349  |       1035
Time [years] to  |  42251.22    37324.05  |   79575.28
-----------------+------------------------+------------
                 |                        |
  Incidence rate |  .0162362    .0093505  |   .0130066
                 |                        |
                 |      Point estimate    |    [95% Conf. Interval]
                 |------------------------+------------------------
 Inc. rate diff. |         .0068857       |    .0053241    .0084473 
 Inc. rate ratio |         1.736394       |    1.524219    1.980922 (exact)
 Attr. frac. ex. |         .4240938       |    .3439265    .4951846 (exact)
 Attr. frac. pop |         .2810902       |
                 +-------------------------------------------------
                     (midp)   Pr(k&gt;=686) =                   0.0000 (exact)
                     (midp) 2*Pr(k&gt;=686) =                   0.0000 (exact)

irr:     1.74

</pre>


<p>
<b>Answer: 1.74</b>
</p>
</li>
</ul>
<ul>
<li id="sec-10-2-6">Q6<br/>
Calculate the 24-year Rate Ratio for developing coronary heart disease
comparing underweight subjects (exposed group) to normal weight
(non-exposed group), excluding subjects with prevalent CHD at the 1956
exam.




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
<span style="color: #b22222;">/// I fitted this level to get the same table as in question</span>
quietly {
  <span style="color: #a020f0;">gen</span> bmi1_<span style="color: #008b8b;">cat</span>=.
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=1 if (bmi1&lt;18.5) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=2 if (bmi1&gt;=18.5 &amp; bmi1&lt;25) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=3 if (bmi1&gt;=25 &amp; bmi1&lt;30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
  <span style="color: #a020f0;">replace</span> bmi1_<span style="color: #008b8b;">cat</span>=4 if (bmi1&gt;=30) &amp; !<span style="color: #008b8b;">missing</span>(bmi1)
}
quietly <span style="color: #a020f0;">gen</span> underweight = .
quietly <span style="color: #a020f0;">replace</span> underweight = 1 if bmi1_<span style="color: #008b8b;">cat</span>==1
quietly <span style="color: #a020f0;">replace</span> underweight = 0 if bmi1_<span style="color: #008b8b;">cat</span>==2 
ir anychd underweight timechd if prevchd1==0
di <span style="color: #8b2252;">"irr: "</span> %8.2f <span style="color: #008b8b;">r</span>(irr)
</pre>



<pre class="example">
                 | underweight            |
                 |   Exposed   Unexposed  |      Total
-----------------+------------------------+------------
Incident Hosp MI |         6         349  |        355
Time [years] to  |   1119.57    37324.05  |   38443.62
-----------------+------------------------+------------
                 |                        |
  Incidence rate |  .0053592    .0093505  |   .0092343
                 |                        |
                 |      Point estimate    |    [95% Conf. Interval]
                 |------------------------+------------------------
 Inc. rate diff. |        -.0039913       |   -.0083903    .0004076 
 Inc. rate ratio |         .5731434       |    .2089001    1.260145 (exact)
 Prev. frac. ex. |         .4268566       |   -.2601451    .7910999 (exact)
 Prev. frac. pop |         .0124311       |
                 +-------------------------------------------------
                     (midp)   Pr(k&lt;=6) =                     0.0798 (exact)
                     (midp) 2*Pr(k&lt;=6) =                     0.1596 (exact)

irr:     0.57

</pre>


<p>
<b>Answer: 0.57</b>
</p>
</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-11" class="outline-3">
<h3 id="sec-11">Home Work 5</h3>
<div class="outline-text-3" id="text-11">


</div>

<div id="outline-container-11-1" class="outline-4">
<h4 id="sec-11-1">Central Limit Theorem and Confidence Intervals</h4>
<div class="outline-text-4" id="text-11-1">

<p>According to the WHO Global Database on Anaemia, the mean hemoglobin
levels among primary school children in Delhi were estimated at \(\mu=
108\) g/L, with standard deviation \(\sigma=12.5\) g/L. (Source:
<a href="http://who.int/vmnis/anaemia/data/database/countries/ind_ida.pdf">http://who.int/vmnis/anaemia/data/database/countries/ind_ida.pdf</a>)
</p>
<p>
Suppose we took a random sample of <b>75 primary school children</b> in
Delhi. Denote the mean hemoglobin levels in this sample as
\(\bar{x}\). Throughout this question, assume that the sample size is
large enough that the Central Limit Theorem is applicable and that
\(\sigma\) is known.
</p>
<ul>
<li id="sec-11-1-1">Q1<br/>
   According to the Central Limit Theorem, what is the expected value
   (mean) of \(\bar{x}\)?

<p>   
   <b>Answer: 108</b>
</p></li>
</ul>
<ul>
<li id="sec-11-1-2">Q2<br/>
   According to the Central Limit Theorem, what is the standard
   deviation of \(\bar{x}\)?




<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 75
di <span style="color: #8b2252;">"std: "</span> %8.2f `<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
</pre>


<pre class="example">

std:     1.44

</pre>


<p>
   <b>Answer: 1.44</b>
</p>


<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 75
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> std</span> = `<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
di <span style="color: #8b2252;">"exp. mean of sample = mean of population: "</span> 108
di <span style="color: #8b2252;">"standard deviation of sample mean: "</span> %8.2f `<span style="color: #a0522d;">std</span>'
</pre>


<pre class="example">

exp. mean of sample = mean of population: 108

standard deviation of sample mean:     1.44

</pre>


</li>
</ul>
<ul>
<li id="sec-11-1-3">Q3<br/>
   Suppose we take a large number of samples of <b>size 75</b>. What
   proportion of the samples would we expect to have a sample mean
   \(\bar{x}\) that lies between <b>106</b> and <b>110 g/L</b>?



<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 75
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 108.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> std</span> = `<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z1</span> = (106 - `<span style="color: #a0522d;">mean</span>')/`<span style="color: #a0522d;">std</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z2</span> = (110 - `<span style="color: #a0522d;">mean</span>')/`<span style="color: #a0522d;">std</span>'
di <span style="color: #8b2252;">"proportion: "</span> %8.2f normal(`<span style="color: #a0522d;">z2</span>')-normal(`<span style="color: #a0522d;">z1</span>')
</pre>


<pre class="example">

proportion:     0.83

</pre>


<p>
   <b>Answer: 0.83</b>
</p>
</li>
</ul>
<ul>
<li id="sec-11-1-4">Q4<br/>
   Suppose instead we repeatedly took random samples of <b>size 25</b>. What
   proportion of the samples would we expect to have a sample mean
   that lies between <b>106</b> and <b>110 g/L</b>?



<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 25
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 108.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> std</span> = `<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z1</span> = (106 - `<span style="color: #a0522d;">mean</span>')/`<span style="color: #a0522d;">std</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z2</span> = (110 - `<span style="color: #a0522d;">mean</span>')/`<span style="color: #a0522d;">std</span>'
di <span style="color: #8b2252;">"proportion: "</span> %8.2f normal(`<span style="color: #a0522d;">z2</span>')-normal(`<span style="color: #a0522d;">z1</span>')
</pre>


<pre class="example">

proportion:     0.58

</pre>


<p>
   <b>Answer: 0.58</b>
</p>
</li>
</ul>
<ul>
<li id="sec-11-1-5">Q5<br/>
Again, suppose we repeatedly took samples of <b>size 75</b>. What
proportion of the samples would we expect to have a mean less <b>than 103</b>?



<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 75
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 108
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> std</span> = `<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z1</span> = (103 - `<span style="color: #a0522d;">mean</span>')/`<span style="color: #a0522d;">std</span>'
di  <span style="color: #8b2252;">"proportion: "</span>  %8.5f normal(`<span style="color: #a0522d;">z1</span>')
</pre>


<pre class="example">

proportion:  0.00027

</pre>


<p>
    <b>Answer: 0.000266</b>
</p>
</li>
</ul>
<ul>
<li id="sec-11-1-6">Q6<br/>
If we repeatedly took samples of <b>size 75</b>, \(\bar{x}\) we would
expect that, in <b>20% of the samples</b>, would be greater than ___?



<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 75
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 108.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> std</span> = `<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z1</span> =  invnormal(1-0.2)
di  <span style="color: #8b2252;">"20% of the samples is greater than "</span>  %8.2f `<span style="color: #a0522d;">z1</span>'*`<span style="color: #a0522d;">std</span>'+`<span style="color: #a0522d;">mean</span>'
</pre>


<pre class="example">

20% of the samples is greater than   109.21

</pre>


<p>
  <b>Answer: 109.21</b>
</p>
</li>
</ul>
<ul>
<li id="sec-11-1-7">Q7<br/>
After taking a sample of <b>size 75</b>, we found that the sample mean
was $\bar{x}$=103. Construct a 95% confidence interval for \(\mu\).



<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 75
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sigma</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sample_mean</span> = 103.0
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> dM</span> = 1.96*`<span style="color: #a0522d;">sigma</span>'/<span style="color: #008b8b;">sqrt</span>(`<span style="color: #a0522d;">N</span>')
di  <span style="color: #8b2252;">"interval: "</span> %8.2f `<span style="color: #a0522d;">sample_mean</span>'-`<span style="color: #a0522d;">dM</span>'  <span style="color: #8b2252;">" "</span> %8.2f `<span style="color: #a0522d;">sample_mean</span>'+`<span style="color: #a0522d;">dM</span>'
</pre>


<pre class="example">

interval:   100.17   105.83

</pre>


<p>
  <b>Answer: 100.171 105.829</b>
</p></li>
</ul>
</div>

</div>

<div id="outline-container-11-2" class="outline-4">
<h4 id="sec-11-2">Hypothesis Testing with known Variance</h4>
<div class="outline-text-4" id="text-11-2">

<p>Now, let's switch gears and assume that we didn't know the true
population mean \(\mu\), and we only observed a sample of <b>25 school</b>
children in Delhi. Let's use the sample mean from this set of children
to make inference about the true population mean \(\mu\).
</p>
<p>
For this question, assume that \(\sigma=12.5\) is known and that the
sample size of <b>25</b> is large enough to use the Central Limit
Theorem. So, for this question, we will base our inferences off of the
<b>normal</b> distribution, not the t-distribution.
</p>
<p>
In this scenario, we can conduct a <b>one-sample Z-test</b> for inference
about in a population with known variance \(\sigma^2\). To test \(H_0:
\mu = \mu_0\), we can use the test statistic:
\begin{equation}
Z^* = \frac{\bar{x} - \mu_0}{\sigma/\sqrt{n}}
\end{equation}
</p>
<p>               
Under the null hypothesis, \(Z^* \sim N(0,1)\). So, we can use the
standard normal distribution to calculate a p-value for this
hypothesis test:
</p>

<ul>
<li>For the one-sided test with alternative hypothesis \(H_a: \mu &gt;
  \mu_0\), we can calculate a p-value using the formula \(p = P(Z &gt;
  Z^*)\).
</li>
<li>For the one-sided test with alternative hypothesis \(H_a: \mu \le
  \mu_0\), we can calculate a p-value using the formula \(p = 2P(Z \le
  Z^*)\).
</li>
<li>For the two-sided test with alternative hypothesis \(H_a: \mu \neq
  \mu_0\), we can calculate a p-value using the formula \(p = 2P(Z \le
  -|Z^*|)\).
</li>
</ul>


<p>
Note: there is no command for directly conducting this one-sample
Z-test in Stata. However, you can use the normal function in Stata to
calculate the p-values.
</p>
<ul>
<li id="sec-11-2-1">Q1<br/>
In a sample of size 25, what is the value of the test statistic
testing whether the mean hemoglobin level is equal to 108 g/L versus
the alternative that it is <b>not equal</b> to 108 g/L, when
\(\bar{x}=103\). Use a one-sample Z-test. What is the p-value
corresponding to this two-sided hypothesis test?



<p>
I use <code>ttesti</code> to get test statistics, but to get P value I use normal
distribution.
</p>


<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 25
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 103
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> val</span> = 108
ttesti `<span style="color: #a0522d;">N</span>' `<span style="color: #a0522d;">mean</span>' `<span style="color: #a0522d;">sd</span>' `<span style="color: #a0522d;">val</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z</span> = <span style="color: #008b8b;">r</span>(t)
di <span style="color: #8b2252;">"test statistic: "</span> `<span style="color: #a0522d;">z</span>'
di <span style="color: #8b2252;">"test statistic: "</span> %8.4f 2*normal(`<span style="color: #a0522d;">z</span>')
</pre>



<pre class="example">
One-sample t test
------------------------------------------------------------------------------
         |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |      25         103         2.5        12.5    97.84025    108.1597
------------------------------------------------------------------------------
    mean = mean(x)                                                t =  -2.0000
Ho: mean = 108                                   degrees of freedom =       24

   Ha: mean &lt; 108               Ha: mean != 108               Ha: mean &gt; 108
 Pr(T &lt; t) = 0.0285         Pr(|T| &gt; |t|) = 0.0569          Pr(T &gt; t) = 0.9715

test statistic: -2

test statistic:   0.0455

</pre>


<p>
 <b>Answer: -2 0.0455</b>
</p>
</li>
</ul>
<ul>
<li id="sec-11-2-2">Q2<br/>
In a sample of size 25, what is the value of the test statistic for
testing whether the mean hemoglobin level in the population is equal
to 108 g/L versus the alternative that it is <b>less than</b> 108 g/L, when
\(\bar{x} = 103\). What is the p-value corresponding to this one-sided
test?




<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 25
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 103
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> val</span> = 108
ttesti `<span style="color: #a0522d;">N</span>' `<span style="color: #a0522d;">mean</span>' `<span style="color: #a0522d;">sd</span>' `<span style="color: #a0522d;">val</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z</span> = <span style="color: #008b8b;">r</span>(t)
di <span style="color: #8b2252;">"test statistic: "</span> `<span style="color: #a0522d;">z</span>'
di <span style="color: #8b2252;">"test statistic: "</span> %8.4f normal(`<span style="color: #a0522d;">z</span>')
</pre>



<pre class="example">
One-sample t test
------------------------------------------------------------------------------
         |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |      25         103         2.5        12.5    97.84025    108.1597
------------------------------------------------------------------------------
    mean = mean(x)                                                t =  -2.0000
Ho: mean = 108                                   degrees of freedom =       24

   Ha: mean &lt; 108               Ha: mean != 108               Ha: mean &gt; 108
 Pr(T &lt; t) = 0.0285         Pr(|T| &gt; |t|) = 0.0569          Pr(T &gt; t) = 0.9715

test statistic: -2

test statistic:   0.0228

</pre>


<p>
 <b>Answer: -2 0.0228</b>
</p>
</li>
</ul>
<ul>
<li id="sec-11-2-3">Q3<br/>
In a sample of size 25, what is the value of the test statistic for
testing whether the mean hemoglobin level in the population is equal
to 108 g/L versus the alternative that it is <b>greater than</b> 108 g/L,
when \(\bar{x} = 103\). What is the p-value corresponding to this
one-sided test?




<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> N</span> = 25
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean</span> = 103
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd</span> = 12.5
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> val</span> = 108
ttesti `<span style="color: #a0522d;">N</span>' `<span style="color: #a0522d;">mean</span>' `<span style="color: #a0522d;">sd</span>' `<span style="color: #a0522d;">val</span>'
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z</span> = <span style="color: #008b8b;">r</span>(t)
di <span style="color: #8b2252;">"test statistic: "</span> `<span style="color: #a0522d;">z</span>'
di <span style="color: #8b2252;">"test statistic: "</span> %8.4f 1-normal(`<span style="color: #a0522d;">z</span>')
</pre>



<pre class="example">
One-sample t test
------------------------------------------------------------------------------
         |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |      25         103         2.5        12.5    97.84025    108.1597
------------------------------------------------------------------------------
    mean = mean(x)                                                t =  -2.0000
Ho: mean = 108                                   degrees of freedom =       24

   Ha: mean &lt; 108               Ha: mean != 108               Ha: mean &gt; 108
 Pr(T &lt; t) = 0.0285         Pr(|T| &gt; |t|) = 0.0569          Pr(T &gt; t) = 0.9715

test statistic: -2

test statistic:   0.9772

</pre>


<p>
  <b>Answer: -2 0.9772</b>
</p></li>
</ul>
</div>

</div>

<div id="outline-container-11-3" class="outline-4">
<h4 id="sec-11-3">Confidence intervals and testing with unknown variance</h4>
<div class="outline-text-4" id="text-11-3">

<p>Suppose now that we are interested in the distribution of hemoglobin
levels in Mumbai. We decide that it is unreasonable to extrapolate the
Delhi results to Mumbai, and therefore the population standard
deviation is unknown. We take a random sample of 15 children in
Mumbai. The sample mean is \(\bar{x}=115\) g/L, with sample standard
deviation \(s=10.2\) g/L. Assume hemoglobin levels in Mumbai are
normally distributed (we could check this by looking at the
distribution of hemoglobin levels in other similar populations).
</p>
<ul>
<li id="sec-11-3-1">Q1<br/>
Construct a two-sided 95% confidence interval for \(\mu\).

</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-12" class="outline-3">
<h3 id="sec-12">Home Work 6</h3>
<div class="outline-text-3" id="text-12">


</div>

<div id="outline-container-12-1" class="outline-4">
<h4 id="sec-12-1">Power and Sample Size</h4>
<div class="outline-text-4" id="text-12-1">

<p>Power and Sample Size. Recall (from the previous problem set) that
according to the WHO Global Database on Anaemia, the mean hemoglobin
levels among primary school children in Delhi were estimated at \(\mu\) =
108 g/L, with standard deviation \(\sigma\) = 12.5 g/L. Suppose you decide to
go and conduct your own study. You aim to test whether hemoglobin
levels in Mumbai are similar to the estimates from Delhi. For your
calculations, you assume that the standard deviation of hemoglobin
levels in Mumbai is known and is equal to that in Delhi. We aim to
test: 
\begin{equation}
H0 : µM ≤ 108, HA : µM > 108
\end{equation} 
You plan to conduct this one-sided test at the \(\alpha\) = 0.05 level
of signficance.
</p>
<ul>
<li id="sec-12-1-1">Q3<br/>
If you randomly sample 30 children, what is the power of your test
against the alternative \(\mu_M\) = 112?



<pre class="src src-stata">sampsi 108 112, sd1(12.5) n1(30) onesample onesided
di <span style="color: #8b2252;">"power: "</span> <span style="color: #008b8b;">r</span>(power)
</pre>



<pre class="example">
Estimated power for one-sample comparison of mean
  to hypothesized value

Test Ho: m =    108, where m is the mean in the population

Assumptions:

         alpha =   0.0500  (one-sided)
 alternative m =      112
            sd =     12.5
 sample size n =       30

Estimated power:

         power =   0.5429

power: .54294605

</pre>


</li>
</ul>
<ul>
<li id="sec-12-1-2">Q4<br/>
If the true mean levels of hemoglobin were 115 g/L, how many children do you need to
sample to have 80% power (assume the standard deviation remains the same as Delhi)?




<pre class="src src-stata">sampsi 108 115, sd1(12.5) power(.80) onesample onesided
di <span style="color: #8b2252;">"number of children: "</span> <span style="color: #008b8b;">r</span>(N_1)
</pre>



<pre class="example">
Estimated sample size for one-sample comparison of mean
  to hypothesized value

Test Ho: m =    108, where m is the mean in the population

Assumptions:

         alpha =   0.0500  (one-sided)
         power =   0.8000
 alternative m =      115
            sd =     12.5

Estimated required sample size:

             n =       20

number of children: 20

</pre>


</li>
</ul>
<ul>
<li id="sec-12-1-3">Q5<br/>
If the true mean levels of hemoglobin were 112 g/L, how many children
do you need to sample to restrict your type II error below 10%?



<pre class="src src-stata">sampsi 108 112, sd1(12.5) power(0.90) <span style="color: #008b8b;">alpha</span>(0.05) onesample onesided
di <span style="color: #8b2252;">"number of children: "</span> <span style="color: #008b8b;">r</span>(N_1)
</pre>


<pre class="example">
Estimated sample size for one-sample comparison of mean
  to hypothesized value

Test Ho: m =    108, where m is the mean in the population

Assumptions:

         alpha =   0.0500  (one-sided)
         power =   0.9000
 alternative m =      112
            sd =     12.5

Estimated required sample size:

             n =       84

number of children: 84

</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-12-2" class="outline-4">
<h4 id="sec-12-2">Two-Sample t-test</h4>
<div class="outline-text-4" id="text-12-2">

<p>Schiff et al. (1990) investigated the effect of low doses of aspirin
on women with mild pregnancy-induced hypertension. Forty-seven women
hospitalized at 30-36 weeks’ gestation because of mild
pregnancy-induced hypertension were treated by a daily dose of either
100 mg aspirin or placebo. The <b>23 women</b> who received aspirin had a
mean arterial blood pressure of <b>111 mm Hg</b> with a standard deviation
of <b>8 mm Hg</b>. The <b>24 women</b> who received placebo had a mean arterial
blood pressure of <b>109 mm Hg</b> and a standard deviation of <b>8 mm Hg</b>.
</p>
<p>
Source: Schiff, E., Barkai,G., Ben-Baruch G., and Mashiach, S.,
"Low-Dose Aspirin Does Not Influence the Clinical Course of Women with
Mild Pregnancy-Induced Hypertension," Obstetrics and Gynecology,
Vol. 76, November 1990, 742-744.
</p>
<ul>
<li id="sec-12-2-1">Q1<br/>
Conduct a two sample t-test with equal variances at \(\alpha = 0.05\)
to test whether the population mean arterial blood pressure for women
treated with aspirin is equal to the population mean arterial blood
pressure for women treated with placebo. What is the value of the test
statistic?

</li>
</ul>
<ul>
<li id="sec-12-2-2">Q2<br/>
How many degrees of freedom does your test statistic have?

</li>
</ul>
<ul>
<li id="sec-12-2-3">Q3<br/>
The p-value for this test is greater than 0.05. Based on this
result can we conclude that the population mean arterial blood
pressure for pregnant women treated with aspirin is equal to the
population mean arterial blood pressure for pregnant women treated
with placebo? A) Yes B) No




<pre class="src src-stata"><span style="color: #008b8b;">local</span><span style="color: #a0522d;"> obs1</span> = 23
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean1</span> = 111
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd1</span> = 8
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> obs2</span> = 24
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> mean2</span> = 109
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> sd2</span> = 8
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> level</span> = 95
ttesti `<span style="color: #a0522d;">obs1</span>' `<span style="color: #a0522d;">mean1</span>' `<span style="color: #a0522d;">sd1</span>' `<span style="color: #a0522d;">obs2</span>' `<span style="color: #a0522d;">mean2</span>' `<span style="color: #a0522d;">sd2</span>', level(`<span style="color: #a0522d;">level</span>')
di <span style="color: #8b2252;">"the test statistic = "</span> <span style="color: #008b8b;">r</span>(t)
di <span style="color: #8b2252;">"degrees of freedom = "</span> <span style="color: #008b8b;">r</span>(df_t)
di <span style="color: #8b2252;">"two-sided p-value = "</span> <span style="color: #008b8b;">r</span>(p)
<span style="color: #008b8b;">if</span> <span style="color: #008b8b;">r</span>(p)&gt;1-`<span style="color: #a0522d;">level</span>'/100 {
    <span style="color: #008b8b;">di</span> <span style="color: #8b2252;">"We reject H0: mean(x)==mean(y)"</span>
} 
<span style="color: #008b8b;">else</span> {
  <span style="color: #008b8b;">di</span> <span style="color: #8b2252;">"We cannot reject H0: mean(x)==mean(y)"</span>
}
</pre>



<pre class="example">
Two-sample t test with equal variances
------------------------------------------------------------------------------
         |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
---------+--------------------------------------------------------------------
       x |      23         111    1.668115           8    107.5405    114.4595
       y |      24         109    1.632993           8    105.6219    112.3781
---------+--------------------------------------------------------------------
combined |      47    109.9787    1.163542     7.97684    107.6366    112.3208
---------+--------------------------------------------------------------------
    diff |                   2    2.334368               -2.701659    6.701659
------------------------------------------------------------------------------
    diff = mean(x) - mean(y)                                      t =   0.8568
Ho: diff = 0                                     degrees of freedom =       45

    Ha: diff &lt; 0                 Ha: diff != 0                 Ha: diff &gt; 0
 Pr(T &lt; t) = 0.8019         Pr(|T| &gt; |t|) = 0.3961          Pr(T &gt; t) = 0.1981

the test statistic = .85676283

degrees of freedom = 45

two-sided p-value = .39611566

We reject H0: mean(x)==mean(y)

</pre>


</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-13" class="outline-3">
<h3 id="sec-13">Home Work 7</h3>
<div class="outline-text-3" id="text-13">


</div>

<div id="outline-container-13-1" class="outline-4">
<h4 id="sec-13-1">Inference for proportions</h4>
<div class="outline-text-4" id="text-13-1">

<ul>
<li id="sec-13-1-1">Q1<br/>
Construct a 95% confidence interval for <b>the proportion</b> of infants
experiencing <b>the composite outcome</b> in <b>the fresh</b> red blood cell
group, using the following methods: exact binomial, Wilson normal
approximation.

</li>
</ul>
<ul>
<li id="sec-13-1-2">Q2<br/>
Is the normal approximation to the binomial appropriate in this
setting?  <code>I need the number of observations with fresh==1 and fresh==0</code>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta, <span style="color: #a020f0;">clear</span>
<span style="color: #008b8b;">ci</span> outcome if fresh==1, binomial
di <span style="color: #008b8b;">r</span>(mean)
<span style="color: #008b8b;">ci</span> outcome if fresh==1, binomial wilson
</pre>



<pre class="example">
                                                         -- Binomial Exact --
    Variable |        Obs        Mean    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
     outcome |        188    .5265957    .0364146        .4526364    .5997032

.52659574

                                                         ------ Wilson ------
    Variable |        Obs        Mean    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
     outcome |        188    .5265957    .0364146         .455408    .5967184

</pre>


</li>
</ul>
<ul>
<li id="sec-13-1-3">Q3<br/>
Suppose you wanted to calculate a 95% confidence interval for
infants experiencing intraventricular hemorrhage after receiving a
fresh blood transfusion as well. Examine the table above. Is the
Wilson confidence interval still appropriate?

</li>
</ul>
<ul>
<li id="sec-13-1-4">Q4<br/>
Estimate and construct a large-sample 95% confidence interval for
the risk difference for experiencing the composite outcome for those
with fresh blood versus the standard protocol blood. Calculate the
risk difference as the estimated proportion in the fresh blood group
minus estimated proportion in the standard blood group.



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta
<span style="color: #a020f0;">gen</span> nfresh = 1-fresh
prtest outcome, <span style="color: #008b8b;">by</span> (nfresh)
</pre>



<pre class="example">
Two-sample test of proportions                     0: Number of obs =      188
                                                   1: Number of obs =      189
------------------------------------------------------------------------------
    Variable |       Mean   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           0 |   .5265957   .0364146                      .4552244    .5979671
           1 |   .5291005    .036308                      .4579382    .6002629
-------------+----------------------------------------------------------------
        diff |  -.0025048   .0514227                     -.1032915    .0982819
             |  under Ho:   .0514228    -0.05   0.961
------------------------------------------------------------------------------
        diff = prop(0) - prop(1)                                  z =  -0.0487
    Ho: diff = 0

    Ha: diff &lt; 0                 Ha: diff != 0                 Ha: diff &gt; 0
 Pr(Z &lt; z) = 0.4806         Pr(|Z| &lt; |z|) = 0.9612          Pr(Z &gt; z) = 0.5194

</pre>


</li>
</ul>
<ul>
<li id="sec-13-1-5">Q5<br/>
Use a two-sample test of proportions to test whether there is a
difference in the proportion of infants experiencing the composite
outcome between fresh blood group and the standard protocol group at
\(\alpha=0.05\) the level of significance.

<p>
What is the value of the test statistic?
What is the p-value?
</p>


<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta
<span style="color: #a020f0;">gen</span> nfresh = 1-fresh
prtest outcome, <span style="color: #008b8b;">by</span> (nfresh)
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> z</span> = <span style="color: #008b8b;">r</span>(z)
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> P</span> = 1 - (normal(<span style="color: #008b8b;">abs</span>(`<span style="color: #a0522d;">z</span>'))-normal(-<span style="color: #008b8b;">abs</span>(`<span style="color: #a0522d;">z</span>')))
di <span style="color: #8b2252;">"==================== answers ===================="</span>
di  <span style="color: #8b2252;">"test statistic = "</span>   `<span style="color: #a0522d;">z</span>'
di  <span style="color: #8b2252;">"Pr(|Z| &lt; |z|) = "</span>   `<span style="color: #a0522d;">P</span>'
</pre>



<pre class="example">
Two-sample test of proportions                     0: Number of obs =      188
                                                   1: Number of obs =      189
------------------------------------------------------------------------------
    Variable |       Mean   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
           0 |   .5265957   .0364146                      .4552244    .5979671
           1 |   .5291005    .036308                      .4579382    .6002629
-------------+----------------------------------------------------------------
        diff |  -.0025048   .0514227                     -.1032915    .0982819
             |  under Ho:   .0514228    -0.05   0.961
------------------------------------------------------------------------------
        diff = prop(0) - prop(1)                                  z =  -0.0487
    Ho: diff = 0

    Ha: diff &lt; 0                 Ha: diff != 0                 Ha: diff &gt; 0
 Pr(Z &lt; z) = 0.4806         Pr(|Z| &lt; |z|) = 0.9612          Pr(Z &gt; z) = 0.5194

==================== answers ====================

test statistic = -.04870957

Pr(|Z| &lt; |z|) = .96115075

</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-13-2" class="outline-4">
<h4 id="sec-13-2">Contingency Tables</h4>
<div class="outline-text-4" id="text-13-2">

<p>Continue using the Fergusson et al. (2012) clinical trial data to
complete the following questions. Again, use either the dataset from
the previous question, hw7.dta, or the study results in the table
below.
<code>table is missing</code>
</p>
<ul>
<li id="sec-13-2-1">Q1<br/>
Estimate the odds ratio and a 95% confidence interval for
experiencing the composite outcome for those in the fresh blood group
versus standard protocol blood group.

<p>
OR Estimate:
95% Confidence Interval:
</p>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta, <span style="color: #a020f0;">clear</span>
<span style="color: #008b8b;">cs</span> outcome fresh, or woolf
</pre>



<pre class="example">
                 | fresh                  |
                 |   Exposed   Unexposed  |      Total
-----------------+------------------------+------------
           Cases |        99         100  |        199
        Noncases |        89          89  |        178
-----------------+------------------------+------------
           Total |       188         189  |        377
                 |                        |
            Risk |  .5265957    .5291005  |   .5278515
                 |                        |
                 |      Point estimate    |    [95% Conf. Interval]
                 |------------------------+------------------------
 Risk difference |        -.0025048       |   -.1032915    .0982819 
      Risk ratio |          .995266       |    .8222696    1.204659 
 Prev. frac. ex. |          .004734       |   -.2046588    .1777304 
 Prev. frac. pop |         .0023607       |
      Odds ratio |              .99       |    .6607011    1.483424 (Woolf)
                 +-------------------------------------------------
                               chi2(1) =     0.00  Pr&gt;chi2 = 0.9612

</pre>


</li>
</ul>
<ul>
<li id="sec-13-2-2">Q2<br/>
Construct a 2x2 table for the composite outcome versus blood
group. Are the expected cell counts large enough to conduct a Pearson
Chi-square test?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta, <span style="color: #a020f0;">clear</span>
tabulate outcome fresh, row expected freq
</pre>



<pre class="example">
+--------------------+
| Key                |
|--------------------|
|     frequency      |
| expected frequency |
|   row percentage   |
+--------------------+

           |         fresh
   outcome |         0          1 |     Total
-----------+----------------------+----------
         0 |        89         89 |       178 
           |      89.2       88.8 |     178.0 
           |     50.00      50.00 |    100.00 
-----------+----------------------+----------
         1 |       100         99 |       199 
           |      99.8       99.2 |     199.0 
           |     50.25      49.75 |    100.00 
-----------+----------------------+----------
     Total |       189        188 |       377 
           |     189.0      188.0 |     377.0 
           |     50.13      49.87 |    100.00 

</pre>


</li>
</ul>
<ul>
<li id="sec-13-2-3">Q3<br/>
Using the Pearson chi-square test, determine if there is evidence
of an association between blood group and the composite outcome at the
level of significance.  What is the value of the test statistic? Round
your answer to two decimal places.




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/hw7.cb28cba7dca3.dta, <span style="color: #a020f0;">clear</span>
tabulate outcome fresh, expected chi2
</pre>



<pre class="example">
+--------------------+
| Key                |
|--------------------|
|     frequency      |
| expected frequency |
+--------------------+

           |         fresh
   outcome |         0          1 |     Total
-----------+----------------------+----------
         0 |        89         89 |       178 
           |      89.2       88.8 |     178.0 
-----------+----------------------+----------
         1 |       100         99 |       199 
           |      99.8       99.2 |     199.0 
-----------+----------------------+----------
     Total |       189        188 |       377 
           |     189.0      188.0 |     377.0 

          Pearson chi2(1) =   0.0024   Pr = 0.961

</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-13-3" class="outline-4">
<h4 id="sec-13-3">Final Thoughts on the Blood Transfusion Trial</h4>
<div class="outline-text-4" id="text-13-3">

<ul>
<li id="sec-13-3-1">Q4<br/>
In this study, the authors state that they powered the study to
detect an absolute difference of 15% in the two groups with 80% power,
using a 2-sided test with . After a few more adjustments, their final
sample size calculation was 450. Now suppose you want to replicate the
study using a different population. Given that the authors did not
find an association in their data, you decide to increase the power
and decrease the difference detected between standard and fresh
groups. Using an equal number of infants in both groups, what is the
total sample size needed in order to achieve 90% power, assuming that
the proportion of infants experiencing the composite outcome in the
standard group was 55% and 45% in the fresh blood group (again, with
).




<pre class="src src-stata">sampsi .55 .45, <span style="color: #008b8b;">alpha</span>(0.05) power(0.90)
di  <span style="color: #8b2252;">"total sample size: "</span>  <span style="color: #008b8b;">r</span>(N_1) + <span style="color: #008b8b;">r</span>(N_2)
</pre>



<pre class="example">
Estimated sample size for two-sample comparison of proportions

Test Ho: p1 = p2, where p1 is the proportion in population 1
                    and p2 is the proportion in population 2
Assumptions:

         alpha =   0.0500  (two-sided)
         power =   0.9000
            p1 =   0.5500
            p2 =   0.4500
         n2/n1 =   1.00

Estimated required sample sizes:

            n1 =      544
            n2 =      544

total sample size: 1088

</pre>


</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-14" class="outline-3">
<h3 id="sec-14">Home Work 8</h3>
<div class="outline-text-3" id="text-14">


</div>

<div id="outline-container-14-1" class="outline-4">
<h4 id="sec-14-1">Survey Design</h4>
<div class="outline-text-4" id="text-14-1">

<ul>
<li id="sec-14-1-1">Q1<br/>
Suppose you decided to randomly sample 1,700 people from the city
of Boston (call this Design 1). For any given individual in South
Dorchester, what is the probability of being selected in the survey?
What is this probability for an individual in Harbor Islands?

</li>
</ul>
<ul>
<li id="sec-14-1-2">Q3<br/>
Now, you randomly sample 100 people within each neighborhood
(Design 2). What is the probability of a random individual in South
Dorchester being sampled? What is the probability of a randomly
selected individual in Harbor Islands being sampled?

</li>
</ul>
<ul>
<li id="sec-14-1-3">Q8<br/>
Next, you decide you do not want to visit all 17 neighborhoods, so
you randomly sample 10 neighborhoods. Within each sampled neighborhood
selected, you randomly sample 170 people. Call this Design 4. What is
the probability of a random individual in South Dorchester being
included in the survey? What is the probability of a random individual
in Harbor Islands being included in the survey?

<p>
Content of <a href="boston.csv">boston.csv</a>
</p>


<pre class="example">neighborhood           , pop
South End              ,  34669   
Central                ,  30901   
Fenway - Kenmore       ,  40898   
South Boston           ,  33688   
Charlestown            ,  16439   
Allston - Brighton     ,  74997   
West Roxbury           ,  30445   
Roxbury                ,  59790   
East Boston            ,  40508   
Jamaica Plain          ,  39897   
Back Bay - Beacon Hill ,  27476   
Hyde Park              ,  31813   
North Dorchester       ,  28384   
South Dorchester       ,  59949   
Roslindale             ,  32589   
Mattapan               ,  34616   
Harbor Islands         ,  535      
</pre>



<pre class="src src-stata">quietly <span style="color: #a020f0;">insheet</span> <span style="color: #008b8b;">using</span> <span style="color: #8b2252;">"datasets/boston.csv"</span>
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nsel_d1</span> = 1000
quietly <span style="color: #008b8b;">sum</span> pop
di  <span style="color: #8b2252;">"P (design 1, both): "</span>  `<span style="color: #a0522d;">nsel_d1</span>'/<span style="color: #008b8b;">r</span>(mean)

<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nsel_d2</span> = 100
quietly <span style="color: #008b8b;">sum</span> pop if neighborhood==<span style="color: #8b2252;">"South Dorchester"</span>
di  <span style="color: #8b2252;">"P (design 2, South Dorchester): "</span>  `<span style="color: #a0522d;">nsel_d2</span>'/<span style="color: #008b8b;">r</span>(mean)
quietly <span style="color: #008b8b;">sum</span> pop if neighborhood==<span style="color: #8b2252;">"Harbor Islands"</span>
di  <span style="color: #8b2252;">"P (design 2, Harbor Islands): "</span>  `<span style="color: #a0522d;">nsel_d2</span>'/<span style="color: #008b8b;">r</span>(mean)

<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nn_d4</span> = 10
<span style="color: #008b8b;">local</span><span style="color: #a0522d;"> nsel_d4</span> = 170
quietly <span style="color: #008b8b;">sum</span> pop if neighborhood==<span style="color: #8b2252;">"South Dorchester"</span>
di  <span style="color: #8b2252;">"P(design 2, South Dorchester): "</span>  `<span style="color: #a0522d;">nsel_d4</span>'/<span style="color: #008b8b;">r</span>(mean)*`<span style="color: #a0522d;">nn_d4</span>'/<span style="color: #a0522d;">_N</span>
quietly <span style="color: #008b8b;">sum</span> pop if neighborhood==<span style="color: #8b2252;">"Harbor Islands"</span>
di  <span style="color: #8b2252;">"P(design 2, Harbor Islands): "</span>  `<span style="color: #a0522d;">nsel_d4</span>'/<span style="color: #008b8b;">r</span>(mean)*`<span style="color: #a0522d;">nn_d4</span>'/<span style="color: #a0522d;">_N</span>
</pre>



<pre class="example">
P (design 1, both): .02752617

P (design 2, South Dorchester): .00166808

P (design 2, Harbor Islands): .18691589

P(design 2, South Dorchester): .00166808

P(design 2, Harbor Islands): .18691589

</pre>


</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-15" class="outline-3">
<h3 id="sec-15">Home Work 9</h3>
<div class="outline-text-3" id="text-15">


</div>

<div id="outline-container-15-1" class="outline-4">
<h4 id="sec-15-1">Trends in Unemployment</h4>
<div class="outline-text-4" id="text-15-1">

<p>We again use publicly available data from the World Bank's website to
examine national trends in unemployment percentages (percent
unemployed in total labor force) in four countries: the United States,
Great Britain, Japan, and Canada.
</p>
<p>
In this question, we examine unemployment trends over time using a
correlation analysis, focusing primarily on the United States and
Japan.
</p>
<p>
Use the dataset UnemploymentbyCountry.dta to answer the following
questions.
</p>
<ul>
<li id="sec-15-1-1">Q1<br/>
Calculate the Pearson and Spearman correlations between total
unemployment and year for the United States and for Japan.




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/UnemploymentbyCountry.b41235ad3be6.dta
pwcorr unemployedtotal year if country==<span style="color: #8b2252;">"Japan"</span>
pwcorr unemployedtotal year if country==<span style="color: #8b2252;">"United States"</span>
</pre>



<pre class="example">
(World Bank, World Dev. Indicators &amp; Global Dev. Finance: Int. Labour Org)

             | unempl~l     year
-------------+------------------
unemployed~l |   1.0000 
        year |   0.8437   1.0000 

             | unempl~l     year
-------------+------------------
unemployed~l |   1.0000 
        year |  -0.3415   1.0000 

</pre>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/UnemploymentbyCountry.b41235ad3be6.dta
spearman unemployedtotal year if country==<span style="color: #8b2252;">"Japan"</span>
spearman unemployedtotal year if country==<span style="color: #8b2252;">"United States"</span>
</pre>


<pre class="example">
(World Bank, World Dev. Indicators &amp; Global Dev. Finance: Int. Labour Org)

 Number of obs =      31
Spearman's rho =       0.8162

Test of Ho: unemployedtotal and year are independent
    Prob &gt; |t| =       0.0000

 Number of obs =      31
Spearman's rho =      -0.4517

Test of Ho: unemployedtotal and year are independent
    Prob &gt; |t| =       0.0107

</pre>


</li>
</ul>
<ul>
<li id="sec-15-1-2">Q2<br/>
Exclude all years after 2007 (recall that the financial collapse
occurred in late 2008). Recalculate the correlations in
question 1. (Hint: use an "if" command to restrict to certain years in
Stata.)





<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/UnemploymentbyCountry.b41235ad3be6.dta
pwcorr unemployedtotal year if country==<span style="color: #8b2252;">"Japan"</span> &amp;&amp; year&lt;=2007
pwcorr unemployedtotal year if country==<span style="color: #8b2252;">"United States"</span> &amp;&amp; year&lt;=2007
</pre>



<pre class="example">
(World Bank, World Dev. Indicators &amp; Global Dev. Finance: Int. Labour Org)

             | unempl~l     year
-------------+------------------
unemployed~l |   1.0000 
        year |   0.8276   1.0000 

             | unempl~l     year
-------------+------------------
unemployed~l |   1.0000 
        year |  -0.7557   1.0000 

</pre>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/UnemploymentbyCountry.b41235ad3be6.dta
spearman unemployedtotal year if country==<span style="color: #8b2252;">"Japan"</span> &amp;&amp; year&lt;=2007
spearman unemployedtotal year if country==<span style="color: #8b2252;">"United States"</span> &amp;&amp; year&lt;=2007
</pre>



<pre class="example">
(World Bank, World Dev. Indicators &amp; Global Dev. Finance: Int. Labour Org)

 Number of obs =      28
Spearman's rho =       0.7998

Test of Ho: unemployedtotal and year are independent
    Prob &gt; |t| =       0.0000

 Number of obs =      28
Spearman's rho =      -0.7733

Test of Ho: unemployedtotal and year are independent
    Prob &gt; |t| =       0.0000

</pre>


</li>
</ul>
<ul>
<li id="sec-15-1-3">Q3<br/>
Construct a scatter plot with year on the x-axis and with both
unemployment in the United States and unemployment in Japan on the
y-axis. (Hint: try plotting different symbols for the United States
and Japan by creating two different plots within the Twoway graphs
window; restrict to a specific country by using an "if" statement
within each plot window).





<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/UnemploymentbyCountry.b41235ad3be6.dta
twoway  (scatter unemployedtotal year if country==<span style="color: #8b2252;">"Japan"</span>) <span style="color: #b22222;">///</span>
(scatter unemployedtotal year if country==<span style="color: #8b2252;">"United States"</span>), <span style="color: #b22222;">///</span>
legend( label(1 <span style="color: #8b2252;">"Japan"</span>) label(2 <span style="color: #8b2252;">"United States"</span>) )
</pre>


<p>
<img src="jappan-s.png"  alt="jappan-s.png" />
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-15-2" class="outline-4">
<h4 id="sec-15-2">Nonparametric Tests</h4>
<div class="outline-text-4" id="text-15-2">

<ul>
<li id="sec-15-2-1">Q2<br/>
Suppose you are conducting a two-sided sign test. You have data from 8
paired samples, and you observe 1 positive sign and 7 negative
signs. What is the p-value corresponding to the null hypothesis that
there is no difference in median between the two groups?




<pre class="src src-stata">quietly set obs 8
quietly <span style="color: #a020f0;">generate</span> s1 = 1
quietly <span style="color: #a020f0;">replace</span> s1 = -1 if <span style="color: #228b22;">_n</span> == 8
quietly <span style="color: #a020f0;">generate</span> s2 = 0
signtest s1=s2
</pre>



<pre class="example">
Sign test

        sign |    observed    expected
-------------+------------------------
    positive |           7           4
    negative |           1           4
        zero |           0           0
-------------+------------------------
         all |           8           8

One-sided tests:
  Ho: median of s1 - s2 = 0 vs.
  Ha: median of s1 - s2 &gt; 0
      Pr(#positive &gt;= 7) =
         Binomial(n = 8, x &gt;= 7, p = 0.5) =  0.0352

  Ho: median of s1 - s2 = 0 vs.
  Ha: median of s1 - s2 &lt; 0
      Pr(#negative &gt;= 1) =
         Binomial(n = 8, x &gt;= 1, p = 0.5) =  0.9961

Two-sided test:
  Ho: median of s1 - s2 = 0 vs.
  Ha: median of s1 - s2 != 0
      Pr(#positive &gt;= 7 or #negative &gt;= 7) =
         min(1, 2*Binomial(n = 8, x &gt;= 7, p = 0.5)) =  0.0703

</pre>


<p>
Using formula
</p>


<pre class="src src-stata">di 2*(1-binomial(8, 6, 0.5))
</pre>


<pre class="example">

.0703125

</pre>


<p>
<b>Answer: 0.0703</b>
</p>
</li>
</ul>
<ul>
<li id="sec-15-2-2">Q3<br/>
Walker et al. (1987) examined the characteristics of children dying
from sudden infant death syndrome. The sids.dta contains the age at
death (in days) for a sample of 12 girls and 17 boys. Using an
appropriate non-parametric test with a 0.05 level of significance,
test whether the median age at death is the same for boys and
girls. Be sure to verify the assumptions of your test.




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/sids910.865dbf143262.dta
ranksum Age, <span style="color: #228b22;">by</span>(Sex)
</pre>



<pre class="example">
Two-sample Wilcoxon rank-sum (Mann-Whitney) test

         Sex |      obs    rank sum    expected
-------------+---------------------------------
        Girl |       12         179         180
         Boy |       17         256         255
-------------+---------------------------------
    combined |       29         435         435

unadjusted variance      510.00
adjustment for ties       -0.50
                     ----------
adjusted variance        509.50

Ho: Age(Sex==Girl) = Age(Sex==Boy)
             z =  -0.044
    Prob &gt; |z| =   0.9647

</pre>


<p>
What is the absolute value of your test statistic?
</p>
<p>
<b>Answer: 0.044</b>
</p>
<p>
What is your p-value?
</p>
<p>
<b>Answer: 0.9647</b>
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-15-3" class="outline-4">
<h4 id="sec-15-3">Obesity and Rate of Stroke</h4>
<div class="outline-text-4" id="text-15-3">

<p>In the Framingham dataset that can be downloaded from the course
website, we would like to examine the association between obesity and
the rate of stroke. Since people with hypertension may have a higher
body mass index and they are also at greater risk of a stroke, you may
be concerned about confounding by hypertension.
</p>
<ul>
<li id="sec-15-3-1">Q1<br/>
Use the Framingham dataset and Stata to calculate the incidence rate
ratio of stroke comparing obese participants (bmi1&gt;=30) to all other
participants. The variable for incident stroke in this dataset is
“stroke” and number of years a person was followed for stroke is
recorded in the “timestrk” variable in the NHLBI dataset.






<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly <span style="color: #a020f0;">gen</span> ob = 1 if bmi1&gt;=30
quietly <span style="color: #a020f0;">replace</span> ob = 0 if bmi1&lt;30
ir stroke  ob timestrk
</pre>



<pre class="example">
                 | ob                     |
                 |   Exposed   Unexposed  |      Total
-----------------+------------------------+------------
Incident Stroke  |        85         330  |        415
Time [years] to  |  11144.75    77530.79  |   88675.54
-----------------+------------------------+------------
                 |                        |
  Incidence rate |  .0076269    .0042564  |     .00468
                 |                        |
                 |      Point estimate    |    [95% Conf. Interval]
                 |------------------------+------------------------
 Inc. rate diff. |         .0033705       |    .0016854    .0050557 
 Inc. rate ratio |          1.79188       |    1.394785    2.280687 (exact)
 Attr. frac. ex. |          .441927       |    .2830436    .5615356 (exact)
 Attr. frac. pop |         .0905152       |
                 +-------------------------------------------------
                     (midp)   Pr(k&gt;=85) =                    0.0000 (exact)
                     (midp) 2*Pr(k&gt;=85) =                    0.0000 (exact)

</pre>


<p>
<b>Answer: 1.79188</b> 
</p>
</li>
</ul>
<ul>
<li id="sec-15-3-2">Q2<br/>
Using the Framingham dataset and Stata, what is the incidence rate
ratio (round to two decimal points) of stroke among obese participants
(bmi1&gt;=30) compared to all other participants after adjusting for
prevalent hypertension at visit 1 (prevhyp1)?




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly <span style="color: #a020f0;">gen</span> ob = 1 if bmi1&gt;=30
quietly <span style="color: #a020f0;">replace</span> ob = 0 if bmi1&lt;30
ir stroke ob timestrk, <span style="color: #228b22;">by</span>(prevhyp1)
</pre>



<pre class="example">
Prevalent hypert |      IRR       [95% Conf. Interval]   M-H Weight
-----------------+-------------------------------------------------
              No |   1.484769      .8687724   2.403521     11.75885 (exact)
             Yes |   1.121565      .8335983   1.493098     44.64521 (exact)
-----------------+-------------------------------------------------
           Crude |    1.79188      1.394785   2.280687              (exact)
    M-H combined |   1.197284       .939728    1.52543
-------------------------------------------------------------------
 Test of homogeneity (M-H)    chi2(1) =      0.99  Pr&gt;chi2 = 0.3208

</pre>


<p>
<b>Answer: 1.197284</b>
</p>
</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-16" class="outline-3">
<h3 id="sec-16">Home Work 10</h3>
<div class="outline-text-3" id="text-16">


</div>

<div id="outline-container-16-1" class="outline-4">
<h4 id="sec-16-1">Simple Linear Regression</h4>
<div class="outline-text-4" id="text-16-1">

<p> We use data from the Environmental Protection Agency (EPA) to track
 the BP oil spill in Louisiana between May and September 2010. The oil
 well exploded on April 20, 2010, was capped in July and was declared
 dead in September 2010. The oil spill killed wildlife in the Gulf of
 Mexico and posed a significant public health risk to clean-up workers
 and residents of the Gulf Coast (Solomon and Janssen 2010). The EPA
 monitored air quality and took samples of sediment to measure the
 impact of the oil spill. For more information from the EPA, visit
 <a href="http://www.epa.gov/bpspill/sediment.html#understanding">http://www.epa.gov/bpspill/sediment.html#understanding</a>.
</p>
<p>
*Solomon G., Janssen S. (2010). Health Effects of the Gulf Oil
 Spill. JAMA. (<a href="http://dx.doi.org/doi:10.1001/jama.2010.1254">doi:10.1001/jama.2010.1254</a>)
</p>
<p>
Use the dataset oilspill.dta to answer the following questions.
</p>
<p>
Simple Linear Regression. In this example, we track changes in the
amount of nickel found in sediment along the Louisiana coast between
May and September 2010 (note that there is no data from July). Nickel
is a metal that is found in sediment contaminated with oil. We model
the amount of nickel as a function of time (month) using linear
regression.
</p>
<p>
Fit a linear regression model with nickel as the outcome and month as
the explanatory variable. Using indicator variables, model month as a
categorical covariate (i.e. for the variable "month", it is coded
numerically as May = 5, June = 6, August = 8, September = 9). Call
this <b>Model 1</b>.
</p>
<p>
Assume the assumptions of linear regression are met for this
model. You can make histograms of nickel by month to visually verify
that the data does not appear to be skewed or any other evidence that
would suggest a violation of the assumptions necessary to analyze this
data using linear regression.
</p>
<ul>
<li id="sec-16-1-1">Q1<br/>
Does the amount of nickel in the soil tend to increase over the
four month period? <code>TODO: make a histogram plot</code>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
twoway (scatter nickel month) (lfit nickel month)
</pre>


<p>
<img src="oil-scatter.png"  alt="oil-scatter.png" />
</p>
<p>
<b>Answer: Yes</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-1-2">Q2<br/>
Examine the regression coefficients. Compare how the average nickel
amount changes by month. Is it reasonable to assume that average
amount of nickel increases linearly by month?

<p>
<b>Answer: Yes</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-1-3">Q3<br/>
Make a residual plot.



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
<span style="color: #a020f0;">xi</span>: <span style="color: #008b8b;">regress</span> nickel i.month
rvfplot
</pre>


<p>
<img src="oil-res.png"  alt="oil-res.png" />
</p>
<p>
Is there any evidence of outliers? Is there any evidence of heteroscedasticity?
</p>
<p>
<b>Answer: Yes Yes</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-1-4">Q4<br/>
Now, assume the amount of nickel increases linearly by month, and the
assumptions of linear regression continue to hold. Fit a model with
nickel as the outcome and month modeled as a continuous explanatory
variable. Call this <b>Model 2</b>.

<p>
Using <b>Model 2</b>, it is estimated that, on average, nickel increases
by ______ each month, from May to September.
</p>


<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
quietly <span style="color: #008b8b;">regress</span> nickel month
<span style="color: #b22222;">/// to extract coefficients from matrix  </span>
mat beta=<span style="color: #008b8b;">e</span>(b)
<span style="color: #a020f0;">svmat</span> <span style="color: #228b22;">double</span> beta, names(matcol)
di  <span style="color: #8b2252;">"nickel increases in one month by "</span>   betamonth[1]
</pre>


<pre class="example">

nickel increases in one month by 1.642664

</pre>


<p>
<b>Answer: 1.642664</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-1-5">Q5<br/>
What is the 95% confidence interval for the average increase in
nickel each month?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
regress nickel month
</pre>



<pre class="example">
      Source |       SS       df       MS              Number of obs =     248
-------------+------------------------------           F(  1,   246) =   21.47
       Model |  1535.60852     1  1535.60852           Prob &gt; F      =  0.0000
    Residual |  17594.5323   246  71.5224891           R-squared     =  0.0803
-------------+------------------------------           Adj R-squared =  0.0765
       Total |  19130.1408   247  77.4499629           Root MSE      =  8.4571

------------------------------------------------------------------------------
      nickel |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       month |   1.642664   .3545111     4.63   0.000     .9443998    2.340928
       _cons |   5.335122   2.646702     2.02   0.045     .1220335    10.54821
------------------------------------------------------------------------------

</pre>


<p>
<b>Answer: .9443998 2.340928</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-1-6">Q6<br/>
Given that the relationship between month and nickel appears to be
linear, is it reasonable to use <b>Model 2</b> to predict the amount of
nickel in the soil in July 2010?

<p>
<b>Answer: Yes</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-1-7">Q7<br/>
Given that the relationship between month and nickel appears to be
linear, is it reasonable to use <b>Model 2</b> to predict the amount of
nickel in the soil in October 2010?

<p>
<b>Answer: No</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-1-8">Q8<br/>
What is the average amount of nickel in the soil during August 2010?
According to model 1 (Hint: Think about how dummy/indicator variables
are coded.). According to <b>Model 1</b>. According to <b>Model 2</b>




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
quietly <span style="color: #a020f0;">xi</span>: <span style="color: #008b8b;">regress</span> nickel i.month
quietly <span style="color: #a020f0;">predict</span> pnickel1
quietly <span style="color: #008b8b;">sum</span> pnickel1 if month==8
di  <span style="color: #8b2252;">"av. nickel in August (Model 1): "</span>  <span style="color: #008b8b;">r</span>(mean)

quietly <span style="color: #008b8b;">regress</span> nickel month
quietly <span style="color: #a020f0;">predict</span> pnickel2
quietly <span style="color: #008b8b;">sum</span> pnickel2 if month==8
di  <span style="color: #8b2252;">"av. nickel in August (Model 2): "</span>  <span style="color: #008b8b;">r</span>(mean)
</pre>


<pre class="example">

av. nickel in August (Model 1): 17.962265

av. nickel in August (Model 2): 18.476433

</pre>


<p>
<b>Answer: 17.962263 18.476434</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-1-9">Q9<br/>
True or False: <b>Model 1</b> makes stronger modeling assumptions
than <b>Model 2</b>.

<p>
<b>Answer: False</b>
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-16-2" class="outline-4">
<h4 id="sec-16-2">Multiple Linear Regression</h4>
<div class="outline-text-4" id="text-16-2">

<p>Again, we model the amount of nickel found in the sediment. Now, we
model nickel as a function of both time (month) and location
(longitude). The Gulf Coast in Louisiana is somewhat horizontal, so
for simplicity we will ignore latitude in this problem.
</p>
<p>
Fit a linear regression model with nickel as the outcome and with
month and longitude as explanatory covariates. Model month as a
continuous variable, as in <b>Model 2</b> from the previous question. Call
this <b>Model 3</b>. Assume the assumptions of linear regression hold.
</p>
<ul>
<li id="sec-16-2-1">Q1<br/>
Compare the adjusted R-squared from Models 2 and 3. Does the addition
of longitude improve the adjusted R-square?

<p>
<b>Answer: YES</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-2-2">Q2<br/>
Test whether the coefficient for longitude in the model is equal to 0
at the 0.05 level of significance.




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
regress  nickel month longitude
<span style="color: #b22222;">/// getting answers from command output</span>
mat beta=<span style="color: #008b8b;">e</span>(b)
mat varcovar=<span style="color: #008b8b;">e</span>(V)
<span style="color: #a020f0;">svmat</span> <span style="color: #228b22;">double</span> beta, names(matcol)
di  <span style="color: #8b2252;">"estimated coefficient: "</span>   betalongitude[1]
di  <span style="color: #8b2252;">"degrees of freedom: "</span>   <span style="color: #008b8b;">e</span>(df_r)
</pre>



<pre class="example">
      Source |       SS       df       MS              Number of obs =     248
-------------+------------------------------           F(  2,   245) =   12.54
       Model |  1776.53846     2  888.269231           Prob &gt; F      =  0.0000
    Residual |  17353.6024   245  70.8310301           R-squared     =  0.0929
-------------+------------------------------           Adj R-squared =  0.0855
       Total |  19130.1408   247  77.4499629           Root MSE      =  8.4161

------------------------------------------------------------------------------
      nickel |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       month |   1.678598   .3533309     4.75   0.000     .9826447    2.374552
   longitude |  -.7402628   .4013769    -1.84   0.066    -1.530852    .0503267
       _cons |  -62.10854   36.66326    -1.69   0.092    -134.3239    10.10687
------------------------------------------------------------------------------

estimated coefficient: -.74026284

degrees of freedom: 245

</pre>


<p>
What is the estimated coefficient?
</p>
<p>
<b>Answer: -.7402628</b>
</p>
<p>
The estimated standard error of the estimated coefficient?
</p>
<p>
<b>Answer: .4013769</b>
</p>
<p>
The estimate of the test statistic?
</p>
<p>
<b>Answer: -1.84</b>
</p>
<p>
The number of degrees of freedom of the distribution of the test
statistic under the null hypothesis?
</p>
<p>
<b>Answer: 245</b>
</p>
<p>
The p-value?
</p>
<p>
<b>Answer: 0.066</b>
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-16-3" class="outline-4">
<h4 id="sec-16-3">More Regression</h4>
<div class="outline-text-4" id="text-16-3">

<ul>
<li id="sec-16-3-1">Q1<br/>
 Examine the relationship between vanadium (another marker of oil in
 sediment) and nickel using a scatter plot. Does this relationship
 appear linear?




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
scatter vanadium nickel
</pre>


<p>
<img src="oil-van.png"  alt="oil-van.png" />
</p>
<p>
<b>Answer: Yes</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-3-2">Q2<br/>
How many outliers do you observe in this scatterplot? 

<p>
<b>Answer: 3</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-3-3">Q3<br/>
Fit a linear regression model with nickel as the outcome and vanadium
as the explanatory covariate (Model 4). Use this model to answer
questions 3 and 4.

<p>
How much does nickel increase, on average, for a one mg/kg increase in
vanadium?
</p>



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
quietly <span style="color: #008b8b;">regress</span> nickel vanadium
<span style="color: #b22222;">/// to extract coefficients from matrix  </span>
mat beta=<span style="color: #008b8b;">e</span>(b)
<span style="color: #a020f0;">svmat</span> <span style="color: #228b22;">double</span> beta, names(matcol)
di  <span style="color: #8b2252;">"nickel increases by  "</span>   betavanadium[1]
</pre>


<pre class="example">

nickel increases by  .4379549

</pre>



<p>
<b>Answer: .4379549</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-3-4">Q4<br/>
How much does nickel increase, on average, for a 10 mg/kg increase in
vanadium?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/oilspill.71f9665e3249.dta
quietly <span style="color: #008b8b;">regress</span> nickel vanadium
<span style="color: #b22222;">/// to extract coefficients from matrix  </span>
mat beta=<span style="color: #008b8b;">e</span>(b)
<span style="color: #a020f0;">svmat</span> <span style="color: #228b22;">double</span> beta, names(matcol)
di  <span style="color: #8b2252;">"nickel increases by  "</span>   10*betavanadium[1]
<span style="color: #b22222;">/// another way</span>
lincom 10*vanadium
</pre>



<pre class="example">
nickel increases by  4.379549

 ( 1)  10*vanadium = 0

------------------------------------------------------------------------------
      nickel |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   4.379549   .1613771    27.14   0.000     4.061692    4.697406
------------------------------------------------------------------------------

</pre>


<p>
<b>Answer 4.379549</b>
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-16-4" class="outline-4">
<h4 id="sec-16-4">High Blood Pressure and CHD Incidence</h4>
<div class="outline-text-4" id="text-16-4">

<p>Use Stata and the NHLBI data set to create the two categories of high
blood pressure (highbp1)
</p>

<ul>
<li id="sec-16-4-1">Q1<br/>
What is the incidence rate ratio of stroke comparing those with
high blood pressure to those without high blood pressure? Hint: The
variable for stroke in the dataset is "stroke" and the number of years
a person was followed for stroke is recorded in the "timestrk"
variable.




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly <span style="color: #a020f0;">generate</span> highbp1=.
quietly <span style="color: #a020f0;">replace</span> highbp1=1 if (sysbp1&gt;=140 | diabp1 &gt;= 90)
quietly <span style="color: #a020f0;">replace</span> highbp1=0 if (sysbp1&lt;140 &amp; diabp1&lt;90)
ir stroke highbp1 timestrk
</pre>


<pre class="example">
                 | highbp1                |
                 |   Exposed   Unexposed  |      Total
-----------------+------------------------+------------
Incident Stroke  |       255         160  |        415
Time [years] to  |  28887.76    59787.78  |   88675.54
-----------------+------------------------+------------
                 |                        |
  Incidence rate |  .0088273    .0026761  |     .00468
                 |                        |
                 |      Point estimate    |    [95% Conf. Interval]
                 |------------------------+------------------------
 Inc. rate diff. |         .0061511       |    .0049911    .0073112 
 Inc. rate ratio |         3.298517       |    2.696321    4.045047 (exact)
 Attr. frac. ex. |         .6968334       |    .6291243    .7527841 (exact)
 Attr. frac. pop |         .4281748       |
                 +-------------------------------------------------
                     (midp)   Pr(k&gt;=255) =                   0.0000 (exact)
                     (midp) 2*Pr(k&gt;=255) =                   0.0000 (exact)

</pre>


<p>
<b>Answer: 3.298517</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-4-2">Q2<br/>
What is the incidence rate ratio (rounded to two decimal points)
for the association between high blood pressure (highbp1) and the rate
of stroke among men? Hint: Use the variable (sex1).




<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly <span style="color: #a020f0;">generate</span> highbp1=.
quietly <span style="color: #a020f0;">replace</span> highbp1=1 if (sysbp1&gt;=140 | diabp1 &gt;= 90)
quietly <span style="color: #a020f0;">replace</span> highbp1=0 if (sysbp1&lt;140 &amp; diabp1&lt;90)
 <span style="color: #008b8b;">ir</span> stroke highbp1 timestrk, <span style="color: #228b22;">by</span>(sex1)
</pre>



<pre class="example">
     Sex, exam 1 |      IRR       [95% Conf. Interval]   M-H Weight
-----------------+-------------------------------------------------
            Male |   2.273711      1.697105   3.048007     29.75741 (exact)
          Female |    4.74629      3.537425   6.429301     21.94115 (exact)
-----------------+-------------------------------------------------
           Crude |   3.298517      2.696321   4.045047              (exact)
    M-H combined |   3.323088      2.725029   4.052401
-------------------------------------------------------------------
 Test of homogeneity (M-H)    chi2(1) =     12.84  Pr&gt;chi2 = 0.0003

</pre>


<p>
<b>Answer: 2.273711</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-4-3">Q3<br/>
What is the incidence rate ratio (rounded to two decimal points)
for the association between high blood pressure (highbp1) and the rate
of stroke among women?



<pre class="src src-stata"><span style="color: #a020f0;">use</span> datasets/fhs.2d92301d751b.dta
quietly <span style="color: #a020f0;">generate</span> highbp1=.
quietly <span style="color: #a020f0;">replace</span> highbp1=1 if (sysbp1&gt;=140 | diabp1 &gt;= 90)
quietly <span style="color: #a020f0;">replace</span> highbp1=0 if (sysbp1&lt;140 &amp; diabp1&lt;90)
 <span style="color: #008b8b;">ir</span> stroke highbp1 timestrk, <span style="color: #228b22;">by</span>(sex1)
</pre>



<pre class="example">
     Sex, exam 1 |      IRR       [95% Conf. Interval]   M-H Weight
-----------------+-------------------------------------------------
            Male |   2.273711      1.697105   3.048007     29.75741 (exact)
          Female |    4.74629      3.537425   6.429301     21.94115 (exact)
-----------------+-------------------------------------------------
           Crude |   3.298517      2.696321   4.045047              (exact)
    M-H combined |   3.323088      2.725029   4.052401
-------------------------------------------------------------------
 Test of homogeneity (M-H)    chi2(1) =     12.84  Pr&gt;chi2 = 0.0003

</pre>


<p>
<b>Answer: 4.74629</b>
</p>
</li>
</ul>
<ul>
<li id="sec-16-4-4">Q4<br/>
Conduct a test of homogeneity to evaluate whether the association
between high blood pressure (highbp1) and the rate of stroke is
different by sex. Based on this test, is there evidence that the
difference between the sex-specific incidence rate ratios are more
than just random sampling variability?

</li>
</ul>
</div>
</div>
</div>
</div>

<div id="postamble">
</div>
</div>
</body>
</html>
